cscope 15 /home/flyhigh2sky/morton_filter -q 0000001193 0000210015
	@benchmarking/benchmark.cc

37 
	~"b’chm¬k_ut.h
"

38 
	~"mÜtÚ_f‹r.h
"

41 
	~"cuckoof‹r.h
"

43 
usšg
 
Çme¥aû
 
	gB’chm¬k
;

46 
cÚ¡ex´
 
ušt64_t
 
	$round_to_­´İrŸ‹_size
(
ušt64_t
 
desœed_size
){

47  
desœed_size
 + (
b©ch_size
 - desired_size % batch_size);

48 
	}
}

51 
	g‹m¶©e
<
şass
 
	gMF_CLASS
>

52 
	$ÿlcuÏ‹_mf_çl£_pos™ive_¿tio
(
MF_CLASS
& 
mf
, 
Ùa_occu·ncy
,

53 
logiÿl_lßd_çùÜ
){

54 
buck‘s_acûs£d_³r_Ãg©ive_lookup
 = 1 + 
Ùa_occu·ncy
;

55 
•sÚ
 = 1.0 - 
	`pow
(1.0 - 1.0/(1ULL << (
mf
.
_fšg”´št_Ën_b™s
 -

56 
mf
.
_»size_couÁ
)),

57 
logiÿl_lßd_çùÜ
 * 
buck‘s_acûs£d_³r_Ãg©ive_lookup
 *

58 
mf
.
_¦Ùs_³r_buck‘
);

59  
•sÚ
;

60 
	}
}

62 
	$b’chm¬k
(){

63 
cÚ¡ex´
 
boŞ
 
u£_™em_©_a_time_š£¹iÚ
 = 
çl£
;

64 
cÚ¡ex´
 
boŞ
 
u£_™em_©_a_time_d–‘iÚ
 = 
çl£
;

65 
cÚ¡ex´
 
boŞ
 
sk_cuckoo_f‹r
 = 
Œue
;

66 
cÚ¡ex´
 
boŞ
 
sk_mÜtÚ_f‹r
 = 
çl£
;

67 
cÚ¡ex´
 
boŞ
 
»size_f‹r
 = 
çl£
;

70 
cÚ¡ex´
 
boŞ
 
´št_lßd_hi¡og¿m
 = 
Œue
;

73 
cÚ¡ex´
 
block_§tu¿tiÚ
 = 0.95;

80 
cÚ¡ex´
 
ušt64_t
 
tÙ®_phys_¦Ùs
 = 2097152;

82 
cÚ¡ex´
 
ušt64_t
 
tÙ®_™ems_to_´obe
 = 
	`round_to_­´İrŸ‹_size
(
tÙ®_phys_¦Ùs
 * 
block_§tu¿tiÚ
);

83 
cÚ¡ex´
 
ušt64_t
 
tÙ®_™ems_to_š£¹
 = 
	`round_to_­´İrŸ‹_size
(
tÙ®_phys_¦Ùs
 * 
block_§tu¿tiÚ
);

89 
cÚ¡ex´
 
š£¹_ªd_´obe_™em_ov”Ïp
 = 1.0;

91 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_™ems_to_š£¹
);

92 
¡d
::
veùÜ
<
keys_t
> 
	`´obe_™ems
(
tÙ®_™ems_to_´obe
);

94 
boŞ
 
du¶iÿ‹s_³rm™‹d_š_´obe_veùÜ
 = 
Œue
;

96 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
´obe_™ems
,

97 
š£¹_ªd_´obe_™em_ov”Ïp
, 
du¶iÿ‹s_³rm™‹d_š_´obe_veùÜ
);

99 
time_pošt
 
¡¬t
;

100 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
;

101 
usšg
 
MÜtÚF‹r
 = 
Com´es£dCuckoo
::
MÜtÚ3_8
;

102 
cÚ¡ex´
 
ušt64_t
 
tÙ®_¦Ùs
 = 
tÙ®_phys_¦Ùs
;

103 
¡¬t
 = 
	`now
();

104 
MÜtÚF‹r
 
	`ccf
(
tÙ®_¦Ùs
);

105 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

106 
¡d
::
cout
 << "MÜtÚ f‹¸cÚ¡ruùÜime: " << 
diff
.
	`couÁ
(è<< " secÚds" << std::
’dl
;

108 if(! 
sk_cuckoo_f‹r
){

109 
	`¡©ic_as£¹
(
	`__butš_pİcouÁÎ
(
tÙ®_phys_¦Ùs
 / 4) == 1,

112 
cÚ¡ex´
 
ušt16_t
 
fšg”´št_Ën_b™s
 = 8;

114 
¡¬t
 = 
	`now
();

115 
cuckoof‹r
::
CuckooF‹r
<
ušt64_t
, 
fšg”´št_Ën_b™s
,

116 
cuckoof‹r
::
SšgËTabË
> 
	`cf
(
tÙ®_phys_¦Ùs
 / 4, 
çl£
);

117 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

118 
¡d
::
cout
 << "CuckoØf‹¸cÚ¡ruùÜime: " << 
diff
.
	`couÁ
(è<< " secÚds" << std::
’dl
;

120 
¡d
::
cout
 << 
ccf
 << std::
’dl
;

122 
ušt64_t
 
cuckoo_š£¹_couÁ
 = 
tÙ®_™ems_to_š£¹
;

123 
¡¬t
 = 
	`now
();

124 
ušt64_t
 
i
 = 0; i < 
cuckoo_š£¹_couÁ
; i++){

125 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

127 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

128 
¡d
::
cout
 << "Vanilla cuckoo filter millions of insertions…er second: "

129 << (
cuckoo_š£¹_couÁ
 / ((1e6)*
diff
.
	`couÁ
())è<< 
¡d
::
’dl
;

131 
¡¬t
 = 
	`now
();

132 
ušt64_t
 
i
 = 0; i < 
cuckoo_š£¹_couÁ
; i++){

133 
cf
.
	`D–‘e
(
š£¹_™ems
[
i
]);

135 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

136 
¡d
::
cout
 << "Vanilla cuckoo filter millions of deletions…er second: "

137 << (
cuckoo_š£¹_couÁ
 / ((1e6)*
diff
.
	`couÁ
())è<< 
¡d
::
’dl
;

140 if(
sk_mÜtÚ_f‹r
){

144 
ušt64_t
 
sucûssful_š£¹s
 = 0;

145 if(
u£_™em_©_a_time_š£¹iÚ
){

146 
¡d
::
cout
 << "ITEM AT A TIME INSERTIONS\n" << std::
æush
;

147 
¡¬t
 = 
	`now
();

148 
ušt64_t
 
i
 = 0; i < 
tÙ®_™ems_to_š£¹
; i++){

149 
sucûssful_š£¹s
 +ğ
ccf
.
	`š£¹
(
š£¹_™ems
[
i
]);

151 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

154 
¡d
::
veùÜ
<
boŞ
> 
	`š£¹_¡©us
(
tÙ®_™ems_to_š£¹
, 
çl£
);

155 
¡d
::
cout
 << "MANY ITEMS AT A TIME INSERTION ALGORITHM\n" << std::
æush
;

156 
¡¬t
 = 
	`now
();

157 
ccf
.
	`š£¹_mªy
(
š£¹_™ems
, 
š£¹_¡©us
, 
tÙ®_™ems_to_š£¹
);

158 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

159 
ušt64_t
 
i
 = 0; i < 
tÙ®_™ems_to_š£¹
; i++){

160 
sucûssful_š£¹s
 +ğ
š£¹_¡©us
[
i
];

163 
¡d
::
cout
 << "MliÚ oàš£¹iÚ ³¸£cÚd: " << (
tÙ®_™ems_to_š£¹
 / ((1e6)*
diff
.
	`couÁ
())è<< std::
’dl
;

164 
¡d
::
cout
 << 
sucûssful_š£¹s
 << " oà" << 
tÙ®_™ems_to_š£¹
 <<

165 " w”sucûssfuÈš£¹iÚs." << 
¡d
::
’dl
;

166 
¡d
::
cout
 << (100.0 * 
sucûssful_š£¹s
è/ 
tÙ®_™ems_to_š£¹
 << "% sucûssfuÎy in£¹ed\n" << std::
æush
;

168 if(
»size_f‹r
){

169 
¡¬t
 = 
	`now
();

170 
ccf
.
‹m¶©e
 
»size
<1>();

173 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

174 
¡d
::
cout
 << "MliÚ oà™em »loÿ‹d…” secÚd: " << (
tÙ®_™ems_to_š£¹
 / ((1e6)*
diff
.
	`couÁ
())è<< std::
’dl
;

178 
ušt64_t
 
Ãt_sucûss
 = 0;

179 
¡¬t
 = 
	`now
();

180 
ušt64_t
 
i
 = 0; i < 
tÙ®_™ems_to_´obe
; i++){

181 
Ãt_sucûss
 +ğ
ccf
.
	`lik–y_cÚšs
(
´obe_™ems
[
i
]);

183 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

184 
¡d
::
cout
 << "MliÚ oàlookup ³¸£cÚd: " << (
tÙ®_™ems_to_´obe
 / ((1e6)*
diff
.
	`couÁ
())è<< std::
’dl
;

185 
¡d
::
cout
 << (100.0 * 
Ãt_sucûss
è/ 
tÙ®_™ems_to_´obe
 << "% successfully„etrieved\n";

186 
¡d
::
cout
 << 
Ãt_sucûss
 << " oà" << 
tÙ®_™ems_to_´obe
 << " were successful†ookups\n";

189 
¡d
::
veùÜ
<
boŞ
> 
	`sucûs£s2
(
tÙ®_™ems_to_´obe
, 
çl£
);

190 
¡¬t
 = 
	`now
();

191 
ccf
.
	`lik–y_cÚšs_mªy
(
´obe_™ems
, 
sucûs£s2
, 
tÙ®_™ems_to_´obe
);

192 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

193 
¡d
::
cout
 << "MliÚ oàlookup ³¸£cÚd: " << (
tÙ®_™ems_to_´obe
 / ((1e6)*
diff
.
	`couÁ
())è<< std::
’dl
;

194 
Ãt_sucûss
 = 0;

195 
ušt64_t
 
i
 = 0; i < 
tÙ®_™ems_to_´obe
; i++){

196 
Ãt_sucûss
 +ğ
sucûs£s2
[
i
];

198 
¡d
::
cout
 << (100.0 * 
Ãt_sucûss
è/ 
tÙ®_™ems_to_´obe
 << "% successfully„etrieved\n";

199 
¡d
::
cout
 << 
Ãt_sucûss
 << " oà" << 
tÙ®_™ems_to_´obe
 << " were successful†ookups\n";

201 
Ùa_occu·ncy
 = 
ccf
.
	`»pÜt_Ùa_occu·ncy
();

202 
¡d
::
cout
 << "OTA Occu·ncy R©io: " << 
Ùa_occu·ncy
 << std::
’dl
;

203 
¡d
::
cout
 << "M—ÀOTA B™ S‘: " << 
Ùa_occu·ncy
 * 
ccf
.
_Ùa_Ën_b™s
 <<

204 
¡d
::
’dl
;

205 
block_occu·ncy
 = 
ccf
.
	`»pÜt_block_occu·ncy
();

206 
¡d
::
cout
 << "Projected False Positive Ratio: " <<

207 
ÿlcuÏ‹_mf_çl£_pos™ive_¿tio
<
MÜtÚF‹r
>(
ccf
, 
Ùa_occu·ncy
,

208 
block_occu·ncy
 * 
ccf
.
	`»pÜt_com´essiÚ_¿tio
()è<< 
¡d
::
’dl
;

209 
¡d
::
cout
 << "Block occu·ncy: " << 
block_occu·ncy
 << std::
’dl
;

210 if(
´št_lßd_hi¡og¿m
è
ccf
.
	`´št_buck‘_ªd_block_lßd_hi¡og¿ms
();

213 if(
u£_™em_©_a_time_d–‘iÚ
){

214 
¡¬t
 = 
	`now
();

215 
Ãt_sucûss
 = 0;

216 
ušt64_t
 
i
 = 0; i < 
tÙ®_™ems_to_š£¹
; i++){

217 
boŞ
 
sucûss
 = 
ccf
.
	`d–‘e_™em
(
š£¹_™ems
[
i
]);

218 
Ãt_sucûss
 +ğ
sucûss
;

219 if(!
sucûss
){

220 
¡d
::
û¼
 << "FaedØd–‘" << 
i
 << "th item\n";

223 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

224 
¡d
::
cout
 << "MliÚ oàd–‘iÚ ³¸£cÚd: " << (
tÙ®_™ems_to_š£¹
 / ((1e6)*
diff
.
	`couÁ
())è<< std::
’dl
;

225 
¡d
::
cout
 << 
Ãt_sucûss
 << " oà" << 
tÙ®_™ems_to_š£¹
 <<

227 
¡d
::
cout
 << (100.0 * 
Ãt_sucûss
è/ 
tÙ®_™ems_to_š£¹
 << "% successfully deleted\n";

231 
¡d
::
veùÜ
<
boŞ
> 
	`sucûs£s3
(
tÙ®_™ems_to_š£¹
, 
çl£
);

232 
¡¬t
 = 
	`now
();

233 
ccf
.
	`d–‘e_mªy
(
š£¹_™ems
, 
sucûs£s3
, 
tÙ®_™ems_to_š£¹
);

234 
diff
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

235 
¡d
::
cout
 << "MliÚ oàd–‘iÚ ³¸£cÚd: " << (
tÙ®_™ems_to_š£¹
 / ((1e6)*
diff
.
	`couÁ
())è<< std::
’dl
;

236 
Ãt_sucûss
 = 0;

237 
ušt64_t
 
i
 = 0; i < 
tÙ®_™ems_to_š£¹
; i++){

238 
Ãt_sucûss
 +ğ
sucûs£s3
[
i
];

240 
¡d
::
cout
 << 
Ãt_sucûss
 << " oà" << 
tÙ®_™ems_to_š£¹
 <<

243 
¡d
::
cout
 << (100.0 * 
Ãt_sucûss
è/ 
tÙ®_™ems_to_š£¹
 << "% successfully deleted\n";

246 
Ùa_occu·ncy
 = 
ccf
.
	`»pÜt_Ùa_occu·ncy
();

247 
¡d
::
cout
 << "OTA Occu·ncy R©io: " << 
Ùa_occu·ncy
 << std::
’dl
;

248 
¡d
::
cout
 << "M—ÀOTA B™ S‘: " << 
Ùa_occu·ncy
 * 
ccf
.
_Ùa_Ën_b™s
 <<

249 
¡d
::
’dl
;

250 
¡d
::
cout
 << "Block occu·ncy: " << 
ccf
.
	`»pÜt_block_occu·ncy
(è<< std::
’dl
;

251 
	}
}

253 
	$maš
(
¬gc
, ** 
¬gv
){

254 
	`b’chm¬k
();

255 
	}
}

	@benchmarking/benchmark_cf.cc

37 
	~"b’chm¬k_cf.h
"

39 
	$maš
(
¬gc
, ** 
¬gv
){

40 
cÚ¡ex´
 
ušt64_t
 
fšg”´št_Ën_b™s
 = 12;

41 
cÚ¡ex´
 
ušt64_t
 
tÙ®_¦Ùs
 = 128 * 1024 * 1024;

42 
¡d
::
veùÜ
<> 
lfs
 = {0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40,

46 
ušt64_t
 
g¿d©iÚs
 = 1.0;

47 
cÚ¡ex´
 
ušt64_t
 
lookup_ŒŸls
 = 5;

48 
cÚ¡ex´
 
ušt64_t
 
modify_ŒŸls
 = 
lookup_ŒŸls
;

50 
ŒŸl_ouuts
[
lookup_ŒŸls
];

53 
¡d
::
veùÜ
<> 
	`lookup_throughputs
(
lfs
.
	`size
(), 0.0);

54 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT %%TRUE_POSITIVE\n";

55 
ušt64_t
 
g
 = 0; g <ğ
g¿d©iÚs
; g++){

56 
¡d
::
veùÜ
<> 
	`lookup_throughputs
(
lfs
.
	`size
(), 0.0);

57 
Œue_pos™ive
 = (1.0 * 
g
è/ 
g¿d©iÚs
;

58 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

59 
lf
 = 
lfs
[
i
];

60 
ušt64_t
 
t
 = 0; < 
lookup_ŒŸls
;++){

61 
ŒŸl_ouuts
[
t
] = 
b’chm¬k_lookups
<
fšg”´št_Ën_b™s
>(

62 
tÙ®_¦Ùs
, 
lf
, 
Œue_pos™ive
);

63 
lookup_throughputs
[
i
] +ğ
ŒŸl_ouuts
[
t
];

65 
lookup_throughputs
[
i
] /ğ
lookup_ŒŸls
;

66 
¡d
::
cout
 << "CF " << 
lf
 << " LOOKUP " << 
lookup_throughputs
[
i
] << " " << 
Œue_pos™ive
;

67 
ušt64_t
 
t
 = 0; < 
lookup_ŒŸls
;++){

68 
¡d
::
cout
 << " " << 
ŒŸl_ouuts
[
t
];

70 
¡d
::
cout
 << std::
’dl
;

71 
lookup_throughputs
[
i
] = 0;

77 
¡d
::
veùÜ
<> 
	`š£¹_throughputs
(
lfs
.
	`size
(), 0.0);

78 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT\n";

79 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

80 
lf
 = 
lfs
[
i
];

81 
ušt64_t
 
t
 = 0; < 
modify_ŒŸls
;++){

82 
ŒŸl_ouuts
[
t
] = 
b’chm¬k_š£¹iÚs
<
fšg”´št_Ën_b™s
>(

83 
tÙ®_¦Ùs
, 
lf
);

84 
š£¹_throughputs
[
i
] +ğ
ŒŸl_ouuts
[
t
];

86 
š£¹_throughputs
[
i
] /ğ
modify_ŒŸls
;

87 
¡d
::
cout
 << "CF " << 
lf
 << " INSERT " << 
š£¹_throughputs
[
i
];

88 
ušt64_t
 
t
 = 0; < 
modify_ŒŸls
;++){

89 
¡d
::
cout
 << " " << 
ŒŸl_ouuts
[
t
];

91 
¡d
::
cout
 << std::
’dl
;

95 
¡d
::
veùÜ
<> 
	`d–‘e_throughputs
(
lfs
.
	`size
());

96 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT\n";

97 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

98 
lf
 = 
lfs
[
i
];

99 
ušt64_t
 
t
 = 0; < 
modify_ŒŸls
;++){

100 
ŒŸl_ouuts
[
t
] = 
b’chm¬k_d–‘iÚs
<
fšg”´št_Ën_b™s
>(

101 
tÙ®_¦Ùs
, 
lf
);

102 
d–‘e_throughputs
[
i
] +ğ
ŒŸl_ouuts
[
t
];

104 
d–‘e_throughputs
[
i
] /ğ
modify_ŒŸls
;

105 
¡d
::
cout
 << "CF " << 
lf
 << " DELETE " << 
d–‘e_throughputs
[
i
];

106 
ušt64_t
 
t
 = 0; < 
modify_ŒŸls
;++){

107 
¡d
::
cout
 << " " << 
ŒŸl_ouuts
[
t
];

109 
¡d
::
cout
 << std::
’dl
;

113 
	}
}

	@benchmarking/benchmark_cf.h

37 #iâdeà
BENCHMARK_CF_H


38 
	#BENCHMARK_CF_H


	)

40 
	~"b’chm¬k_ut.h
"

41 
	~"veùÜ_ty³s.h
"

42 
	~"b’chm¬k_commÚ.h
"

43 
	~"cuckoof‹r.h
"

45 
usšg
 
Çme¥aû
 
	gB’chm¬k
;

47 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

48 
	$b’chm¬k_š£¹iÚs
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
){

49 
ušt64_t
 
tÙ®_buck‘s
 = 
tÙ®_¦Ùs
 / 4;

50 
cuckoof‹r
::
CuckooF‹r
<
ušt64_t
, 
fšg”´št_Ën_b™s
,

51 
cuckoof‹r
::
SšgËTabË
> 
	`cf
(
tÙ®_buck‘s
, 
çl£
);

53 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_¦Ùs
);

54 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
);

56 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 = 
rg‘_lf
 * 
tÙ®_¦Ùs
;

57 
ušt64_t
 
i
 = 0; i < 
™ems_to_š£¹_to_h™_lf_rg‘
; i++){

58 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

63 
ušt64_t
 
£cÚd¬y_š£¹_couÁ
 = 
tÙ®_¦Ùs
 * 
¦Ù_äaùiÚ
;

65 
time_pošt
 
¡¬t
 = 
	`now
();

66 
ušt64_t
 
i
 = 
™ems_to_š£¹_to_h™_lf_rg‘
; i < i‹ms_to_š£¹_to_h™_lf_rg‘ + 
£cÚd¬y_š£¹_couÁ
; i++){

67 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

69 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 = std::chrÚo::
du¿tiÚ_ÿ¡
<¡d::chrÚo::du¿tiÚ<>>(
	`now
(è- 
¡¬t
);

71  
£cÚd¬y_š£¹_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

72 
	}
}

74 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

75 
	$b’chm¬k_d–‘iÚs
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
){

76 
ušt64_t
 
tÙ®_buck‘s
 = 
tÙ®_¦Ùs
 / 4;

77 
cuckoof‹r
::
CuckooF‹r
<
ušt64_t
, 
fšg”´št_Ën_b™s
,

78 
cuckoof‹r
::
SšgËTabË
> 
	`cf
(
tÙ®_buck‘s
, 
çl£
);

83 
ušt64_t
 
d–‘e_couÁ
 = 
tÙ®_¦Ùs
 * 
¦Ù_äaùiÚ
;

85 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_¦Ùs
 * 
rg‘_lf
);

86 
¡d
::
veùÜ
<
keys_t
> 
	`d–‘e_™ems
(
d–‘e_couÁ
);

89 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
d–‘e_™ems
, 1.0, 0);

91 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 = 
rg‘_lf
 * 
tÙ®_¦Ùs
;

92 
ušt64_t
 
i
 = 0; i < 
™ems_to_š£¹_to_h™_lf_rg‘
; i++){

93 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

96 
time_pošt
 
¡¬t
 = 
	`now
();

97 
ušt64_t
 
i
 = 0; i < 
d–‘e_couÁ
; i++){

98 
cf
.
	`D–‘e
(
d–‘e_™ems
[
i
]);

100 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 = std::chrÚo::
du¿tiÚ_ÿ¡
<¡d::chrÚo::du¿tiÚ<>>(
	`now
(è- 
¡¬t
);

102  
d–‘e_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

103 
	}
}

105 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

106 
	$b’chm¬k_lookups
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
,

107 
ov”Ïp
){

108 
ušt64_t
 
tÙ®_buck‘s
 = 
tÙ®_¦Ùs
 / 4;

109 
cuckoof‹r
::
CuckooF‹r
<
ušt64_t
, 
fšg”´št_Ën_b™s
,

110 
cuckoof‹r
::
SšgËTabË
> 
	`cf
(
tÙ®_buck‘s
, 
çl£
);

113 
ušt64_t
 
lookup_couÁ
 = 1024 * 1024;

115 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_¦Ùs
 * 
rg‘_lf
);

116 
¡d
::
veùÜ
<
keys_t
> 
	`´obe_™ems
(
lookup_couÁ
);

119 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
´obe_™ems
, 
ov”Ïp
, 1);

121 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 = 
rg‘_lf
 * 
tÙ®_¦Ùs
;

122 
ušt64_t
 
i
 = 0; i < 
™ems_to_š£¹_to_h™_lf_rg‘
; i++){

123 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

126 
ušt64_t
 
found_couÁ
 = 0;

127 
time_pošt
 
¡¬t
 = 
	`now
();

128 
ušt64_t
 
i
 = 0; i < 
lookup_couÁ
; i++){

129 
found_couÁ
 +ğ(
cuckoof‹r
::
Ok
 =ğ
cf
.
	`CÚš
(
´obe_™ems
[
i
]));

131 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 = std::chrÚo::
du¿tiÚ_ÿ¡
<¡d::chrÚo::du¿tiÚ<>>(
	`now
(è- 
¡¬t
);

132 
¡d
::
û¼
 << 
found_couÁ
 << std::
’dl
;

134  
lookup_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

135 
	}
}

	@benchmarking/benchmark_common.h

37 #iâdeà
BENCHMARK_COMMON_H


38 
	#BENCHMARK_COMMON_H


	)

40 
Çme¥aû
 
	gB’chm¬k
{

47 
	g¦Ù_äaùiÚ
 = 0.003;

	@benchmarking/benchmark_mf.cc

37 
	~"b’chm¬k_mf.h
"

40 
usšg
 
Çme¥aû
 
	gB’chm¬k
;

42 
	$maš
(
¬gc
, ** 
¬gv
){

43 
cÚ¡ex´
 
ušt64_t
 
fšg”´št_Ën_b™s
 = 
b’ch_mf
::fingerprint_len_bits;

44 
cÚ¡ex´
 
ušt64_t
 
tÙ®_¦Ùs
 = 128 * 1024 * 1024;

45 
¡d
::
veùÜ
<> 
lfs
 = {0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40,

49 
cÚ¡ex´
 
ušt64_t
 
g¿d©iÚs
 = 1.0;

50 
cÚ¡ex´
 
ušt64_t
 
lookup_ŒŸls
 = 5;

51 
cÚ¡ex´
 
ušt64_t
 
modify_ŒŸls
 = 
lookup_ŒŸls
;

53 
ŒŸl_ouuts
[
lookup_ŒŸls
];

56 
¡d
::
veùÜ
<> 
	`lookup_throughputs
(
lfs
.
	`size
(), 0.0);

57 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT %%TRUE_POSITIVE\n";

58 
ušt64_t
 
g
 = 0; g <ğ
g¿d©iÚs
; g++){

59 
¡d
::
veùÜ
<> 
	`lookup_throughputs
(
lfs
.
	`size
(), 0.0);

60 
Œue_pos™ive
 = (1.0 * 
g
è/ 
g¿d©iÚs
;

61 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

62 
lf
 = 
lfs
[
i
];

63 
ušt64_t
 
t
 = 0; < 
lookup_ŒŸls
;++){

64 
ŒŸl_ouuts
[
t
] = 
b’chm¬k_lookups
<
fšg”´št_Ën_b™s
>(

65 
tÙ®_¦Ùs
, 
lf
, 
Œue_pos™ive
);

66 
lookup_throughputs
[
i
] +ğ
ŒŸl_ouuts
[
t
];

68 
lookup_throughputs
[
i
] /ğ
lookup_ŒŸls
;

69 
¡d
::
cout
 << "MF " << 
lf
 << " LOOKUP " << 
lookup_throughputs
[
i
] << " " << 
Œue_pos™ive
;

70 
ušt64_t
 
t
 = 0; < 
lookup_ŒŸls
;++){

71 
¡d
::
cout
 << " " << 
ŒŸl_ouuts
[
t
];

73 
¡d
::
cout
 << std::
’dl
;

74 
lookup_throughputs
[
i
] = 0;

79 
¡d
::
veùÜ
<> 
	`š£¹_throughputs
(
lfs
.
	`size
(), 0.0);

80 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT\n";

81 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

82 
lf
 = 
lfs
[
i
];

83 
ušt64_t
 
t
 = 0; < 
modify_ŒŸls
;++){

84 
ŒŸl_ouuts
[
t
] = 
b’chm¬k_š£¹iÚs
<
fšg”´št_Ën_b™s
>(

85 
tÙ®_¦Ùs
, 
lf
);

86 
š£¹_throughputs
[
i
] +ğ
ŒŸl_ouuts
[
t
];

88 
š£¹_throughputs
[
i
] /ğ
modify_ŒŸls
;

89 
¡d
::
cout
 << "MF " << 
lf
 << " INSERT " << 
š£¹_throughputs
[
i
];

90 
ušt64_t
 
t
 = 0; < 
modify_ŒŸls
;++){

91 
¡d
::
cout
 << " " << 
ŒŸl_ouuts
[
t
];

93 
¡d
::
cout
 << std::
’dl
;

97 
¡d
::
veùÜ
<> 
	`d–‘e_throughputs
(
lfs
.
	`size
());

98 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT\n";

99 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

100 
lf
 = 
lfs
[
i
];

101 
ušt64_t
 
t
 = 0; < 
modify_ŒŸls
;++){

102 
ŒŸl_ouuts
[
t
] = 
b’chm¬k_d–‘iÚs
<
fšg”´št_Ën_b™s
>(

103 
tÙ®_¦Ùs
, 
lf
);

104 
d–‘e_throughputs
[
i
] +ğ
ŒŸl_ouuts
[
t
];

106 
d–‘e_throughputs
[
i
] /ğ
modify_ŒŸls
;

107 
¡d
::
cout
 << "MF " << 
lf
 << " DELETE " << 
d–‘e_throughputs
[
i
];

108 
ušt64_t
 
t
 = 0; < 
modify_ŒŸls
;++){

109 
¡d
::
cout
 << " " << 
ŒŸl_ouuts
[
t
];

111 
¡d
::
cout
 << std::
’dl
;

114 
	}
}

	@benchmarking/benchmark_mf.h

37 #iâdeà
_BENCHMARK_MF_H


38 
	#_BENCHMARK_MF_H


	)

40 
	~"com´es£d_cuckoo_f‹r.h
"

41 
	~"b’chm¬k_ut.h
"

42 
	~"veùÜ_ty³s.h
"

43 
	~"b’chm¬k_mf_cÚfig.h
"

44 
	~"b’chm¬k_commÚ.h
"

46 
usšg
 
Çme¥aû
 
	gB’chm¬k
;

47 
usšg
 
	gMÜtÚ_Ty³
 = 
Com´es£dCuckoo
::
Com´es£dCuckooF‹r
<

48 
b’ch_mf
::
¦Ùs_³r_buck‘
,

49 
	gb’ch_mf
::
fšg”´št_Ën_b™s
,

50 
	gb’ch_mf
::
Ùa_Ën_b™s
,

51 
	gb’ch_mf
::
block_size_b™s
,

52 
	gb’ch_mf
::
rg‘_com´essiÚ_¿tio_så
,

53 
	gb’ch_mf
::
»ad_couÁ”s_m‘hod
,

54 
	gb’ch_mf
::
»ad_fšg”´šts_m‘hod
,

55 
	gb’ch_mf
::
»duùiÚ_m‘hod
,

56 
	gb’ch_mf
::
®‹º©e_buck‘_£ËùiÚ_m‘hod
,

57 
	gb’ch_mf
::
mÜtÚ_Ùa_hashšg_m‘hod
,

58 
	gb’ch_mf
::
»sizšg_’abËd
,

59 
	gb’ch_mf
::
»m­_’abËd
,

60 
	gb’ch_mf
::
cŞlisiÚ_»sŞutiÚ_’abËd
,

61 
	gb’ch_mf
::
mÜtÚ_f‹r_funùiÚ®™y_’abËd
,

62 
	gb’ch_mf
::
block_fuÎÃss_¬¿y_’abËd
,

63 
	gb’ch_mf
::
hªdË_cÚæiùs
,

64 
	gb’ch_mf
::
fšg”´št_com·risÚ_m‘hod


67 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

68 
	$b’chm¬k_š£¹iÚs
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
){

69 
MÜtÚ_Ty³
 
	`cf
(
tÙ®_¦Ùs
);

74 
ušt64_t
 
£cÚd¬y_š£¹_couÁ
 = 
	`to_muÉË_of_b©ch
(
tÙ®_¦Ùs
 * 
¦Ù_äaùiÚ
,

75 
b©ch_size
);

77 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_¦Ùs
);

78 
¡d
::
veùÜ
<
keys_t
> 
	`b’chm¬k_š£¹_™ems
(
£cÚd¬y_š£¹_couÁ
);

80 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
b’chm¬k_š£¹_™ems
,

83 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 =

84 
	`to_muÉË_of_b©ch
(
rg‘_lf
 * 
tÙ®_¦Ùs
, 
b©ch_size
);

86 
¡d
::
veùÜ
<
boŞ
> 
	`¡©us
(
™ems_to_š£¹_to_h™_lf_rg‘
, 
çl£
);

87 
¡d
::
veùÜ
<
boŞ
> 
	`¡©us_b’chm¬k
(
£cÚd¬y_š£¹_couÁ
, 
çl£
);

90 
cf
.
	`š£¹_mªy
(
š£¹_™ems
, 
¡©us
, 
™ems_to_š£¹_to_h™_lf_rg‘
);

92 
time_pošt
 
¡¬t
 = 
	`now
();

93 
cf
.
	`š£¹_mªy
(
b’chm¬k_š£¹_™ems
, 
¡©us_b’chm¬k
,

94 
£cÚd¬y_š£¹_couÁ
);

95 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 = std::chrÚo::
du¿tiÚ_ÿ¡
<¡d::chrÚo::du¿tiÚ<>>(
	`now
(è- 
¡¬t
);

97 
ušt64_t
 
sucûss_couÁ
 = 
¡d
::
	`accumuÏ‹
(
¡©us_b’chm¬k
.
	`begš
(), stus_b’chm¬k.
	`’d
(), 0);

98 if(
sucûss_couÁ
 !ğ
£cÚd¬y_š£¹_couÁ
){

99 
¡d
::
û¼
 << "OÆy " << 
sucûss_couÁ
 << " oà" << 
£cÚd¬y_š£¹_couÁ
 << " insertions succeeded.\n";

102  
£cÚd¬y_š£¹_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

103 
	}
}

105 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

106 
	$b’chm¬k_d–‘iÚs
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
){

107 
MÜtÚ_Ty³
 
	`cf
(
tÙ®_¦Ùs
);

112 
ušt64_t
 
d–‘e_couÁ
 = 
	`to_muÉË_of_b©ch
(
tÙ®_¦Ùs
 * 
¦Ù_äaùiÚ
,

113 
b©ch_size
);

115 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 =

116 
	`to_muÉË_of_b©ch
(
rg‘_lf
 * 
tÙ®_¦Ùs
, 
b©ch_size
);

118 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
™ems_to_š£¹_to_h™_lf_rg‘
);

119 
¡d
::
veùÜ
<
keys_t
> 
	`d–‘e_™ems
(
d–‘e_couÁ
);

122 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
d–‘e_™ems
, 1.0, 0);

124 
¡d
::
veùÜ
<
boŞ
> 
	`¡©us
(
™ems_to_š£¹_to_h™_lf_rg‘
, 
çl£
);

125 
¡d
::
veùÜ
<
boŞ
> 
	`¡©us_b’chm¬k
(
d–‘e_couÁ
, 
çl£
);

127 
cf
.
	`š£¹_mªy
(
š£¹_™ems
, 
¡©us
, 
™ems_to_š£¹_to_h™_lf_rg‘
);

129 
time_pošt
 
¡¬t
 = 
	`now
();

130 
cf
.
	`d–‘e_mªy
(
d–‘e_™ems
, 
¡©us_b’chm¬k
, 
d–‘e_couÁ
);

131 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 = std::chrÚo::
du¿tiÚ_ÿ¡
<¡d::chrÚo::du¿tiÚ<>>(
	`now
(è- 
¡¬t
);

133 
ušt64_t
 
sucûss_couÁ
 = 
¡d
::
	`accumuÏ‹
(
¡©us_b’chm¬k
.
	`begš
(), stus_b’chm¬k.
	`’d
(), 0);

134 if(
sucûss_couÁ
 !ğ
d–‘e_couÁ
){

135 
¡d
::
û¼
 << "OÆy " << 
sucûss_couÁ
 << " oà" << 
d–‘e_couÁ
 << " deletions succeeded.\n";

138  
d–‘e_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

139 
	}
}

141 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

142 
	$b’chm¬k_lookups
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
,

143 
ov”Ïp
){

144 
MÜtÚ_Ty³
 
	`cf
(
tÙ®_¦Ùs
);

148 
ušt64_t
 
lookup_couÁ
 = 1024 * 1024;

151 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 =

152 
	`to_muÉË_of_b©ch
(
rg‘_lf
 * 
tÙ®_¦Ùs
, 
b©ch_size
);

154 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
™ems_to_š£¹_to_h™_lf_rg‘
);

155 
¡d
::
veùÜ
<
keys_t
> 
	`´obe_™ems
(
lookup_couÁ
);

158 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
´obe_™ems
, 
ov”Ïp
, 1);

160 
¡d
::
veùÜ
<
boŞ
> 
	`¡©us
(
™ems_to_š£¹_to_h™_lf_rg‘
, 
çl£
);

161 
¡d
::
veùÜ
<
boŞ
> 
	`¡©us_b’chm¬k
(
lookup_couÁ
, 
çl£
);

163 
cf
.
	`š£¹_mªy
(
š£¹_™ems
, 
¡©us
, 
™ems_to_š£¹_to_h™_lf_rg‘
);

165 
time_pošt
 
¡¬t
 = 
	`now
();

166 
cf
.
	`lik–y_cÚšs_mªy
(
´obe_™ems
, 
¡©us_b’chm¬k
, 
lookup_couÁ
);

167 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 =

168 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<¡d::chrÚo::
du¿tiÚ
<>>(
	`now
(è- 
¡¬t
);

170 if(
ov”Ïp
 == 1.0){

171 
ušt64_t
 
sucûss_couÁ
 = 
¡d
::
	`accumuÏ‹
(
¡©us_b’chm¬k
.
	`begš
(), stus_b’chm¬k.
	`’d
(), 0);

172 if(
sucûss_couÁ
 !ğ
lookup_couÁ
){

173 
¡d
::
û¼
 << "OÆy " << 
sucûss_couÁ
 << " oà" << 
lookup_couÁ
 << "†ookups succeeded.\n";

177  
lookup_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

178 
	}
}

	@benchmarking/benchmark_mf_config.h

39 #iâdeà
_BENCHMARK_MF_CONFIG_H


40 
	#_BENCHMARK_MF_CONFIG_H


	)

48 
	~"com´es£d_cuckoo_f‹r.h
"

50 
usšg
 
Çme¥aû
 
	gCom´es£dCuckoo
;

52 
Çme¥aû
 
	gb’ch_mf
{

54 
cÚ¡ex´
 
ušt16_t
 
	g¦Ùs_³r_buck‘
 = 3;

55 
cÚ¡ex´
 
ušt16_t
 
	gfšg”´št_Ën_b™s
 = 8;

56 
cÚ¡ex´
 
ušt16_t
 
	gÙa_Ën_b™s
 = 16;

57 
cÚ¡ex´
 
ušt16_t
 
	gblock_size_b™s
 = 512;

58 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio
 = 0.23958;

59 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så


60 ğ
FixedPošt
(
rg‘_com´essiÚ_¿tio
).
£rŸlize
();

62 
cÚ¡ex´
 
CouÁ”R—dM‘hodEnum
 
	g»ad_couÁ”s_m‘hod
 =

63 
CouÁ”R—dM‘hodEnum
::
READ_SIMPLE
;

64 
cÚ¡ex´
 
Fšg”´štR—dM‘hodEnum
 
	g»ad_fšg”´šts_m‘hod
 =

65 
Fšg”´štR—dM‘hodEnum
::
READ_SIMPLE
;

66 
cÚ¡ex´
 
ReduùiÚM‘hodEnum
 
	g»duùiÚ_m‘hod
 =

67 
ReduùiÚM‘hodEnum
::
POP_CNT
;

68 
cÚ¡ex´
 
AÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
 
	g®‹º©e_buck‘_£ËùiÚ_m‘hod
=

69 
AÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
FUNCTION_BASED_OFFSET
;

70 
cÚ¡ex´
 
Ov”æowT¿ckšgA¼ayHashšgM‘hodEnum
 
	gmÜtÚ_Ùa_hashšg_m‘hod
 =

71 
Ov”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
CLUSTERED_BUCKET_HASH
;

72 
cÚ¡ex´
 
boŞ
 
	g»sizšg_’abËd
 = 
çl£
;

73 
cÚ¡ex´
 
boŞ
 
	g»m­_’abËd
 = 
Œue
;

74 
cÚ¡ex´
 
boŞ
 
	gcŞlisiÚ_»sŞutiÚ_’abËd
 = 
Œue
;

75 
cÚ¡ex´
 
boŞ
 
	gmÜtÚ_f‹r_funùiÚ®™y_’abËd
 = 
Œue
;

76 
cÚ¡ex´
 
boŞ
 
	gblock_fuÎÃss_¬¿y_’abËd
 = 
çl£
;

77 
cÚ¡ex´
 
boŞ
 
	ghªdË_cÚæiùs
 = 
Œue
;

78 
cÚ¡ex´
 
Fšg”´štCom·risÚM‘hodEnum
 
	gfšg”´št_com·risÚ_m‘hod
 =

79 
Fšg”´štCom·risÚM‘hodEnum
::
VARIABLE_COUNT
;

	@benchmarking/benchmark_ss_cf.cc

37 
	~"b’chm¬k_ut.h
"

38 
	~"veùÜ_ty³s.h
"

39 
	~"b’chm¬k_commÚ.h
"

40 
	~"cuckoof‹r.h
"

42 
usšg
 
Çme¥aû
 
	gB’chm¬k
;

44 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

45 
	$b’chm¬k_š£¹iÚs
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
){

46 
ušt64_t
 
tÙ®_buck‘s
 = 
tÙ®_¦Ùs
 / 4;

47 
cuckoof‹r
::
CuckooF‹r
<
ušt64_t
, 
fšg”´št_Ën_b™s
,

48 
cuckoof‹r
::
PackedTabË
> 
	`cf
(
tÙ®_buck‘s
, 
çl£
);

50 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_¦Ùs
);

51 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
);

53 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 = 
rg‘_lf
 * 
tÙ®_¦Ùs
;

54 
ušt64_t
 
i
 = 0; i < 
™ems_to_š£¹_to_h™_lf_rg‘
; i++){

55 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

59 
ušt64_t
 
£cÚd¬y_š£¹_couÁ
 = 
tÙ®_¦Ùs
 * 
¦Ù_äaùiÚ
;

61 
time_pošt
 
¡¬t
 = 
	`now
();

62 
ušt64_t
 
i
 = 
™ems_to_š£¹_to_h™_lf_rg‘
; i < i‹ms_to_š£¹_to_h™_lf_rg‘ + 
£cÚd¬y_š£¹_couÁ
; i++){

63 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

65 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 = std::chrÚo::
du¿tiÚ_ÿ¡
<¡d::chrÚo::du¿tiÚ<>>(
	`now
(è- 
¡¬t
);

67  
£cÚd¬y_š£¹_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

68 
	}
}

70 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

71 
	$b’chm¬k_d–‘iÚs
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
){

72 
ušt64_t
 
tÙ®_buck‘s
 = 
tÙ®_¦Ùs
 / 4;

73 
cuckoof‹r
::
CuckooF‹r
<
ušt64_t
, 
fšg”´št_Ën_b™s
,

74 
cuckoof‹r
::
PackedTabË
> 
	`cf
(
tÙ®_buck‘s
, 
çl£
);

77 
ušt64_t
 
d–‘e_couÁ
 = 
tÙ®_¦Ùs
 * 
¦Ù_äaùiÚ
;

79 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_¦Ùs
 * 
rg‘_lf
);

80 
¡d
::
veùÜ
<
keys_t
> 
	`d–‘e_™ems
(
d–‘e_couÁ
);

83 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
d–‘e_™ems
, 1.0, 0);

85 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 = 
rg‘_lf
 * 
tÙ®_¦Ùs
;

86 
ušt64_t
 
i
 = 0; i < 
™ems_to_š£¹_to_h™_lf_rg‘
; i++){

87 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

90 
time_pošt
 
¡¬t
 = 
	`now
();

91 
ušt64_t
 
i
 = 0; i < 
d–‘e_couÁ
; i++){

92 
cf
.
	`D–‘e
(
d–‘e_™ems
[
i
]);

94 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 = std::chrÚo::
du¿tiÚ_ÿ¡
<¡d::chrÚo::du¿tiÚ<>>(
	`now
(è- 
¡¬t
);

96  
d–‘e_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

97 
	}
}

99 
	g‹m¶©e
<
ušt64_t
 
	gfšg”´št_Ën_b™s
>

100 
	$b’chm¬k_lookups
(
ušt64_t
 
tÙ®_¦Ùs
, 
rg‘_lf
,

101 
ov”Ïp
){

102 
ušt64_t
 
tÙ®_buck‘s
 = 
tÙ®_¦Ùs
 / 4;

103 
cuckoof‹r
::
CuckooF‹r
<
ušt64_t
, 
fšg”´št_Ën_b™s
,

104 
cuckoof‹r
::
PackedTabË
> 
	`cf
(
tÙ®_buck‘s
, 
çl£
);

107 
ušt64_t
 
lookup_couÁ
 = 
tÙ®_¦Ùs
 * 
¦Ù_äaùiÚ
;

109 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_¦Ùs
 * 
rg‘_lf
);

110 
¡d
::
veùÜ
<
keys_t
> 
	`´obe_™ems
(
lookup_couÁ
);

113 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
´obe_™ems
, 
ov”Ïp
, 0);

115 
ušt64_t
 
™ems_to_š£¹_to_h™_lf_rg‘
 = 
rg‘_lf
 * 
tÙ®_¦Ùs
;

116 
ušt64_t
 
i
 = 0; i < 
™ems_to_š£¹_to_h™_lf_rg‘
; i++){

117 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

120 
time_pošt
 
¡¬t
 = 
	`now
();

121 
ušt64_t
 
i
 = 0; i < 
lookup_couÁ
; i++){

122 
cf
.
	`CÚš
(
´obe_™ems
[
i
]);

124 
¡d
::
chrÚo
::
du¿tiÚ
<> 
diff
 = std::chrÚo::
du¿tiÚ_ÿ¡
<¡d::chrÚo::du¿tiÚ<>>(
	`now
(è- 
¡¬t
);

126  
lookup_couÁ
 / (
diff
.
	`couÁ
() * 1e6);

127 
	}
}

129 
	$maš
(
¬gc
, ** 
¬gv
){

130 
cÚ¡ex´
 
ušt64_t
 
fšg”´št_Ën_b™s
 = 13;

131 
cÚ¡ex´
 
ušt64_t
 
tÙ®_¦Ùs
 = 128 * 1024 * 1024;

132 
¡d
::
veùÜ
<> 
lfs
 = {0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40,

136 
¡d
::
veùÜ
<> 
	`d–‘e_throughputs
(
lfs
.
	`size
());

137 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT\n";

138 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

139 
lf
 = 
lfs
[
i
];

140 
d–‘e_throughputs
[
i
] = 
b’chm¬k_d–‘iÚs
<
fšg”´št_Ën_b™s
>(

141 
tÙ®_¦Ùs
, 
lf
);

142 
¡d
::
cout
 << "SF " << 
lf
 << " DELETE " << 
d–‘e_throughputs
[
i
] << std::
’dl
;

146 
ušt64_t
 
g¿d©iÚs
 = 1.0;

147 
¡d
::
veùÜ
<> 
	`lookup_throughputs
(
lfs
.
	`size
());

148 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT %%TRUE_POSITIVE\n";

149 
ušt64_t
 
g
 = 0; g <ğ
g¿d©iÚs
; g++){

150 
Œue_pos™ive
 = (1.0 * 
g
è/ 
g¿d©iÚs
;

151 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

152 
lf
 = 
lfs
[
i
];

153 
lookup_throughputs
[
i
] = 
b’chm¬k_lookups
<
fšg”´št_Ën_b™s
>(

154 
tÙ®_¦Ùs
, 
lf
, 
Œue_pos™ive
);

155 
¡d
::
cout
 << "SF " << 
lf
 << " LOOKUP " << 
lookup_throughputs
[
i
] << " " << 
Œue_pos™ive
 << std::
’dl
;

160 
¡d
::
veùÜ
<> 
	`š£¹_throughputs
(
lfs
.
	`size
());

161 
¡d
::
cout
 << "FILTER LOAD OPERATION THROUGHPUT\n";

162 
ušt64_t
 
i
 = 0; i < 
lfs
.
	`size
(); i++){

163 
lf
 = 
lfs
[
i
];

164 
š£¹_throughputs
[
i
] = 
b’chm¬k_š£¹iÚs
<
fšg”´št_Ën_b™s
>(

165 
tÙ®_¦Ùs
, 
lf
);

166 
¡d
::
cout
 << "SF " << 
lf
 << " INSERT " << 
š£¹_throughputs
[
i
] << std::
’dl
;

171 
	}
}

	@benchmarking/benchmark_util.h

37 #iâdeà
_BENCHMARK_UTIL_H


38 
	#_BENCHMARK_UTIL_H


	)

40 
	~<chrÚo
>

41 
	~<c¡dšt
>

42 
	~<veùÜ
>

43 
	~<¿ndom
>

44 
	~<s¡»am
>

46 
Çme¥aû
 
	gB’chm¬k
{

48 
£t_»giÚ_Çme
(
¡d
::
¡ršg
& 
»giÚ_Çme
, cÚ¡ std::¡ršg& 
ba£_Çme
,

49 
lßd_çùÜ
, 
Œue_pos™ive_¿tio
){

50 
	g¡d
::
¡ršg¡»am
 
ss
;

51 
	gss
 << 
	gba£_Çme
 << "_LF" << 
	glßd_çùÜ
 << "_TPR" << 
	gŒue_pos™ive_¿tio
;

52 
	g»giÚ_Çme
 = 
ss
.
¡r
();

55 
ušt64_t
 
to_muÉË_of_b©ch
(ušt64_ˆ
numb”
, ušt64_ˆ
b©ch_size
){

56  ((
	gnumb”
 + 
	gb©ch_size
 - 1) / batch_size) * batch_size;

61 
	g‹m¶©e
 <
şass
 
	gT
>

62 
pİuÏ‹_w™h_¿ndom_numb”s
(
¡d
::
veùÜ
<
T
>& 
™ems
){

63 
¡d
::
deçuÉ_¿ndom_’gše
 
º_g’
;

64 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
T
> 
di¡ributiÚ
(
¡©ic_ÿ¡
<T>(0),

65 ~
¡©ic_ÿ¡
<
T
>(0));

66 
ušt64_t
 
	gi
 = 0; i < 
	g™ems
.
ÿ·c™y
(); i++){

67 
	g™ems
[
i
] = 
di¡ributiÚ
(
º_g’
);

85 
	g‹m¶©e
 <
şass
 
	gT
>

86 
pİuÏ‹_w™h_¿ndom_numb”s
(
¡d
::
veùÜ
<
T
>& 
š£¹_™ems
,

87 
¡d
::
veùÜ
<
T
>& 
´obe_™ems
, 
ov”Ïp
, 
boŞ
 
du¶iÿ‹s_³rm™‹d
){

88 
	g¡d
::
deçuÉ_¿ndom_’gše
 
º_g’
;

90 
ušt64_t
 
	g¿nge_max
 = 
¡d
::
mš
<
T
>((1ULL << 34ULLè- 1, ~
	g¡©ic_ÿ¡
<
	gT
>(0));

91 
	g¡d
::
veùÜ
<
boŞ
> 
š£¹_™ems_b™_veùÜ
(
¿nge_max
 + 1, 0);

94 
ušt64_t
 
	g´obe_™ems_b™_veùÜ_ÿ·c™y
 = 
du¶iÿ‹s_³rm™‹d
 ? 0 :

95 
¿nge_max
 + 1;

96 
	g¡d
::
veùÜ
<
boŞ
> 
´obe_™ems_b™_veùÜ
(
´obe_™ems_b™_veùÜ_ÿ·c™y
, 0);

98 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
T
> 
di¡ributiÚ
(
¡©ic_ÿ¡
<T>(0), 
¿nge_max
);

101 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
ušt64_t
> 
m­_di¡ributiÚ
(0ULL, 
š£¹_™ems
.
ÿ·c™y
() - 1);

103 
ušt64_t
 
	gi
 = 0; i < 
	gš£¹_™ems
.
ÿ·c™y
(); i++){

104 
	gš£¹_™ems
[
i
] = 
di¡ributiÚ
(
º_g’
);

105 
	gš£¹_™ems_b™_veùÜ
[
š£¹_™ems
[
i
]] = 
Œue
;

107 
ušt64_t
 
	gi
 = 0; i < 
	g´obe_™ems
.
ÿ·c™y
(); i++){

108 if(
di¡ributiÚ
(
º_g’
è< 
	gov”Ïp
 * (
	g¿nge_max
 + 1)){

109 
T
 
	gÿndid©e_´obe_™em
;

111 
	gÿndid©e_´obe_™em
 = 
š£¹_™ems
[
m­_di¡ributiÚ
(
º_g’
)];

114 } !
	gdu¶iÿ‹s_³rm™‹d
 &&

115 
	g´obe_™ems_b™_veùÜ
[
ÿndid©e_´obe_™em
]);

116 
	g´obe_™ems
[
i
] = 
ÿndid©e_´obe_™em
;

117 if(!
	gdu¶iÿ‹s_³rm™‹d
){

118 
	g´obe_™ems_b™_veùÜ
[
ÿndid©e_´obe_™em
] = 
Œue
;

122 
T
 
	g™em
;

123 
boŞ
 
	g™em_š_š£¹_™ems
;

125 
	g™em
 = 
di¡ributiÚ
(
º_g’
);

126 
	g™em_š_š£¹_™ems
 = 
š£¹_™ems_b™_veùÜ
[
™em
];

127 } 
	g™em_š_š£¹_™ems
);

128 
	g´obe_™ems
[
i
] = 
™em
;

135 
	g‹m¶©e
 <
şass
 
	gT
>

136 
	sRN_G’
{

137 
	g¡d
::
deçuÉ_¿ndom_’gše
 
m_º_g’
;

138 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
T
> 
m_di¡ributiÚ
;

139 
cÚ¡ex´
 
RN_G’
(
T
 
¿nge_¡¬t
, T 
¿nge_¡İ
è: 
m_º_g’
(),

140 
m_di¡ributiÚ
(
¿nge_¡¬t
, 
¿nge_¡İ
){}

141 
šlše
 
T
 
Ãxt
(){  
m_di¡ributiÚ
(
m_º_g’
); }

144 
	g¡d
::
	tchrÚo
::
	thigh_»sŞutiÚ_şock
::
	ttime_pošt
ime_point;

145 
__šlše
 
time_pošt
 
now
(){

146  
	g¡d
::
chrÚo
::
high_»sŞutiÚ_şock
::
now
();

	@benchmarking/cuckoofilter/benchmarks/bulk-insert-and-query.cc

50 
	~<şim™s
>

51 
	~<iomª
>

52 
	~<m­
>

53 
	~<¡dexû±
>

54 
	~<veùÜ
>

56 
	~"cuckoof‹r.h
"

57 
	~"¿ndom.h
"

58 
	~"simd-block.h
"

59 
	~"timšg.h
"

61 
usšg
 
Çme¥aû
 
	g¡d
;

63 
usšg
 
Çme¥aû
 
	gcuckoof‹r
;

66 cÚ¡ 
size_t
 
	gSAMPLE_SIZE
 = 1000 * 1000;

69 
	sSti¡ics
 {

70 
	madds_³r_Çno
;

71 
	mm­
<, > 
	mfšds_³r_Çno
;

73 
	mçl£_pos™ive_´obabty
;

74 
	mb™s_³r_™em
;

82 
¡ršg
 
	$Sti¡icsTabËH—d”
(
ty³_width
, 
fšd_³rûÁ_couÁ
) {

83 
o¡ršg¡»am
 
os
;

85 
os
 << 
	`¡ršg
(
ty³_width
, ' ');

86 
os
 << 
	`£tw
(12è<< 
right
 << "Million";

87 
i
 = 0; i < 
fšd_³rûÁ_couÁ
; ++i) {

88 
os
 << 
	`£tw
(8) << "Find";

90 
os
 << 
	`£tw
(8) << "" << setw(11) << "" << setw(11)

91 << "İtim®" << 
	`£tw
(8è<< "wa¡ed" << 
’dl
;

93 
os
 << 
	`¡ršg
(
ty³_width
, ' ');

94 
os
 << 
	`£tw
(12è<< 
right
 << "adds/sec";

95 
i
 = 0; i < 
fšd_³rûÁ_couÁ
; ++i) {

96 
os
 << 
	`£tw
(7)

97 << 
¡©ic_ÿ¡
<>(100 * 
i
 / stic_ÿ¡<>(
fšd_³rûÁ_couÁ
 - 1)) << '%';

99 
os
 << 
	`£tw
(9) << "Îµ" << setw(11) << "bits/item" << setw(11)

100 << "b™s/™em" << 
	`£tw
(8) << "space";

101  
os
.
	`¡r
();

102 
	}
}

105 
	g‹m¶©e
 <
şass
 
	gCh¬T
, cÏs 
	gT¿™s
>

106 
	gbasic_o¡»am
<
	gCh¬T
, 
	gT¿™s
>& 
	gİ”©Ü
<<(

107 
	gbasic_o¡»am
<
	gCh¬T
, 
	gT¿™s
>& 
	gos
, cÚ¡ 
	gSti¡ics
& 
	g¡©s
) {

108 
cÚ¡ex´
 
	gNANOS_PER_MILLION
 = 1000;

109 
	gos
 << 
	gfixed
 << 
£»cisiÚ
(2è<< 
£tw
(12è<< 
	gright


110 << 
	g¡©s
.
adds_³r_Çno
 * 
	gNANOS_PER_MILLION
;

111 cÚ¡‡uto& 
	gås
 : 
¡©s
.
fšds_³r_Çno
) {

112 
os
 << 
£tw
(8è<< 
ås
.
£cÚd
 * 
NANOS_PER_MILLION
;

114 cÚ¡‡utØ
	gmšb™s
 = 
log2
(1 / 
¡©s
.
çl£_pos™ive_´obabty
);

115 
	gos
 << 
£tw
(7è<< 
£»cisiÚ
(3è<< 
	g¡©s
.
	gçl£_pos™ive_´obabty
 * 100 << '%'

116 << 
£tw
(11è<< 
£»cisiÚ
(2è<< 
	g¡©s
.
	gb™s_³r_™em
 << s‘w(11è<< 
	gmšb™s


117 << 
£tw
(7è<< 
£»cisiÚ
(1è<< 100 * (
	g¡©s
.
	gb™s_³r_™em
 / 
	gmšb™s
 - 1) << '%';

119  
	gos
;

122 
	g‹m¶©e
<
ty³Çme
 
	gTabË
>

123 
	sF‹rAPI
 {};

125 
	g‹m¶©e
 <
ty³Çme
 
	gI‹mTy³
, 
size_t
 
	gb™s_³r_™em
,em¶©<
	gsize_t
> 
şass
 
	gTabËTy³
>

126 
	gF‹rAPI
<
	gCuckooF‹r
<
	gI‹mTy³
, 
	gb™s_³r_™em
, 
	gTabËTy³
>> {

127 
usšg
 
	gTabË
 = 
CuckooF‹r
<
I‹mTy³
, 
	gb™s_³r_™em
, 
	gTabËTy³
>;

128 
TabË
 
CÚ¡ruùFromAddCouÁ
(
size_t
 
add_couÁ
) {  Table(add_count); }

129 
Add
(
ušt64_t
 
key
, 
TabË
 * 
bË
) {

130 ià(0 !ğ
bË
->
Add
(
key
)) {

131 
throw
 
logic_”rÜ
("The filter isoo smallo hold‡ll ofheƒlements");

134 
boŞ
 
CÚš
(
ušt64_t
 
key
, cÚ¡ 
TabË
 * 
bË
) {

135  (0 =ğ
bË
->
CÚš
(
key
));

139 
	g‹m¶©e
 <>

140 
	gF‹rAPI
<
	gSimdBlockF‹r
<>> {

141 
usšg
 
	gTabË
 = 
SimdBlockF‹r
<>;

142 
TabË
 
CÚ¡ruùFromAddCouÁ
(
size_t
 
add_couÁ
) {

143 
TabË
 
ªs
(
û
(
log2
(
add_couÁ
 * 8.0 / 
CHAR_BIT
)));

144  
	gªs
;

146 
Add
(
ušt64_t
 
key
, 
TabË
* 
bË
) {

147 
	gbË
->
Add
(
key
);

149 
boŞ
 
CÚš
(
ušt64_t
 
key
, cÚ¡ 
TabË
 * 
bË
) {

150  
	gbË
->
Fšd
(
key
);

154 
	g‹m¶©e
 <
ty³Çme
 
	gTabË
>

155 
Sti¡ics
 
F‹rB’chm¬k
(

156 
size_t
 
add_couÁ
, cÚ¡ 
veùÜ
<
ušt64_t
>& 
to_add
, cÚ¡ veùÜ<ušt64_t>& 
to_lookup
) {

157 ià(
	gadd_couÁ
 > 
	gto_add
.
size
()) {

158 
throw
 
out_of_¿nge
("to_add must contain‡t†east‡dd_count values");

161 ià(
	gSAMPLE_SIZE
 > 
	gto_lookup
.
size
()) {

162 
throw
 
out_of_¿nge
("to_lookup must contain‡t†east SAMPLE_SIZE values");

165 
TabË
 
	gf‹r
 = 
F‹rAPI
<TabË>::
CÚ¡ruùFromAddCouÁ
(
add_couÁ
);

166 
Sti¡ics
 
	g»suÉ
;

169 autØ
	g¡¬t_time
 = 
NowNªos
();

170 
size_t
 
	gadded
 = 0;‡dded < 
	gadd_couÁ
; ++added) {

171 
	gF‹rAPI
<
	gTabË
>::
Add
(
to_add
[
added
], &
f‹r
);

173 
	g»suÉ
.
	gadds_³r_Çno
 = 
add_couÁ
 / 
¡©ic_ÿ¡
<>(
NowNªos
(è- 
¡¬t_time
);

174 
	g»suÉ
.
	gb™s_³r_™em
 = 
¡©ic_ÿ¡
<>(
CHAR_BIT
 * 
f‹r
.
SizeInBy‹s
()è/ 
add_couÁ
;

176 
size_t
 
	gfound_couÁ
 = 0;

177 cÚ¡ 
	gfound_´obab™y
 : {0.0, 0.25, 0.50, 0.75, 1.00}) {

178 cÚ¡‡utØ
	gto_lookup_mixed
 = 
MixIn
(&
to_lookup
[0], &to_lookup[
SAMPLE_SIZE
], &
to_add
[0],

179 &
to_add
[
add_couÁ
], 
found_´obab™y
);

180 cÚ¡‡utØ
	g¡¬t_time
 = 
NowNªos
();

181 cÚ¡‡utØ
	gv
 : 
to_lookup_mixed
) {

182 
found_couÁ
 +ğ
F‹rAPI
<
TabË
>::
CÚš
(
v
, &
f‹r
);

184 cÚ¡‡utØ
	glookup_time
 = 
NowNªos
(è- 
¡¬t_time
;

185 
	g»suÉ
.
	gfšds_³r_Çno
[100 * 
found_´obab™y
] =

186 
SAMPLE_SIZE
 / 
¡©ic_ÿ¡
<>(
lookup_time
);

187 ià(0.0 =ğ
found_´obab™y
) {

188 
»suÉ
.
çl£_pos™ive_´obabty
 =

189 
found_couÁ
 / 
¡©ic_ÿ¡
<>(
to_lookup_mixed
.
size
());

192  
	g»suÉ
;

195 
	$maš
(
¬gc
, * 
¬gv
[]) {

196 ià(
¬gc
 != 2) {

197 
û¼
 << "U§ge: " << 
¬gv
[0] << " $NUMBER" << 
’dl
;

200 
¡ršg¡»am
 
	`šput_¡ršg
(
¬gv
[1]);

201 
size_t
 
add_couÁ
;

202 
šput_¡ršg
 >> 
add_couÁ
;

203 ià(
šput_¡ršg
.
	`ç
()) {

204 
û¼
 << "Inv®id‚umb”: " << 
¬gv
[1];

208 cÚ¡ 
veùÜ
<
ušt64_t
> 
to_add
 = 
	`G’”©eRªdom64
(
add_couÁ
);

209 cÚ¡ 
veùÜ
<
ušt64_t
> 
to_lookup
 = 
	`G’”©eRªdom64
(
SAMPLE_SIZE
);

211 
cÚ¡ex´
 
NAME_WIDTH
 = 13;

213 
cout
 << 
	`Sti¡icsTabËH—d”
(
NAME_WIDTH
, 5è<< 
’dl
;

215 autØ
cf
 = 
F‹rB’chm¬k
<

216 
CuckooF‹r
<
ušt64_t
, 12 , 
SšgËTabË
 >>(

217 
add_couÁ
, 
to_add
, 
to_lookup
);

219 
cout
 << 
	`£tw
(
NAME_WIDTH
è<< "Cuckoo12" << 
cf
 << 
’dl
;

221 
cf
 = 
F‹rB’chm¬k
<

222 
CuckooF‹r
<
ušt64_t
, 13 , 
PackedTabË
 >>(

223 
add_couÁ
, 
to_add
, 
to_lookup
);

225 
cout
 << 
	`£tw
(
NAME_WIDTH
è<< "SemiSÜt13" << 
cf
 << 
’dl
;

227 
cf
 = 
F‹rB’chm¬k
<

228 
CuckooF‹r
<
ušt64_t
, 8 , 
SšgËTabË
 >>(

229 
add_couÁ
, 
to_add
, 
to_lookup
);

231 
cout
 << 
	`£tw
(
NAME_WIDTH
è<< "Cuckoo8" << 
cf
 << 
’dl
;

233 
cf
 = 
F‹rB’chm¬k
<

234 
CuckooF‹r
<
ušt64_t
, 9 , 
PackedTabË
 >>(

235 
add_couÁ
, 
to_add
, 
to_lookup
);

237 
cout
 << 
	`£tw
(
NAME_WIDTH
è<< "SemiSÜt9" << 
cf
 << 
’dl
;

239 
cf
 = 
F‹rB’chm¬k
<

240 
CuckooF‹r
<
ušt64_t
, 16 , 
SšgËTabË
 >>(

241 
add_couÁ
, 
to_add
, 
to_lookup
);

243 
cout
 << 
	`£tw
(
NAME_WIDTH
è<< "Cuckoo16" << 
cf
 << 
’dl
;

245 
cf
 = 
F‹rB’chm¬k
<

246 
CuckooF‹r
<
ušt64_t
, 17 , 
PackedTabË
 >>(

247 
add_couÁ
, 
to_add
, 
to_lookup
);

249 
cout
 << 
	`£tw
(
NAME_WIDTH
è<< "SemiSÜt17" << 
cf
 << 
’dl
;

251 
cf
 = 
F‹rB’chm¬k
<
SimdBlockF‹r
<>>(
add_couÁ
, 
to_add
, 
to_lookup
);

253 
cout
 << 
	`£tw
(
NAME_WIDTH
è<< "SimdBlock8" << 
cf
 << 
’dl
;

255 
	}
}

	@benchmarking/cuckoofilter/benchmarks/conext-figure5.cc

14 
	~<şim™s
>

15 
	~<iomª
>

16 
	~<veùÜ
>

18 
	~"cuckoof‹r.h
"

19 
	~"¿ndom.h
"

20 
	~"timšg.h
"

22 
usšg
 
Çme¥aû
 
	g¡d
;

24 
usšg
 
Çme¥aû
 
	gcuckoof‹r
;

27 cÚ¡ 
size_t
 
	gSAMPLE_SIZE
 = 1000 * 1000;

31 
	g‹m¶©e
 <
ty³Çme
 
	gTabË
>

32 
	g¬¿y
<, 5> 
CuckooB’chm¬k
(

33 
size_t
 
add_couÁ
, cÚ¡ 
veùÜ
<
ušt64_t
>& 
to_add
, cÚ¡ veùÜ<ušt64_t>& 
to_lookup
) {

34 
TabË
 
cuckoo
(
add_couÁ
);

35 
	g¬¿y
<, 5> 
	g»suÉ
;

38 
size_t
 
	gadded
 = 0;

39 
	gadded
 < 
	gto_add
.
size
(è&& 0 =ğ
cuckoo
.
Add
(
to_add
[
added
])) ++added;

42 
size_t
 
	gfound_couÁ
 = 0;

43 cÚ¡ 
	gfound_³rûÁ
 : {0.0, 0.25, 0.50, 0.75, 1.00}) {

44 cÚ¡‡utØ
	gto_lookup_mixed
 = 
MixIn
(&
to_lookup
[0], &to_lookup[
SAMPLE_SIZE
], &
to_add
[0],

45 &
to_add
[
added
], 
found_³rûÁ
);

46 autØ
	g¡¬t_time
 = 
NowNªos
();

47 cÚ¡‡utØ
	gv
 : 
to_lookup_mixed
è
found_couÁ
 +ğ(0 =ğ
cuckoo
.
CÚš
(
v
));

48 autØ
	glookup_time
 = 
NowNªos
(è- 
¡¬t_time
;

49 
	g»suÉ
[
found_³rûÁ
 * 4] = 
lookup_time
 / (1000.0 * 1000.0 * 1000.0);

51 ià(6 * 
	gSAMPLE_SIZE
 =ğ
found_couÁ
è
ex™
(1);

52  
	g»suÉ
;

55 
	$maš
() {

59 
size_t
 
add_couÁ
 = 127.78 * 1000 * 1000;

62 cÚ¡ 
size_t
 
max_add_couÁ
 = 2 * 
add_couÁ
;

63 cÚ¡ 
veùÜ
<
ušt64_t
> 
to_add
 = 
	`G’”©eRªdom64
(
max_add_couÁ
);

64 cÚ¡ 
veùÜ
<
ušt64_t
> 
to_lookup
 = 
	`G’”©eRªdom64
(
SAMPLE_SIZE
);

67 cÚ¡‡utØ
cf
 = 
CuckooB’chm¬k
<

68 
CuckooF‹r
<
ušt64_t
, 12 , 
SšgËTabË
 >>(

69 
add_couÁ
, 
to_add
, 
to_lookup
);

70 cÚ¡‡utØ
sscf
 = 
CuckooB’chm¬k
<

71 
CuckooF‹r
<
ušt64_t
, 13 , 
PackedTabË
 >>(

72 
add_couÁ
, 
to_add
, 
to_lookup
);

74 
cout
 << "fraction of queries onƒxisting items/lookuphroughput (million OPS) "

75 << 
’dl
;

76 
cout
 << 
	`£tw
(10) << ""

77 << " " << 
	`£tw
(10è<< 
right
 << "CF" << s‘w(10è<<„ighˆ<< "ss-CF" << 
’dl
;

78 cÚ¡ 
found_³rûÁ
 : {0.0, 0.25, 0.50, 0.75, 1.00}) {

79 
cout
 << 
fixed
 << 
	`£»cisiÚ
(2è<< 
	`£tw
(10è<< 
right
 << 100 * 
found_³rûÁ
 << "%";

80 
cout
 << 
	`£tw
(10è<< 
right
 << (
SAMPLE_SIZE
 / 
cf
[
found_³rûÁ
 * 4]) / (1000 * 1000);

81 
cout
 << 
	`£tw
(10è<< 
right
 << (
SAMPLE_SIZE
 / 
sscf
[
found_³rûÁ
 * 4]) / (1000 * 1000);

82 
cout
 << 
’dl
;

84 
	}
}

	@benchmarking/cuckoofilter/benchmarks/conext-table3.cc

13 
	~<şim™s
>

14 
	~<iomª
>

15 
	~<veùÜ
>

17 
	~"cuckoof‹r.h
"

18 
	~"¿ndom.h
"

19 
	~"timšg.h
"

21 
usšg
 
Çme¥aû
 
	g¡d
;

23 
usšg
 
Çme¥aû
 
	gcuckoof‹r
;

26 cÚ¡ 
size_t
 
	gFPR_SAMPLE_SIZE
 = 1000 * 1000;

28 
	sM‘rics
 {

29 
	madd_couÁ
;

30 
	m¥aû
;

31 
	mår
;

32 
	m¥“d
;

35 
	g‹m¶©e
<
ty³Çme
 
	gTabË
>

36 
M‘rics
 
CuckooB’chm¬k
(
size_t
 
add_couÁ
, cÚ¡ 
veùÜ
<
ušt64_t
>& 
šput
) {

37 
TabË
 
cuckoo
(
add_couÁ
);

38 autØ
	g¡¬t_time
 = 
NowNªos
();

41 
size_t
 
	gš£¹ed
 = 0;

42 
	gš£¹ed
 < 
	gšput
.
size
(è&& 0 =ğ
cuckoo
.
Add
(
šput
[
š£¹ed
])) ++inserted;

44 autØ
	gcÚ¡r_time
 = 
NowNªos
(è- 
¡¬t_time
;

47 
size_t
 
	gçl£_pos™ive_couÁ
 = 0;

48 
size_t
 
	gab£Á
 = 0;

49 ; 
	gš£¹ed
 + 
	gab£Á
 < 
	gšput
.
size
(è&&‡b£Á < 
	gFPR_SAMPLE_SIZE
; ++absent) {

50 
	gçl£_pos™ive_couÁ
 +ğ(0 =ğ
cuckoo
.
CÚš
(
šput
[
š£¹ed
 + 
ab£Á
]));

54 cÚ¡‡utØ
	gtime
 = 
cÚ¡r_time
 / 
¡©ic_ÿ¡
<>(1000 * 1000 * 1000);

55 
M‘rics
 
	g»suÉ
;

56 
	g»suÉ
.
	gadd_couÁ
 = 
¡©ic_ÿ¡
<>(
š£¹ed
) / (1000 * 1000);

57 
	g»suÉ
.
	g¥aû
 = 
¡©ic_ÿ¡
<>(
CHAR_BIT
 * 
cuckoo
.
SizeInBy‹s
()è/ 
š£¹ed
;

58 
	g»suÉ
.
	går
 = (100.0 * 
çl£_pos™ive_couÁ
è/ 
ab£Á
;

59 
	g»suÉ
.
	g¥“d
 = (
š£¹ed
 / 
time
) / (1000 * 1000);

60  
	g»suÉ
;

63 
	$maš
() {

67 cÚ¡ 
size_t
 
add_couÁ
 = 127.78 * 1000 * 1000;

70 cÚ¡ 
size_t
 
max_add_couÁ
 = 2 * 
add_couÁ
;

71 cÚ¡ 
veùÜ
<
ušt64_t
> 
šput
 = 
	`G’”©eRªdom64
(
max_add_couÁ
 + 
FPR_SAMPLE_SIZE
);

74 cÚ¡‡utØ
cf
 = 
CuckooB’chm¬k
<

75 
CuckooF‹r
<
ušt64_t
, 12 , 
SšgËTabË
 >>(

76 
add_couÁ
, 
šput
);

77 cÚ¡‡utØ
sscf
 = 
CuckooB’chm¬k
<

78 
CuckooF‹r
<
ušt64_t
, 13 , 
PackedTabË
 >>(

79 
add_couÁ
, 
šput
);

81 
cout
 << 
	`£tw
(35è<< 
Ëá
 << "m‘ric " << s‘w(10è<< 
right
 << "CF" << setw(10)

82 << "ss-CF" << 
’dl


83 << 
fixed
 << 
	`£»cisiÚ
(2è<< 
	`£tw
(35è<< 
Ëá
 << "# of items (million) "

84 << 
	`£tw
(10è<< 
right
 << 
cf
.
add_couÁ
 << s‘w(10è<< 
sscf
.add_couÁ << 
’dl


85 << 
	`£tw
(35è<< 
Ëá
 << "b™ ³¸™em " << s‘w(10è<< 
right
 << 
cf
.
¥aû


86 << 
	`£tw
(10è<< 
sscf
.
¥aû
 << 
’dl


87 << 
	`£tw
(35è<< 
Ëá
 << "çl£…os™iv¿‹ " << s‘w(9è<< 
right
 << 
cf
.
år
 << "%"

88 << 
	`£tw
(9è<< 
sscf
.
år
 << "%" << 
’dl


89 << 
	`£tw
(35è<< 
Ëá
 << "cÚ¡r. s³ed (mliÚ keys/£cè" << s‘w(10è<< 
right


90 << 
cf
.
¥“d
 << 
	`£tw
(10è<< 
sscf
.¥“d << 
’dl
;

91 
	}
}

	@benchmarking/cuckoofilter/benchmarks/random.h

3 #´agm¨
Úû


5 
	~<®gÜ™hm
>

6 
	~<c¡dšt
>

7 
	~<funùiÚ®
>

8 
	~<¿ndom
>

9 
	~<¡dexû±
>

10 
	~<veùÜ
>

13 ::
¡d
::
veùÜ
<::¡d::
ušt64_t
> 
	$G’”©eRªdom64
(::
¡d
::
size_t
 
couÁ
) {

14 ::
¡d
::
veùÜ
<::¡d::
ušt64_t
> 
	`»suÉ
(
couÁ
);

15 ::
¡d
::
¿ndom_deviû
 
¿ndom
;

21 autØ
g’¿nd
 = [&
¿ndom
]() {

22  
	`¿ndom
(è+ (
¡©ic_ÿ¡
<::
¡d
::
ušt64_t
>(random()) << 32);

24 ::
¡d
::
	`g’”©e
(
»suÉ
.
	`begš
(),„esuÉ.
	`’d
(), ::¡d::
	`»f
(
g’¿nd
));

25  
»suÉ
;

26 
	}
}

30 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

31 ::
¡d
::
veùÜ
<
T
> 
	$MixIn
(cÚ¡ 
T
* 
x_begš
, cÚ¡ T* 
x_’d
, cÚ¡ T* 
y_begš
, cÚ¡ T* 
y_’d
,

32 
y_´obab™y
) {

33 cÚ¡ 
size_t
 
x_size
 = 
x_’d
 - 
x_begš
, 
y_size
 = 
y_’d
 - 
y_begš
;

34 ià(
y_size
 > (1uÎ << 32)è
throw
 ::
¡d
::
	`Ëngth_”rÜ
("y isoo†ong");

35 ::
¡d
::
veùÜ
<
T
> 
	`»suÉ
(
x_begš
, 
x_’d
);

36 ::
¡d
::
¿ndom_deviû
 
¿ndom
;

37 autØ
g’¿nd
 = [&
¿ndom
, 
y_size
]() {

38  (
¡©ic_ÿ¡
<
size_t
>(
	`¿ndom
()è* 
y_size
) >> 32;

40 
size_t
 
i
 = 0; i < 
y_´obab™y
 * 
x_size
; ++i) {

41 
»suÉ
[
i
] = *(
y_begš
 + 
	`g’¿nd
());

43 ::
¡d
::
	`shufæe
(
»suÉ
.
	`begš
(),„esuÉ.
	`’d
(), 
¿ndom
);

44  
»suÉ
;

45 
	}
}

	@benchmarking/cuckoofilter/benchmarks/timing.h

3 #´agm¨
Úû


5 
	~<c¡dšt
>

6 
	~<chrÚo
>

8 ::
¡d
::
ušt64_t
 
	$NowNªos
() {

9  ::
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<::¡d::chrÚo::
Çno£cÚds
>(

10 ::
¡d
::
chrÚo
::
¡—dy_şock
::
	`now
().
	`time_sšû_•och
())

11 .
	`couÁ
();

12 
	}
}

	@benchmarking/cuckoofilter/example/test.cc

1 
	~"cuckoof‹r.h
"

3 
	~<as£¹.h
>

4 
	~<m©h.h
>

6 
	~<io¡»am
>

7 
	~<veùÜ
>

9 
usšg
 
	gcuckoof‹r
::
CuckooF‹r
;

11 
	$maš
(
¬gc
, **
¬gv
) {

12 
size_t
 
tÙ®_™ems
 = 1000000;

21 
CuckooF‹r
<
size_t
, 12> 
	`f‹r
(
tÙ®_™ems
);

24 
size_t
 
num_š£¹ed
 = 0;

25 
size_t
 
i
 = 0; i < 
tÙ®_™ems
; i++, 
num_š£¹ed
++) {

26 ià(
f‹r
.
	`Add
(
i
è!ğ
cuckoof‹r
::
Ok
) {

33 
size_t
 
i
 = 0; i < 
num_š£¹ed
; i++) {

34 
	`as£¹
(
f‹r
.
	`CÚš
(
i
è=ğ
cuckoof‹r
::
Ok
);

38 
size_t
 
tÙ®_qu”›s
 = 0;

39 
size_t
 
çl£_qu”›s
 = 0;

40 
size_t
 
i
 = 
tÙ®_™ems
; i < 2 *otal_items; i++) {

41 ià(
f‹r
.
	`CÚš
(
i
è=ğ
cuckoof‹r
::
Ok
) {

42 
çl£_qu”›s
++;

44 
tÙ®_qu”›s
++;

48 
¡d
::
cout
 << "false…ositive„ate is "

49 << 100.0 * 
çl£_qu”›s
 / 
tÙ®_qu”›s
 << "%\n";

52 
	}
}

	@benchmarking/cuckoofilter/src/bitsutil.h

1 #iâdeà
CUCKOO_FILTER_BITS_H_


2 
	#CUCKOO_FILTER_BITS_H_


	)

4 
Çme¥aû
 
	gcuckoof‹r
 {

8 
	#hasz”o4
(
x
è(((x)-0x1111ULLè& (~(x)è& 0x8888ULL)

	)

9 
	#hasv®ue4
(
x
, 
n
è(
	`hasz”o4
((xè^ (0x1111ULL * (n))))

	)

11 
	#hasz”o8
(
x
è(((x)-0x01010101ULLè& (~(x)è& 0x80808080ULL)

	)

12 
	#hasv®ue8
(
x
, 
n
è(
	`hasz”o8
((xè^ (0x01010101ULL * (n))))

	)

14 
	#hasz”o12
(
x
è(((x)-0x001001001001ULLè& (~(x)è& 0x800800800800ULL)

	)

15 
	#hasv®ue12
(
x
, 
n
è(
	`hasz”o12
((xè^ (0x001001001001ULL * (n))))

	)

17 
	#hasz”o16
(
x
) \

18 (((
x
)-0x0001000100010001ULLè& (~(x)è& 0x8000800080008000ULL)

	)

19 
	#hasv®ue16
(
x
, 
n
è(
	`hasz”o16
((xè^ (0x0001000100010001ULL * (n))))

	)

21 
šlše
 
ušt64_t
 
uµ”pow”2
(ušt64_ˆ
x
) {

22 
	gx
--;

23 
	gx
 |ğ
x
 >> 1;

24 
	gx
 |ğ
x
 >> 2;

25 
	gx
 |ğ
x
 >> 4;

26 
	gx
 |ğ
x
 >> 8;

27 
	gx
 |ğ
x
 >> 16;

28 
	gx
 |ğ
x
 >> 32;

29 
	gx
++;

30  
	gx
;

	@benchmarking/cuckoofilter/src/cuckoofilter.h

1 #iâdeà
CUCKOO_FILTER_CUCKOO_FILTER_H_


2 
	#CUCKOO_FILTER_CUCKOO_FILTER_H_


	)

4 
	~<as£¹.h
>

6 
	~"debug.h
"

7 
	~"hashut.h
"

8 
	~"·ckedbË.h
"

9 
	~"´štut.h
"

10 
	~"sšgËbË.h
"

12 
Çme¥aû
 
	gcuckoof‹r
 {

14 
	eStus
 {

15 
	gOk
 = 0,

16 
	gNÙFound
 = 1,

17 
	gNÙEnoughS·û
 = 2,

18 
	gNÙSuµÜ‹d
 = 3,

22 cÚ¡ 
size_t
 
	gkMaxCuckooCouÁ
 = 500;

31 
	g‹m¶©e
 <
ty³Çme
 
	gI‹mTy³
, 
size_t
 
	gb™s_³r_™em
,

32 
	g‹m¶©e
 <
	gsize_t
> 
şass
 
	gTabËTy³
 = 
SšgËTabË
,

33 
ty³Çme
 
	gHashFamy
 = 
TwoInd•’d’tMuÉlyShiá
>

34 şas 
	cCuckooF‹r
 {

36 
TabËTy³
<
b™s_³r_™em
> *
bË_
;

39 
size_t
 
	gnum_™ems_
;

42 
size_t
 
	gšdex
;

43 
ušt32_t
 
	gg
;

44 
boŞ
 
	gu£d
;

45 } 
	tViùimCache
;

47 
ViùimCache
 
	gviùim_
;

49 
HashFamy
 
	ghash”_
;

51 
šlše
 
size_t
 
IndexHash
(
ušt32_t
 
hv
) const {

55  
	ghv
 & (
	gbË_
->
NumBuck‘s
() - 1);

58 
šlše
 
ušt32_t
 
TagHash
(ušt32_ˆ
hv
) const {

59 
ušt32_t
 
	gg
;

60 
	gg
 = 
hv
 & ((1ULL << 
b™s_³r_™em
) - 1);

61 
	gg
 +ğ(
g
 == 0);

62  
	gg
;

65 
šlše
 
G’”©eIndexTagHash
(cÚ¡ 
I‹mTy³
& 
™em
, 
size_t
* 
šdex
,

66 
ušt32_t
* 
g
) const {

67 cÚ¡ 
ušt64_t
 
	ghash
 = 
hash”_
(
™em
);

68 *
	gšdex
 = 
IndexHash
(
hash
 >> 32);

69 *
	gg
 = 
TagHash
(
hash
);

72 
šlše
 
size_t
 
AÉIndex
(cÚ¡ size_ˆ
šdex
, cÚ¡ 
ušt32_t
 
g
) const {

77  
IndexHash
((
ušt32_t
)(
šdex
 ^ (
g
 * 0x5bd1e995)));

80 
Stus
 
AddIm¶
(cÚ¡ 
size_t
 
i
, cÚ¡ 
ušt32_t
 
g
);

83 
LßdFaùÜ
(ècÚ¡ {  1.0 * 
Size
(è/ 
	gbË_
->
SizeInTags
(); }

85 
B™sP”I‹m
(ècÚ¡ {  8.0 * 
	gbË_
->
SizeInBy‹s
(è/ 
Size
(); }

87 
	gpublic
:

88 
ex¶ic™
 
CuckooF‹r
(cÚ¡ 
size_t
 
max_num_keys
è: 
num_™ems_
(0), 
viùim_
(), 
hash”_
() {

89 
size_t
 
	gassoc
 = 4;

90 
size_t
 
	gnum_buck‘s
 = 
uµ”pow”2
(
max_num_keys
 / 
assoc
);

91 
	gäac
 = ()
max_num_keys
 / 
num_buck‘s
 / 
assoc
;

92 ià(
	gäac
 > 0.96) {

93 
	gnum_buck‘s
 <<= 1;

95 
	gviùim_
.
	gu£d
 = 
çl£
;

96 
	gbË_
 = 
Ãw
 
TabËTy³
<
b™s_³r_™em
>(
num_buck‘s
);

101 
CuckooF‹r
(cÚ¡ 
size_t
 
buck‘s_š_bË
,

102 
boŞ
 
viùim_ÿche_u£d
è: 
num_™ems_
(0), 
viùim_
(), 
hash”_
(){

103 
	gviùim_
.
	gu£d
 = 
viùim_ÿche_u£d
;

104 
	gbË_
 = 
Ãw
 
TabËTy³
<
b™s_³r_™em
>(
buck‘s_š_bË
);

107 ~
CuckooF‹r
(è{ 
d–‘e
 
	gbË_
; }

110 
Stus
 
Add
(cÚ¡ 
I‹mTy³
 &
™em
);

113 
Stus
 
CÚš
(cÚ¡ 
I‹mTy³
 &
™em
) const;

116 
Stus
 
D–‘e
(cÚ¡ 
I‹mTy³
 &
™em
);

120 
	g¡d
::
¡ršg
 
Info
() const;

123 
size_t
 
Size
(ècÚ¡ {  
	gnum_™ems_
; }

126 
size_t
 
SizeInBy‹s
(ècÚ¡ {  
	gbË_
->SizeInBytes(); }

129 
	g‹m¶©e
 <
ty³Çme
 
	gI‹mTy³
, 
size_t
 
	gb™s_³r_™em
,

130 
	g‹m¶©e
 <
	gsize_t
> 
şass
 
	gTabËTy³
, 
ty³Çme
 
	gHashFamy
>

131 
Stus
 
	gCuckooF‹r
<
	gI‹mTy³
, 
	gb™s_³r_™em
, 
	gTabËTy³
, 
	gHashFamy
>::
	$Add
(

132 cÚ¡ 
I‹mTy³
 &
™em
) {

133 
size_t
 
i
;

134 
ušt32_t
 
g
;

136 ià(
viùim_
.
u£d
) {

137  
NÙEnoughS·û
;

140 
	`G’”©eIndexTagHash
(
™em
, &
i
, &
g
);

141  
	`AddIm¶
(
i
, 
g
);

142 
	}
}

144 
	g‹m¶©e
 <
ty³Çme
 
	gI‹mTy³
, 
size_t
 
	gb™s_³r_™em
,

145 
	g‹m¶©e
 <
	gsize_t
> 
şass
 
	gTabËTy³
, 
ty³Çme
 
	gHashFamy
>

146 
Stus
 
	gCuckooF‹r
<
	gI‹mTy³
, 
	gb™s_³r_™em
, 
	gTabËTy³
, 
	gHashFamy
>::
	$AddIm¶
(

147 cÚ¡ 
size_t
 
i
, cÚ¡ 
ušt32_t
 
g
) {

148 
size_t
 
curšdex
 = 
i
;

149 
ušt32_t
 
cu¹ag
 = 
g
;

150 
ušt32_t
 
Şdg
;

152 
ušt32_t
 
couÁ
 = 0; couÁ < 
kMaxCuckooCouÁ
; count++) {

153 
boŞ
 
kickout
 = 
couÁ
 > 0;

154 
Şdg
 = 0;

155 ià(
bË_
->
	`In£¹TagToBuck‘
(
curšdex
, 
cu¹ag
, 
kickout
, 
Şdg
)) {

156 
num_™ems_
++;

157  
Ok
;

159 ià(
kickout
) {

160 
cu¹ag
 = 
Şdg
;

162 
curšdex
 = 
	`AÉIndex
(curšdex, 
cu¹ag
);

165 
viùim_
.
šdex
 = 
curšdex
;

166 
viùim_
.
g
 = 
cu¹ag
;

167 
viùim_
.
u£d
 = 
Œue
;

168  
Ok
;

169 
	}
}

171 
	g‹m¶©e
 <
ty³Çme
 
	gI‹mTy³
, 
size_t
 
	gb™s_³r_™em
,

172 
	g‹m¶©e
 <
	gsize_t
> 
şass
 
	gTabËTy³
, 
ty³Çme
 
	gHashFamy
>

173 
Stus
 
	gCuckooF‹r
<
	gI‹mTy³
, 
	gb™s_³r_™em
, 
	gTabËTy³
, 
	gHashFamy
>::
	$CÚš
(

174 cÚ¡ 
I‹mTy³
 &
key
) const {

175 
boŞ
 
found
 = 
çl£
;

176 
size_t
 
i1
, 
i2
;

177 
ušt32_t
 
g
;

179 
	`G’”©eIndexTagHash
(
key
, &
i1
, &
g
);

180 
i2
 = 
	`AÉIndex
(
i1
, 
g
);

182 
	`as£¹
(
i1
 =ğ
	`AÉIndex
(
i2
, 
g
));

184 
found
 = 
viùim_
.
u£d
 && (
g
 == victim_.tag) &&

185 (
i1
 =ğ
viùim_
.
šdex
 || 
i2
 == victim_.index);

187 ià(
found
 || 
bË_
->
	`FšdTagInBuck‘s
(
i1
, 
i2
, 
g
)) {

188  
Ok
;

190  
NÙFound
;

192 
	}
}

194 
	g‹m¶©e
 <
ty³Çme
 
	gI‹mTy³
, 
size_t
 
	gb™s_³r_™em
,

195 
	g‹m¶©e
 <
	gsize_t
> 
şass
 
	gTabËTy³
, 
ty³Çme
 
	gHashFamy
>

196 
Stus
 
	gCuckooF‹r
<
	gI‹mTy³
, 
	gb™s_³r_™em
, 
	gTabËTy³
, 
	gHashFamy
>::
	$D–‘e
(

197 cÚ¡ 
I‹mTy³
 &
key
) {

198 
size_t
 
i1
, 
i2
;

199 
ušt32_t
 
g
;

201 
	`G’”©eIndexTagHash
(
key
, &
i1
, &
g
);

202 
i2
 = 
	`AÉIndex
(
i1
, 
g
);

204 ià(
bË_
->
	`D–‘eTagFromBuck‘
(
i1
, 
g
)) {

205 
num_™ems_
--;

206 
TryElimš©eViùim
;

207 } ià(
bË_
->
	`D–‘eTagFromBuck‘
(
i2
, 
g
)) {

208 
num_™ems_
--;

209 
TryElimš©eViùim
;

210 } ià(
viùim_
.
u£d
 && 
g
 == victim_.tag &&

211 (
i1
 =ğ
viùim_
.
šdex
 || 
i2
 == victim_.index)) {

213 
viùim_
.
u£d
 = 
çl£
;

214  
Ok
;

216  
NÙFound
;

218 
TryElimš©eViùim
:

219 ià(
viùim_
.
u£d
) {

220 
viùim_
.
u£d
 = 
çl£
;

221 
size_t
 
i
 = 
viùim_
.
šdex
;

222 
ušt32_t
 
g
 = 
viùim_
.tag;

223 
	`AddIm¶
(
i
, 
g
);

225  
Ok
;

226 
	}
}

228 
	g‹m¶©e
 <
ty³Çme
 
	gI‹mTy³
, 
size_t
 
	gb™s_³r_™em
,

229 
	g‹m¶©e
 <
	gsize_t
> 
şass
 
	gTabËTy³
, 
ty³Çme
 
	gHashFamy
>

230 
	g¡d
::
¡ršg
 
CuckooF‹r
<
I‹mTy³
, 
	gb™s_³r_™em
, 
	gTabËTy³
, 
	gHashFamy
>::
	$Info
() const {

231 
¡d
::
¡ršg¡»am
 
ss
;

232 
ss
 << "CuckooFilter Status:\n"

233 << "\t\t" << 
bË_
->
	`Info
() << "\n"

234 << "\t\tKey ¡Üed: " << 
	`Size
() << "\n"

235 << "\t\tLßd faùÜ: " << 
	`LßdFaùÜ
() << "\n"

236 << "\t\tHashbË size: " << (
bË_
->
	`SizeInBy‹s
() >> 10) << " KB\n";

237 ià(
	`Size
() > 0) {

238 
ss
 << "\t\tb™/key: " << 
	`B™sP”I‹m
() << "\n";

240 
ss
 << "\t\tbit/key: N/A\n";

242  
ss
.
	`¡r
();

243 
	}
}

	@benchmarking/cuckoofilter/src/debug.h

1 #iâdeà
CUCKOO_FILTER_DEBUG_H_


2 
	#CUCKOO_FILTER_DEBUG_H_


	)

4 
	~<¡dio.h
>

6 
Çme¥aû
 
	gcuckoof‹r
 {

8 #iâdeà
DEBUG


12 
	#debug_Ëv–
 (
DEBUG_ERRS
 | 
DEBUG_CUCKOO
)

	)

14 #ifdeà
DEBUG


21 
	#DPRINTF
(
Ëv–
, ...) \

23 ià(
debug_Ëv–
 & (
Ëv–
)è
	`årštf
(
¡dout
, ##
__VA_ARGS__
); \

24 } 0)

	)

25 
	#DEBUG_PERROR
(
”rmsg
) \

27 ià(
debug_Ëv–
 & 
DEBUG_ERRS
è
	`³¼Ü
(
”rmsg
); \

28 } 0)

	)

32 
	#DPRINTF
(
Ëv–
, ...)

	)

33 
	#DEBUG_PERROR
(
Ëv–
, ...)

	)

42 
	#DEBUG_NONE
 0x00

43 
	#DEBUG_ERRS
 0x01

44 
	#DEBUG_CUCKOO
 0x02

45 
	#DEBUG_TABLE
 0x04

46 
	#DEBUG_ENCODE
 0x08

47 

	)

48 
	#DEBUG_ALL
 0xffffffff

	)

	@benchmarking/cuckoofilter/src/hashutil.cc

2 
	~"hashut.h
"

4 
	#rÙ
(
x
, 
k
è(((xè<< (k)è| ((xè>> (32 - (k))))

	)

5 
	#mix
(
a
,
b
,
c
) \

7 
a
 -ğ
c
;‡ ^ğ
	`rÙ
(c, 4); c +ğ
b
; \

8 
b
 -ğ
a
; b ^ğ
	`rÙ
×, 6);‡ +ğ
c
; \

9 
c
 -ğ
b
; c ^ğ
	`rÙ
(b, 8); b +ğ
a
; \

10 
a
 -ğ
c
;‡ ^ğ
	`rÙ
(c,16); c +ğ
b
; \

11 
b
 -ğ
a
; b ^ğ
	`rÙ
×,19);‡ +ğ
c
; \

12 
c
 -ğ
b
; c ^ğ
	`rÙ
(b, 4); b +ğ
a
; \

13 }

	)

15 
	#fš®
(
a
,
b
,
c
) \

17 
c
 ^ğ
b
; c -ğ
	`rÙ
(b,14); \

18 
a
 ^ğ
c
;‡ -ğ
	`rÙ
(c,11); \

19 
b
 ^ğ
a
; b -ğ
	`rÙ
(a,25); \

20 
c
 ^ğ
b
; c -ğ
	`rÙ
(b,16); \

21 
a
 ^ğ
c
;‡ -ğ
	`rÙ
(c,4); \

22 
b
 ^ğ
a
; b -ğ
	`rÙ
(a,14); \

23 
c
 ^ğ
b
; c -ğ
	`rÙ
(b,24); \

24 }

	)

26 
	#HASH_LITTLE_ENDIAN
 1

	)

28 
	#g‘16b™s
(
d
è(*((cÚ¡ 
ušt16_t
 *)(d)))

	)

30 
Çme¥aû
 
	gcuckoof‹r
 {

56 
ušt32_t
 
	gHashUt
::
BobHash
(cÚ¡ 
¡d
::
¡ršg
 &
s
, ušt32_ˆ
£ed
) {

57  
BobHash
(
s
.
d©a
(), s.
Ëngth
(), 
£ed
);

60 
ušt32_t
 
	gHashUt
::
BobHash
(cÚ¡ *
buf
, 
size_t
 
Ëngth
, ušt32_ˆ
£ed
) {

61 
ušt32_t
 
	ga
, 
	gb
, 
	gc
;

63 cÚ¡ *
	g±r
;

64 
size_t
 
	gi
;

65 } 
	gu
;

69 
	ga
 = 
b
 = 
c
 = 0xd—db“à+ ((
ušt32_t
)
Ëngth
è+ 
£ed
;

71 
	gu
.
	g±r
 = 
buf
;

72 ià(
	gHASH_LITTLE_ENDIAN
 && ((
	gu
.
	gi
 & 0x3) == 0)) {

73 cÚ¡ 
ušt32_t
 *
k
 = (cÚ¡ ušt32_ˆ*)
buf
;

76 
	gËngth
 > 12) {

77 
	ga
 +ğ
k
[0];

78 
	gb
 +ğ
k
[1];

79 
	gc
 +ğ
k
[2];

80 
mix
(
a
, 
b
, 
c
);

81 
	gËngth
 -= 12;

82 
	gk
 += 3;

95 #iâdeà
VALGRIND


97 
	gËngth
) {

99 
c
 +ğ
k
[2];

100 
	gb
 +ğ
k
[1];

101 
	ga
 +ğ
k
[0];

104 
c
 +ğ
k
[2] & 0xffffff;

105 
	gb
 +ğ
k
[1];

106 
	ga
 +ğ
k
[0];

109 
c
 +ğ
k
[2] & 0xffff;

110 
	gb
 +ğ
k
[1];

111 
	ga
 +ğ
k
[0];

114 
c
 +ğ
k
[2] & 0xff;

115 
	gb
 +ğ
k
[1];

116 
	ga
 +ğ
k
[0];

119 
b
 +ğ
k
[1];

120 
	ga
 +ğ
k
[0];

123 
b
 +ğ
k
[1] & 0xffffff;

124 
	ga
 +ğ
k
[0];

127 
b
 +ğ
k
[1] & 0xffff;

128 
	ga
 +ğ
k
[0];

131 
b
 +ğ
k
[1] & 0xff;

132 
	ga
 +ğ
k
[0];

135 
a
 +ğ
k
[0];

138 
a
 +ğ
k
[0] & 0xffffff;

141 
a
 +ğ
k
[0] & 0xffff;

144 
a
 +ğ
k
[0] & 0xff;

147  
c
;

152 cÚ¡ 
u_št8_t
 *
	gk8
;

153 
	gk8
 = (cÚ¡ 
u_št8_t
 *)
k
;

154 
	gËngth
) {

156 
c
 +ğ
k
[2];

157 
	gb
 +ğ
k
[1];

158 
	ga
 +ğ
k
[0];

161 
c
 +ğ((
ušt32_t
)
k8
[10]) << 16;

163 
c
 +ğ((
ušt32_t
)
k8
[9]) << 8;

165 
c
 +ğ
k8
[8];

167 
b
 +ğ
k
[1];

168 
	ga
 +ğ
k
[0];

171 
b
 +ğ((
ušt32_t
)
k8
[6]) << 16;

173 
b
 +ğ((
ušt32_t
)
k8
[5]) << 8;

175 
b
 +ğ
k8
[4];

177 
a
 +ğ
k
[0];

180 
a
 +ğ((
ušt32_t
)
k8
[2]) << 16;

182 
a
 +ğ((
ušt32_t
)
k8
[1]) << 8;

184 
a
 +ğ
k8
[0];

187  
c
;

192 } ià(
	gHASH_LITTLE_ENDIAN
 && ((
	gu
.
	gi
 & 0x1) == 0)) {

193 cÚ¡ 
u_št16_t
 *
k
 = (cÚ¡ u_št16_ˆ*)
buf
;

194 cÚ¡ 
u_št8_t
 *
	gk8
;

197 
	gËngth
 > 12) {

198 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

199 
	gb
 +ğ
k
[2] + (((
ušt32_t
)k[3]) << 16);

200 
	gc
 +ğ
k
[4] + (((
ušt32_t
)k[5]) << 16);

201 
mix
(
a
, 
b
, 
c
);

202 
	gËngth
 -= 12;

203 
	gk
 += 6;

207 
	gk8
 = (cÚ¡ 
u_št8_t
 *)
k
;

208 
	gËngth
) {

210 
c
 +ğ
k
[4] + (((
ušt32_t
)k[5]) << 16);

211 
	gb
 +ğ
k
[2] + (((
ušt32_t
)k[3]) << 16);

212 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

215 
c
 +ğ((
ušt32_t
)
k8
[10]) << 16;

217 
c
 +ğ
k
[4];

218 
	gb
 +ğ
k
[2] + (((
ušt32_t
)k[3]) << 16);

219 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

222 
c
 +ğ
k8
[8];

224 
b
 +ğ
k
[2] + (((
ušt32_t
)k[3]) << 16);

225 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

228 
b
 +ğ((
ušt32_t
)
k8
[6]) << 16;

230 
b
 +ğ
k
[2];

231 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

234 
b
 +ğ
k8
[4];

236 
a
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

239 
a
 +ğ((
ušt32_t
)
k8
[2]) << 16;

241 
a
 +ğ
k
[0];

244 
a
 +ğ
k8
[0];

247  
c
;

251 cÚ¡ 
u_št8_t
 *
	gk
 = (cÚ¡ u_št8_ˆ*)
buf
;

254 
	gËngth
 > 12) {

255 
	ga
 +ğ
k
[0];

256 
	ga
 +ğ((
ušt32_t
)
k
[1]) << 8;

257 
	ga
 +ğ((
ušt32_t
)
k
[2]) << 16;

258 
	ga
 +ğ((
ušt32_t
)
k
[3]) << 24;

259 
	gb
 +ğ
k
[4];

260 
	gb
 +ğ((
ušt32_t
)
k
[5]) << 8;

261 
	gb
 +ğ((
ušt32_t
)
k
[6]) << 16;

262 
	gb
 +ğ((
ušt32_t
)
k
[7]) << 24;

263 
	gc
 +ğ
k
[8];

264 
	gc
 +ğ((
ušt32_t
)
k
[9]) << 8;

265 
	gc
 +ğ((
ušt32_t
)
k
[10]) << 16;

266 
	gc
 +ğ((
ušt32_t
)
k
[11]) << 24;

267 
mix
(
a
, 
b
, 
c
);

268 
	gËngth
 -= 12;

269 
	gk
 += 12;

273 
	gËngth
)

276 
c
 +ğ((
ušt32_t
)
k
[11]) << 24;

278 
c
 +ğ((
ušt32_t
)
k
[10]) << 16;

280 
c
 +ğ((
ušt32_t
)
k
[9]) << 8;

282 
c
 +ğ
k
[8];

284 
b
 +ğ((
ušt32_t
)
k
[7]) << 24;

286 
b
 +ğ((
ušt32_t
)
k
[6]) << 16;

288 
b
 +ğ((
ušt32_t
)
k
[5]) << 8;

290 
b
 +ğ
k
[4];

292 
a
 +ğ((
ušt32_t
)
k
[3]) << 24;

294 
a
 +ğ((
ušt32_t
)
k
[2]) << 16;

296 
a
 +ğ((
ušt32_t
)
k
[1]) << 8;

298 
a
 +ğ
k
[0];

301  
c
;

305 
fš®
(
a
, 
b
, 
c
);

306  
	gc
;

319 
	gHashUt
::
BobHash
(cÚ¡ *
buf
, 
size_t
 
Ëngth
, 
ušt32_t
 *
idx1
,

320 
ušt32_t
 *
idx2
) {

321 
ušt32_t
 
	ga
, 
	gb
, 
	gc
;

323 cÚ¡ *
	g±r
;

324 
size_t
 
	gi
;

325 } 
	gu
;

328 
	ga
 = 
b
 = 
c
 = 0xd—db“à+ ((
ušt32_t
)
Ëngth
è+ *
idx1
;

329 
	gc
 +ğ*
idx2
;

331 
	gu
.
	g±r
 = 
buf
;

332 ià(
	gHASH_LITTLE_ENDIAN
 && ((
	gu
.
	gi
 & 0x3) == 0)) {

333 cÚ¡ 
ušt32_t
 *
k
 = (cÚ¡ ušt32_ˆ*)
buf
;

334 #ifdeà
VALGRIND


335 cÚ¡ 
ušt8_t
 *
	gk8
;

338 
	gËngth
 > 12) {

339 
	ga
 +ğ
k
[0];

340 
	gb
 +ğ
k
[1];

341 
	gc
 +ğ
k
[2];

342 
mix
(
a
, 
b
, 
c
);

343 
	gËngth
 -= 12;

344 
	gk
 += 3;

357 #iâdeà
VALGRIND


359 
	gËngth
) {

361 
c
 +ğ
k
[2];

362 
	gb
 +ğ
k
[1];

363 
	ga
 +ğ
k
[0];

366 
c
 +ğ
k
[2] & 0xffffff;

367 
	gb
 +ğ
k
[1];

368 
	ga
 +ğ
k
[0];

371 
c
 +ğ
k
[2] & 0xffff;

372 
	gb
 +ğ
k
[1];

373 
	ga
 +ğ
k
[0];

376 
c
 +ğ
k
[2] & 0xff;

377 
	gb
 +ğ
k
[1];

378 
	ga
 +ğ
k
[0];

381 
b
 +ğ
k
[1];

382 
	ga
 +ğ
k
[0];

385 
b
 +ğ
k
[1] & 0xffffff;

386 
	ga
 +ğ
k
[0];

389 
b
 +ğ
k
[1] & 0xffff;

390 
	ga
 +ğ
k
[0];

393 
b
 +ğ
k
[1] & 0xff;

394 
	ga
 +ğ
k
[0];

397 
a
 +ğ
k
[0];

400 
a
 +ğ
k
[0] & 0xffffff;

403 
a
 +ğ
k
[0] & 0xffff;

406 
a
 +ğ
k
[0] & 0xff;

409 *
idx1
 = 
c
;

410 *
	gidx2
 = 
b
;

416 
	gk8
 = (cÚ¡ 
ušt8_t
 *)
k
;

417 
	gËngth
) {

419 
c
 +ğ
k
[2];

420 
	gb
 +ğ
k
[1];

421 
	ga
 +ğ
k
[0];

424 
c
 +ğ((
ušt32_t
)
k8
[10]) << 16;

426 
c
 +ğ((
ušt32_t
)
k8
[9]) << 8;

428 
c
 +ğ
k8
[8];

430 
b
 +ğ
k
[1];

431 
	ga
 +ğ
k
[0];

434 
b
 +ğ((
ušt32_t
)
k8
[6]) << 16;

436 
b
 +ğ((
ušt32_t
)
k8
[5]) << 8;

438 
b
 +ğ
k8
[4];

440 
a
 +ğ
k
[0];

443 
a
 +ğ((
ušt32_t
)
k8
[2]) << 16;

445 
a
 +ğ((
ušt32_t
)
k8
[1]) << 8;

447 
a
 +ğ
k8
[0];

450 *
idx1
 = 
c
;

451 *
	gidx2
 = 
b
;

457 } ià(
	gHASH_LITTLE_ENDIAN
 && ((
	gu
.
	gi
 & 0x1) == 0)) {

458 cÚ¡ 
ušt16_t
 *
k
 = (cÚ¡ ušt16_ˆ*)
buf
;

459 cÚ¡ 
ušt8_t
 *
	gk8
;

462 
	gËngth
 > 12) {

463 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

464 
	gb
 +ğ
k
[2] + (((
ušt32_t
)k[3]) << 16);

465 
	gc
 +ğ
k
[4] + (((
ušt32_t
)k[5]) << 16);

466 
mix
(
a
, 
b
, 
c
);

467 
	gËngth
 -= 12;

468 
	gk
 += 6;

472 
	gk8
 = (cÚ¡ 
ušt8_t
 *)
k
;

473 
	gËngth
) {

475 
c
 +ğ
k
[4] + (((
ušt32_t
)k[5]) << 16);

476 
	gb
 +ğ
k
[2] + (((
ušt32_t
)k[3]) << 16);

477 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

480 
c
 +ğ((
ušt32_t
)
k8
[10]) << 16;

482 
c
 +ğ
k
[4];

483 
	gb
 +ğ
k
[2] + (((
ušt32_t
)k[3]) << 16);

484 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

487 
c
 +ğ
k8
[8];

489 
b
 +ğ
k
[2] + (((
ušt32_t
)k[3]) << 16);

490 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

493 
b
 +ğ((
ušt32_t
)
k8
[6]) << 16;

495 
b
 +ğ
k
[2];

496 
	ga
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

499 
b
 +ğ
k8
[4];

501 
a
 +ğ
k
[0] + (((
ušt32_t
)k[1]) << 16);

504 
a
 +ğ((
ušt32_t
)
k8
[2]) << 16;

506 
a
 +ğ
k
[0];

509 
a
 +ğ
k8
[0];

512 *
idx1
 = 
c
;

513 *
	gidx2
 = 
b
;

518 cÚ¡ 
ušt8_t
 *
	gk
 = (cÚ¡ ušt8_ˆ*)
buf
;

521 
	gËngth
 > 12) {

522 
	ga
 +ğ
k
[0];

523 
	ga
 +ğ((
ušt32_t
)
k
[1]) << 8;

524 
	ga
 +ğ((
ušt32_t
)
k
[2]) << 16;

525 
	ga
 +ğ((
ušt32_t
)
k
[3]) << 24;

526 
	gb
 +ğ
k
[4];

527 
	gb
 +ğ((
ušt32_t
)
k
[5]) << 8;

528 
	gb
 +ğ((
ušt32_t
)
k
[6]) << 16;

529 
	gb
 +ğ((
ušt32_t
)
k
[7]) << 24;

530 
	gc
 +ğ
k
[8];

531 
	gc
 +ğ((
ušt32_t
)
k
[9]) << 8;

532 
	gc
 +ğ((
ušt32_t
)
k
[10]) << 16;

533 
	gc
 +ğ((
ušt32_t
)
k
[11]) << 24;

534 
mix
(
a
, 
b
, 
c
);

535 
	gËngth
 -= 12;

536 
	gk
 += 12;

540 
	gËngth
)

543 
c
 +ğ((
ušt32_t
)
k
[11]) << 24;

545 
c
 +ğ((
ušt32_t
)
k
[10]) << 16;

547 
c
 +ğ((
ušt32_t
)
k
[9]) << 8;

549 
c
 +ğ
k
[8];

551 
b
 +ğ((
ušt32_t
)
k
[7]) << 24;

553 
b
 +ğ((
ušt32_t
)
k
[6]) << 16;

555 
b
 +ğ((
ušt32_t
)
k
[5]) << 8;

557 
b
 +ğ
k
[4];

559 
a
 +ğ((
ušt32_t
)
k
[3]) << 24;

561 
a
 +ğ((
ušt32_t
)
k
[2]) << 16;

563 
a
 +ğ((
ušt32_t
)
k
[1]) << 8;

565 
a
 +ğ
k
[0];

568 *
idx1
 = 
c
;

569 *
	gidx2
 = 
b
;

574 
fš®
(
a
, 
b
, 
c
);

575 *
	gidx1
 = 
c
;

576 *
	gidx2
 = 
b
;

579 
	gHashUt
::
BobHash
(cÚ¡ 
¡d
::
¡ršg
 &
s
, 
ušt32_t
 *
idx1
, ušt32_ˆ*
idx2
) {

580  
BobHash
(
s
.
d©a
(), s.
Ëngth
(), 
idx1
, 
idx2
);

595 
ušt32_t
 
	gHashUt
::
MurmurHash
(cÚ¡ *
buf
, 
size_t
 
Ën
, ušt32_ˆ
£ed
) {

599 cÚ¡ 
	gm
 = 0x5bd1e995;

600 cÚ¡ 
	gr
 = 24;

603 
ušt32_t
 
	gh
 = 
£ed
 ^ 
Ën
;

606 cÚ¡ *
	gd©a
 = (cÚ¡ *)
buf
;

608 
	gËn
 >= 4) {

609 
k
 = *(*)
d©a
;

611 
	gk
 *ğ
m
;

612 
	gk
 ^ğ
k
 >> 
r
;

613 
	gk
 *ğ
m
;

615 
	gh
 *ğ
m
;

616 
	gh
 ^ğ
k
;

618 
	gd©a
 += 4;

619 
	gËn
 -= 4;

623 
	gËn
) {

625 
h
 ^ğ
d©a
[2] << 16;

627 
h
 ^ğ
d©a
[1] << 8;

629 
h
 ^ğ
d©a
[0];

630 
	gh
 *ğ
m
;

635 
	gh
 ^ğ
h
 >> 13;

636 
	gh
 *ğ
m
;

637 
	gh
 ^ğ
h
 >> 15;

638  
	gh
;

641 
ušt32_t
 
	gHashUt
::
MurmurHash
(cÚ¡ 
¡d
::
¡ršg
 &
s
, ušt32_ˆ
£ed
) {

642  
MurmurHash
(
s
.
d©a
(), s.
Ëngth
(), 
£ed
);

646 
ušt32_t
 
	gHashUt
::
Su³rFa¡Hash
(cÚ¡ *
buf
, 
size_t
 
Ën
) {

647 cÚ¡ *
	gd©a
 = (cÚ¡ *)
buf
;

648 
ušt32_t
 
	ghash
 = 
Ën
, 
	gtmp
;

649 
	g»m
;

651 ià(
	gËn
 =ğ0 || 
d©a
 =ğ
NULL
)  0;

653 
	g»m
 = 
Ën
 & 3;

654 
	gËn
 >>= 2;

657 ; 
	gËn
 > 0;†en--) {

658 
	ghash
 +ğ
g‘16b™s
(
d©a
);

659 
	gtmp
 = (
g‘16b™s
(
d©a
 + 2è<< 11è^ 
hash
;

660 
	ghash
 = (
hash
 << 16è^ 
tmp
;

661 
	gd©a
 +ğ2 * (
ušt16_t
);

662 
	ghash
 +ğ
hash
 >> 11;

666 
	g»m
) {

668 
hash
 +ğ
g‘16b™s
(
d©a
);

669 
	ghash
 ^ğ
hash
 << 16;

670 
	ghash
 ^ğ
d©a
[(
ušt16_t
)] << 18;

671 
	ghash
 +ğ
hash
 >> 11;

674 
hash
 +ğ
g‘16b™s
(
d©a
);

675 
	ghash
 ^ğ
hash
 << 11;

676 
	ghash
 +ğ
hash
 >> 17;

679 
hash
 +ğ*
d©a
;

680 
	ghash
 ^ğ
hash
 << 10;

681 
	ghash
 +ğ
hash
 >> 1;

685 
	ghash
 ^ğ
hash
 << 3;

686 
	ghash
 +ğ
hash
 >> 5;

687 
	ghash
 ^ğ
hash
 << 4;

688 
	ghash
 +ğ
hash
 >> 17;

689 
	ghash
 ^ğ
hash
 << 25;

690 
	ghash
 +ğ
hash
 >> 6;

692  
	ghash
;

695 
ušt32_t
 
	gHashUt
::
Su³rFa¡Hash
(cÚ¡ 
¡d
::
¡ršg
 &
s
) {

696  
Su³rFa¡Hash
(
s
.
d©a
(), s.
Ëngth
());

699 
ušt32_t
 
	gHashUt
::
NuÎHash
(cÚ¡ *
buf
, 
size_t
 
Ëngth
,

700 
ušt32_t
 
shiáby‹s
) {

702 ià(
	gËngth
 - 
	gshiáby‹s
 < (
	gušt32_t
)) {

705 *
	gd©a
 = (*)
buf
;

706  ((
	gd©a
[(
Ëngth
 - 
shiáby‹s
 - 4)] << 24) +

707 (
	gd©a
[(
Ëngth
 - 
shiáby‹s
 - 3)] << 16) +

708 (
	gd©a
[(
Ëngth
 - 
shiáby‹s
 - 2)] << 8) +

709 (
	gd©a
[(
Ëngth
 - 
shiáby‹s
 - 1)]));

716 #ià
OPENSSL_VERSION_NUMBER
 < 0x10100000L

717 
	~<¡ršg.h
>

718 *
OPENSSL_z®loc
(
size_t
 
num
)

720 *
	g»t
 = 
OPENSSL_m®loc
(
num
);

722 ià(
	g»t
 !ğ
NULL
)

723 
mem£t
(
»t
, 0, 
num
);

724  
	g»t
;

727 
EVP_MD_CTX
 *
EVP_MD_CTX_Ãw
()

729  (
	gEVP_MD_CTX
 *)
OPENSSL_z®loc
((
EVP_MD_CTX
));

732 
EVP_MD_CTX_ä“
(
EVP_MD_CTX
 *
ùx
)

734 
EVP_MD_CTX_ş—nup
(
ùx
);

735 
OPENSSL_ä“
(
ùx
);

739 
	g¡d
::
¡ršg
 
HashUt
::
MD5Hash
(cÚ¡ *
šbuf
, 
size_t
 
š_Ëngth
) {

740 
EVP_MD_CTX
 *
	gmdùx
;

741 
	gmd_v®ue
[
EVP_MAX_MD_SIZE
];

742 
	gmd_Ën
;

744 
	gmdùx
 = 
EVP_MD_CTX_Ãw
();

745 
EVP_Dige¡In™
(
mdùx
, 
EVP_md5
());

746 
EVP_Dige¡Upd©e
(
mdùx
, (cÚ¡ *)
šbuf
, 
š_Ëngth
);

747 
EVP_Dige¡Fš®_ex
(
mdùx
, 
md_v®ue
, &
md_Ën
);

748 
EVP_MD_CTX_ä“
(
mdùx
);

750  
	g¡d
::
¡ršg
((*)
md_v®ue
, (
size_t
)
md_Ën
);

753 
	g¡d
::
¡ršg
 
HashUt
::
SHA1Hash
(cÚ¡ *
šbuf
, 
size_t
 
š_Ëngth
) {

754 
EVP_MD_CTX
 *
	gmdùx
;

755 
	gmd_v®ue
[
EVP_MAX_MD_SIZE
];

756 
	gmd_Ën
;

758 
	gmdùx
 = 
EVP_MD_CTX_Ãw
();

759 
EVP_Dige¡In™
(
mdùx
, 
EVP_sha1
());

760 
EVP_Dige¡Upd©e
(
mdùx
, (cÚ¡ *)
šbuf
, 
š_Ëngth
);

761 
EVP_Dige¡Fš®_ex
(
mdùx
, 
md_v®ue
, &
md_Ën
);

762 
EVP_MD_CTX_ä“
(
mdùx
);

764  
	g¡d
::
¡ršg
((*)
md_v®ue
, (
size_t
)
md_Ën
);

	@benchmarking/cuckoofilter/src/hashutil.h

1 #iâdeà
CUCKOO_FILTER_HASHUTIL_H_


2 
	#CUCKOO_FILTER_HASHUTIL_H_


	)

4 
	~<¡dšt.h
>

5 
	~<¡dlib.h
>

6 
	~<sys/ty³s.h
>

8 
	~<¡ršg
>

10 
	~<İ’s¦/evp.h
>

11 
	~<¿ndom
>

13 
Çme¥aû
 
	gcuckoof‹r
 {

15 şas 
	cHashUt
 {

16 
	gpublic
:

18 
ušt32_t
 
BobHash
(cÚ¡ *
buf
, 
size_t
 
Ëngth
, ušt32_ˆ
£ed
 = 0);

19 
ušt32_t
 
BobHash
(cÚ¡ 
¡d
::
¡ršg
 &
s
, ušt32_ˆ
£ed
 = 0);

24 
BobHash
(cÚ¡ *
buf
, 
size_t
 
Ëngth
, 
ušt32_t
 *
idx1
,

25 
ušt32_t
 *
idx2
);

26 
BobHash
(cÚ¡ 
¡d
::
¡ršg
 &
s
, 
ušt32_t
 *
idx1
, ušt32_ˆ*
idx2
);

29 
ušt32_t
 
MurmurHash
(cÚ¡ *
buf
, 
size_t
 
Ëngth
, ušt32_ˆ
£ed
 = 0);

30 
ušt32_t
 
MurmurHash
(cÚ¡ 
¡d
::
¡ršg
 &
s
, ušt32_ˆ
£ed
 = 0);

33 
ušt32_t
 
Su³rFa¡Hash
(cÚ¡ *
buf
, 
size_t
 
Ën
);

34 
ušt32_t
 
Su³rFa¡Hash
(cÚ¡ 
¡d
::
¡ršg
 &
s
);

37 
ušt32_t
 
NuÎHash
(cÚ¡ *
buf
, 
size_t
 
Ëngth
, ušt32_ˆ
shiáby‹s
);

40 
	g¡d
::
¡ršg
 
MD5Hash
(cÚ¡ *
šbuf
, 
size_t
 
š_Ëngth
);

41 
	g¡d
::
¡ršg
 
SHA1Hash
(cÚ¡ *
šbuf
, 
size_t
 
š_Ëngth
);

43 
	g´iv©e
:

44 
HashUt
();

49 şas 
	cTwoInd•’d’tMuÉlyShiá
 {

50 
__št128
 
	gmuÉly_
, 
	gadd_
;

52 
	gpublic
:

53 
TwoInd•’d’tMuÉlyShiá
() {

54 ::
¡d
::
¿ndom_deviû
 
¿ndom
;

55 autØ
	gv
 : {&
muÉly_
, &
	gadd_
}) {

56 *
	gv
 = 
¿ndom
();

57 
	gi
 = 1; i <= 4; ++i) {

58 *
	gv
 = *
v
 << 32;

59 *
	gv
 |ğ
¿ndom
();

64 
ušt64_t
 
İ”©Ü
()(ušt64_ˆ
	gkey
) const {

65  (
	gadd_
 + 
muÉly_
 * 
	g¡©ic_ÿ¡
<
deşty³
(muÉly_)>(
	gkey
)) >> 64;

70 şas 
	cSim¶eTabuÏtiÚ
 {

71 
ušt64_t
 
	gbËs_
[(ušt64_t)][1 << 
CHAR_BIT
];

73 
	gpublic
:

74 
Sim¶eTabuÏtiÚ
() {

75 ::
¡d
::
¿ndom_deviû
 
¿ndom
;

76 
	gi
 = 0; i < (
	gušt64_t
); ++i) {

77 
	gj
 = 0; j < (1 << 
	gCHAR_BIT
); ++j) {

78 
	gbËs_
[
i
][
j
] = 
¿ndom
(è| ((
¡©ic_ÿ¡
<
ušt64_t
>(random())) << 32);

83 
ušt64_t
 
İ”©Ü
()(ušt64_ˆ
	gkey
) const {

84 
ušt64_t
 
	g»suÉ
 = 0;

85 
	gi
 = 0; i < (
	gkey
); ++i) {

86 
	g»suÉ
 ^ğ
bËs_
[
i
][
»š‹½»t_ÿ¡
<
ušt8_t
 *>(&
key
)[i]];

88  
	g»suÉ
;

	@benchmarking/cuckoofilter/src/packedtable.h

1 #iâdeà
CUCKOO_FILTER_PACKED_TABLE_H_


2 
	#CUCKOO_FILTER_PACKED_TABLE_H_


	)

4 
	~<s¡»am
>

5 
	~<ut™y
>

7 
	~"debug.h
"

8 
	~"³rm’codšg.h
"

9 
	~"´štut.h
"

11 
Çme¥aû
 
	gcuckoof‹r
 {

14 
	g‹m¶©e
 <
size_t
 
	gb™s_³r_g
>

15 şas 
	cPackedTabË
 {

16 cÚ¡ 
size_t
 
	gkDœB™sP”Tag
 = 
b™s_³r_g
 - 4;

17 cÚ¡ 
size_t
 
	gkB™sP”Buck‘
 = (3 + 
kDœB™sP”Tag
) * 4;

18 cÚ¡ 
size_t
 
	gkBy‹sP”Buck‘
 = (
kB™sP”Buck‘
 + 7) >> 3;

19 cÚ¡ 
ušt32_t
 
	gkDœB™sMask
 = ((1ULL << 
kDœB™sP”Tag
) - 1) << 4;

22 
size_t
 
	gËn_
;

23 
size_t
 
	gnum_buck‘s_
;

24 *
	gbuck‘s_
;

25 
P”mEncodšg
 
	g³rm_
;

27 
	gpublic
:

28 
ex¶ic™
 
PackedTabË
(
size_t
 
num
è: 
num_buck‘s_
(num) {

31 
Ën_
 = 
kBy‹sP”Buck‘
 * 
num_buck‘s_
 + 7;

32 
	gbuck‘s_
 = 
Ãw
 [
Ën_
];

33 
mem£t
(
buck‘s_
, 0, 
Ën_
);

36 ~
PackedTabË
() {

37 
	gd–‘e
[] 
	gbuck‘s_
;

40 
size_t
 
NumBuck‘s
() const {

41  
	gnum_buck‘s_
;

44 
size_t
 
SizeInTags
() const {

45  4 * 
	gnum_buck‘s_
;

48 
size_t
 
SizeInBy‹s
() const {

49  
	gËn_
;

52 
	g¡d
::
¡ršg
 
Info
() const {

53 
¡d
::
¡ršg¡»am
 
ss
;

54 
	gss
 << "PackedHashbË w™hag size: " << 
	gb™s_³r_g
 << " bits";

55 
	gss
 << "\t4…acked b™s(3 b™ aá” com´essiÚèªd " << 
	gkDœB™sP”Tag


57 
	gss
 << "\t\tAssociativity: 4\n";

58 
	gss
 << "\t\tTÙ® # oàrows: " << 
	gnum_buck‘s_
 << "\n";

59 
	gss
 << "\t\‰Ù® # slÙs: " << 
SizeInTags
() << "\n";

60  
	gss
.
¡r
();

63 
PrštBuck‘
(cÚ¡ 
size_t
 
i
) const {

64 
DPRINTF
(
DEBUG_TABLE
, "PackedTabË::PrštBuck‘ %zu \n", 
i
);

65 cÚ¡ *
	gp
 = 
buck‘s_
 + 
kB™sP”Buck‘
 * 
i
 / 8;

66 
	g¡d
::
cout
 << "\tbucketbits ="

67 << 
PrštUt
::
by‹s_to_hex
((*)
p
, 
kBy‹sP”Buck‘
 + 1)

68 << 
	g¡d
::
’dl
;

70 
ušt32_t
 
	ggs
[4];

72 
R—dBuck‘
(
i
, 
gs
);

73 
PrštTags
(
gs
);

74 
DPRINTF
(
DEBUG_TABLE
, "PackedTable::PrintBucket done \n");

77 
PrštTags
(
ušt32_t
 
gs
[4]) const {

78 
DPRINTF
(
DEBUG_TABLE
, "PackedTable::PrintTags \n");

79 
ušt8_t
 
	glowb™s
[4];

80 
ušt32_t
 
	gdœb™s
[4];

81 
size_t
 
	gj
 = 0; j < 4; j++) {

82 
	glowb™s
[
j
] = 
gs
[j] & 0x0f;

83 
	gdœb™s
[
j
] = (
gs
[j] & 
kDœB™sMask
) >> 4;

85 
ušt16_t
 
	gcodewÜd
 = 
³rm_
.
’code
(
lowb™s
);

86 
	g¡d
::
cout
 << "\tcodeword ="

87 << 
PrštUt
::
by‹s_to_hex
((*)&
codewÜd
, 2è<< 
	g¡d
::
’dl
;

88 
size_t
 
	gj
 = 0; j < 4; j++) {

89 
	g¡d
::
cout
 << "\‰ag[" << 
j


90 << "]: " << 
PrštUt
::
by‹s_to_hex
((*)&
gs
[
j
], 4);

91 
	g¡d
::
cout
 << "†owbits="

92 << 
PrštUt
::
by‹s_to_hex
((*)&
lowb™s
[
j
], 1)

94 << 
	gPrštUt
::
by‹s_to_hex
((*)&
dœb™s
[
j
],

95 
kDœB™sP”Tag
 / 8 + 1)

96 << 
	g¡d
::
’dl
;

98 
DPRINTF
(
DEBUG_TABLE
, "PackedTable::PrintTags done\n");

101 
šlše
 
SÜtPaœ
(
ušt32_t
 &
a
, ušt32_ˆ&
b
) {

102 ià((
	ga
 & 0x0fè> (
	gb
 & 0x0f)) {

103 
	g¡d
::
sw­
(
a
, 
b
);

107 
šlše
 
SÜtTags
(
ušt32_t
 *
gs
) {

108 
SÜtPaœ
(
gs
[0],ags[2]);

109 
SÜtPaœ
(
gs
[1],ags[3]);

110 
SÜtPaœ
(
gs
[0],ags[1]);

111 
SÜtPaœ
(
gs
[2],ags[3]);

112 
SÜtPaœ
(
gs
[1],ags[2]);

118 
šlše
 
R—dBuck‘
(cÚ¡ 
size_t
 
i
, 
ušt32_t
 
gs
[4]) const {

119 
DPRINTF
(
DEBUG_TABLE
, "PackedTabË::R—dBuck‘ %zu \n", 
i
);

120 
DPRINTF
(
DEBUG_TABLE
, "kdœb™sMask=%x\n", 
kDœB™sMask
);

122 cÚ¡ *
	gp
;

123 
ušt16_t
 
	gcodewÜd
;

124 
ušt8_t
 
	glowb™s
[4];

126 ià(
	gb™s_³r_g
 == 5) {

128 
p
 = 
buck‘s_
 + (
i
 * 2);

129 
ušt16_t
 
	gbuck‘b™s
 = *((ušt16_ˆ*)
p
);

130 
	gcodewÜd
 = 
buck‘b™s
 & 0x0fff;

131 
	ggs
[0] = ((
buck‘b™s
 >> 8è& 
kDœB™sMask
);

132 
	ggs
[1] = ((
buck‘b™s
 >> 9è& 
kDœB™sMask
);

133 
	ggs
[2] = ((
buck‘b™s
 >> 10è& 
kDœB™sMask
);

134 
	ggs
[3] = ((
buck‘b™s
 >> 11è& 
kDœB™sMask
);

135 } ià(
	gb™s_³r_g
 == 6) {

137 
p
 = 
buck‘s_
 + ((20 * 
i
) >> 3);

138 
ušt32_t
 
	gbuck‘b™s
 = *((ušt32_ˆ*)
p
);

139 
	gcodewÜd
 = (*((
ušt16_t
 *)
p
è>> ((
i
 & 1) << 2)) & 0x0fff;

140 
	ggs
[0] = (
buck‘b™s
 >> (8 + ((
i
 & 1è<< 2))è& 
kDœB™sMask
;

141 
	ggs
[1] = (
buck‘b™s
 >> (10 + ((
i
 & 1è<< 2))è& 
kDœB™sMask
;

142 
	ggs
[2] = (
buck‘b™s
 >> (12 + ((
i
 & 1è<< 2))è& 
kDœB™sMask
;

143 
	ggs
[3] = (
buck‘b™s
 >> (14 + ((
i
 & 1è<< 2))è& 
kDœB™sMask
;

144 } ià(
	gb™s_³r_g
 == 7) {

146 
p
 = 
buck‘s_
 + (
i
 << 1) + i;

147 
ušt32_t
 
	gbuck‘b™s
 = *((ušt32_ˆ*)
p
);

148 
	gcodewÜd
 = *((
ušt16_t
 *)
p
) & 0x0fff;

149 
	ggs
[0] = (
buck‘b™s
 >> 8è& 
kDœB™sMask
;

150 
	ggs
[1] = (
buck‘b™s
 >> 11è& 
kDœB™sMask
;

151 
	ggs
[2] = (
buck‘b™s
 >> 14è& 
kDœB™sMask
;

152 
	ggs
[3] = (
buck‘b™s
 >> 17è& 
kDœB™sMask
;

153 } ià(
	gb™s_³r_g
 == 8) {

155 
p
 = 
buck‘s_
 + ((28 * 
i
) >> 3);

156 
ušt32_t
 
	gbuck‘b™s
 = *((ušt32_ˆ*)
p
);

157 
	gcodewÜd
 = (*((
ušt16_t
 *)
p
è>> ((
i
 & 1) << 2)) & 0x0fff;

158 
	ggs
[0] = (
buck‘b™s
 >> (8 + ((
i
 & 1è<< 2))è& 
kDœB™sMask
;

159 
	ggs
[1] = (
buck‘b™s
 >> (12 + ((
i
 & 1è<< 2))è& 
kDœB™sMask
;

160 
	ggs
[2] = (
buck‘b™s
 >> (16 + ((
i
 & 1è<< 2))è& 
kDœB™sMask
;

161 
	ggs
[3] = (
buck‘b™s
 >> (20 + ((
i
 & 1è<< 2))è& 
kDœB™sMask
;

162 } ià(
	gb™s_³r_g
 == 9) {

164 
p
 = 
buck‘s_
 + (
i
 * 4);

165 
ušt32_t
 
	gbuck‘b™s
 = *((ušt32_ˆ*)
p
);

166 
	gcodewÜd
 = *((
ušt16_t
 *)
p
) & 0x0fff;

167 
	ggs
[0] = (
buck‘b™s
 >> 8è& 
kDœB™sMask
;

168 
	ggs
[1] = (
buck‘b™s
 >> 13è& 
kDœB™sMask
;

169 
	ggs
[2] = (
buck‘b™s
 >> 18è& 
kDœB™sMask
;

170 
	ggs
[3] = (
buck‘b™s
 >> 23è& 
kDœB™sMask
;

171 } ià(
	gb™s_³r_g
 == 13) {

173 
p
 = 
buck‘s_
 + (
i
 * 6);

174 
ušt64_t
 
	gbuck‘b™s
 = *((ušt64_ˆ*)
p
);

175 
	gcodewÜd
 = *((
ušt16_t
 *)
p
) & 0x0fff;

176 
	ggs
[0] = (
buck‘b™s
 >> 8è& 
kDœB™sMask
;

177 
	ggs
[1] = (
buck‘b™s
 >> 17è& 
kDœB™sMask
;

178 
	ggs
[2] = (
buck‘b™s
 >> 26è& 
kDœB™sMask
;

179 
	ggs
[3] = (
buck‘b™s
 >> 35è& 
kDœB™sMask
;

180 } ià(
	gb™s_³r_g
 == 17) {

182 
p
 = 
buck‘s_
 + (
i
 << 3);

183 
ušt64_t
 
	gbuck‘b™s
 = *((ušt64_ˆ*)
p
);

184 
	gcodewÜd
 = *((
ušt16_t
 *)
p
) & 0x0fff;

185 
	ggs
[0] = (
buck‘b™s
 >> 8è& 
kDœB™sMask
;

186 
	ggs
[1] = (
buck‘b™s
 >> 21è& 
kDœB™sMask
;

187 
	ggs
[2] = (
buck‘b™s
 >> 34è& 
kDœB™sMask
;

188 
	ggs
[3] = (
buck‘b™s
 >> 47è& 
kDœB™sMask
;

192 
ušt16_t
 
	gv
 = 
³rm_
.
dec_bË
[
codewÜd
];

193 
	glowb™s
[0] = (
v
 & 0x000f);

194 
	glowb™s
[2] = ((
v
 >> 4) & 0x000f);

195 
	glowb™s
[1] = ((
v
 >> 8) & 0x000f);

196 
	glowb™s
[3] = ((
v
 >> 12) & 0x000f);

198 
	ggs
[0] |ğ
lowb™s
[0];

199 
	ggs
[1] |ğ
lowb™s
[1];

200 
	ggs
[2] |ğ
lowb™s
[2];

201 
	ggs
[3] |ğ
lowb™s
[3];

203 ià(
	gdebug_Ëv–
 & 
	gDEBUG_TABLE
) {

204 
PrštTags
(
gs
);

206 
DPRINTF
(
DEBUG_TABLE
, "PackedTable::ReadBucket done \n");

212 
šlše
 
Wr™eBuck‘
(cÚ¡ 
size_t
 
i
, 
ušt32_t
 
gs
[4], 
boŞ
 
sÜt
 = 
Œue
) {

213 
DPRINTF
(
DEBUG_TABLE
, "PackedTabË::Wr™eBuck‘ %zu \n", 
i
);

215 ià(
	gsÜt
) {

216 
DPRINTF
(
DEBUG_TABLE
, "Sortags\n");

217 
SÜtTags
(
gs
);

219 ià(
	gdebug_Ëv–
 & 
	gDEBUG_TABLE
) {

220 
PrštTags
(
gs
);

225 
ušt8_t
 
	glowb™s
[4];

226 
ušt32_t
 
	ghighb™s
[4];

228 
	glowb™s
[0] = 
gs
[0] & 0x0f;

229 
	glowb™s
[1] = 
gs
[1] & 0x0f;

230 
	glowb™s
[2] = 
gs
[2] & 0x0f;

231 
	glowb™s
[3] = 
gs
[3] & 0x0f;

233 
	ghighb™s
[0] = 
gs
[0] & 0xfffffff0;

234 
	ghighb™s
[1] = 
gs
[1] & 0xfffffff0;

235 
	ghighb™s
[2] = 
gs
[2] & 0xfffffff0;

236 
	ghighb™s
[3] = 
gs
[3] & 0xfffffff0;

240 
ušt16_t
 
	gcodewÜd
 = 
³rm_
.
’code
(
lowb™s
);

241 
DPRINTF
(
DEBUG_TABLE
, "codeword=%s\n",

242 
PrštUt
::
by‹s_to_hex
((*)&
codewÜd
, 2).
c_¡r
());

245 cÚ¡ *
	gp
 = 
buck‘s_
 + ((
kB™sP”Buck‘
 * 
i
) >> 3);

246 
DPRINTF
(
DEBUG_TABLE
, "original bucketbits=%s\n",

247 
PrštUt
::
by‹s_to_hex
((*)
p
, 8).
c_¡r
());

249 ià(
	gkB™sP”Buck‘
 == 16) {

251 *((
ušt16_t
 *)
p
èğ
codewÜd
 | (
highb™s
[0] << 8) | (highbits[1] << 9) |

252 (
highb™s
[2] << 10) | (highbits[3] << 11);

253 } ià(
	gkB™sP”Buck‘
 == 20) {

255 ià((
i
 & 0x0001) == 0) {

256 *((
ušt32_t
 *)
p
) &= 0xfff00000;

257 *((
	gušt32_t
 *)
	gp
è|ğ
codewÜd
 | (
highb™s
[0] << 8) |

258 (
highb™s
[1] << 10) | (highbits[2] << 12) |

259 (
highb™s
[3] << 14);

261 *((
	gušt32_t
 *)
	gp
) &= 0xff00000f;

262 *((
	gušt32_t
 *)
	gp
è|ğ(
codewÜd
 << 4è| (
highb™s
[0] << 12) |

263 (
highb™s
[1] << 14) | (highbits[2] << 16) |

264 (
highb™s
[3] << 18);

266 } ià(
	gkB™sP”Buck‘
 == 24) {

268 *((
ušt32_t
 *)
p
) &= 0xff000000;

269 *((
	gušt32_t
 *)
	gp
è|ğ
codewÜd
 | (
highb™s
[0] << 8) | (highbits[1] << 11) |

270 (
highb™s
[2] << 14) | (highbits[3] << 17);

271 } ià(
	gkB™sP”Buck‘
 == 28) {

273 ià((
i
 & 0x0001) == 0) {

274 *((
ušt32_t
 *)
p
) &= 0xf0000000;

275 *((
	gušt32_t
 *)
	gp
è|ğ
codewÜd
 | (
highb™s
[0] << 8) |

276 (
highb™s
[1] << 12) | (highbits[2] << 16) |

277 (
highb™s
[3] << 20);

279 *((
	gušt32_t
 *)
	gp
) &= 0x0000000f;

280 *((
	gušt32_t
 *)
	gp
è|ğ(
codewÜd
 << 4è| (
highb™s
[0] << 12) |

281 (
highb™s
[1] << 16) | (highbits[2] << 20) |

282 (
highb™s
[3] << 24);

284 } ià(
	gkB™sP”Buck‘
 == 32) {

286 *((
ušt32_t
 *)
p
èğ
codewÜd
 | (
highb™s
[0] << 8) | (highbits[1] << 13) |

287 (
highb™s
[2] << 18) | (highbits[3] << 23);

288 
DPRINTF
(
DEBUG_TABLE
, "‚ew bucketbits=%s\n",

289 
PrštUt
::
by‹s_to_hex
((*)
p
, 4).
c_¡r
());

290 } ià(
	gkB™sP”Buck‘
 == 48) {

292 *((
ušt64_t
 *)
p
) &= 0xffff000000000000ULL;

293 *((
	gušt64_t
 *)
	gp
è|ğ
codewÜd
 | ((
ušt64_t
)
highb™s
[0] << 8) |

294 ((
ušt64_t
)
highb™s
[1] << 17) |

295 ((
ušt64_t
)
highb™s
[2] << 26) |

296 ((
ušt64_t
)
highb™s
[3] << 35);

297 
DPRINTF
(
DEBUG_TABLE
, "‚ew bucketbits=%s\n",

298 
PrštUt
::
by‹s_to_hex
((*)
p
, 4).
c_¡r
());

300 } ià(
	gkB™sP”Buck‘
 == 64) {

302 *((
ušt64_t
 *)
p
èğ
codewÜd
 | ((ušt64_t)
highb™s
[0] << 8) |

303 ((
ušt64_t
)
highb™s
[1] << 21) |

304 ((
ušt64_t
)
highb™s
[2] << 34) |

305 ((
ušt64_t
)
highb™s
[3] << 47);

307 
DPRINTF
(
DEBUG_TABLE
, "PackedTable::WriteBucket done\n");

310 
boŞ
 
FšdTagInBuck‘s
(cÚ¡ 
size_t
 
i1
, cÚ¡ size_ˆ
i2
,

311 cÚ¡ 
ušt32_t
 
g
) const {

313 
ušt32_t
 
	ggs1
[4];

314 
ušt32_t
 
	ggs2
[4];

323 
ušt16_t
 
	gv
;

324 
ušt64_t
 
	gbuck‘b™s1
 = *((ušt64_ˆ*)(
buck‘s_
 + 
kB™sP”Buck‘
 * 
i1
 / 8));

325 
ušt64_t
 
	gbuck‘b™s2
 = *((ušt64_ˆ*)(
buck‘s_
 + 
kB™sP”Buck‘
 * 
i2
 / 8));

327 
	ggs1
[0] = (
buck‘b™s1
 >> 8è& 
kDœB™sMask
;

328 
	ggs1
[1] = (
buck‘b™s1
 >> 17è& 
kDœB™sMask
;

329 
	ggs1
[2] = (
buck‘b™s1
 >> 26è& 
kDœB™sMask
;

330 
	ggs1
[3] = (
buck‘b™s1
 >> 35è& 
kDœB™sMask
;

331 
	gv
 = 
³rm_
.
dec_bË
[(
buck‘b™s1
)&0x0fff];

333 
	ggs1
[0] |ğ(
v
 & 0x000f);

334 
	ggs1
[2] |ğ((
v
 >> 4) & 0x000f);

335 
	ggs1
[1] |ğ((
v
 >> 8) & 0x000f);

336 
	ggs1
[3] |ğ((
v
 >> 12) & 0x000f);

338 
	ggs2
[0] = (
buck‘b™s2
 >> 8è& 
kDœB™sMask
;

339 
	ggs2
[1] = (
buck‘b™s2
 >> 17è& 
kDœB™sMask
;

340 
	ggs2
[2] = (
buck‘b™s2
 >> 26è& 
kDœB™sMask
;

341 
	ggs2
[3] = (
buck‘b™s2
 >> 35è& 
kDœB™sMask
;

342 
	gv
 = 
³rm_
.
dec_bË
[(
buck‘b™s2
)&0x0fff];

343 
	ggs2
[0] |ğ(
v
 & 0x000f);

344 
	ggs2
[2] |ğ((
v
 >> 4) & 0x000f);

345 
	ggs2
[1] |ğ((
v
 >> 8) & 0x000f);

346 
	ggs2
[3] |ğ((
v
 >> 12) & 0x000f);

348  (
	ggs1
[0] =ğ
g
è|| (
gs1
[1] ==ag) || (tags1[2] ==ag) ||

349 (
gs1
[3] =ğ
g
è|| (
gs2
[0] ==ag) || (tags2[1] ==ag) ||

350 (
gs2
[2] =ğ
g
) || (tags2[3] ==ag);

353 
boŞ
 
FšdTagInBuck‘
(cÚ¡ 
size_t
 
i
, cÚ¡ 
ušt32_t
 
g
) const {

354 
DPRINTF
(
DEBUG_TABLE
, "PackedTabË::FšdTagInBuck‘ %zu\n", 
i
);

355 
ušt32_t
 
	ggs
[4];

356 
R—dBuck‘
(
i
, 
gs
);

357 ià(
	gdebug_Ëv–
 & 
	gDEBUG_TABLE
) {

358 
PrštTags
(
gs
);

361 
boŞ
 
	g»t
 = ((
gs
[0] =ğ
g
) || (tags[1] ==ag) || (tags[2] ==ag) ||

362 (
gs
[3] =ğ
g
));

363 
DPRINTF
(
DEBUG_TABLE
, "PackedTabË::FšdTagInBuck‘ %d \n", 
»t
);

364  
	g»t
;

367 
boŞ
 
D–‘eTagFromBuck‘
(cÚ¡ 
size_t
 
i
, cÚ¡ 
ušt32_t
 
g
) {

368 
ušt32_t
 
	ggs
[4];

369 
R—dBuck‘
(
i
, 
gs
);

370 ià(
	gdebug_Ëv–
 & 
	gDEBUG_TABLE
) {

371 
PrštTags
(
gs
);

373 
size_t
 
	gj
 = 0; j < 4; j++) {

374 ià(
	ggs
[
j
] =ğ
g
) {

375 
gs
[
j
] = 0;

376 
Wr™eBuck‘
(
i
, 
gs
);

377  
	gŒue
;

380  
	gçl£
;

383 
boŞ
 
In£¹TagToBuck‘
(cÚ¡ 
size_t
 
i
, cÚ¡ 
ušt32_t
 
g
, cÚ¡ boŞ 
kickout
,

384 
ušt32_t
 &
Şdg
) {

385 
DPRINTF
(
DEBUG_TABLE
, "PackedTabË::In£¹TagToBuck‘ %zu \n", 
i
);

387 
ušt32_t
 
	ggs
[4];

388 
DPRINTF
(
DEBUG_TABLE
,

390 
R—dBuck‘
(
i
, 
gs
);

391 ià(
	gdebug_Ëv–
 & 
	gDEBUG_TABLE
) {

392 
PrštTags
(
gs
);

393 
PrštBuck‘
(
i
);

395 
size_t
 
	gj
 = 0; j < 4; j++) {

396 ià(
	ggs
[
j
] == 0) {

397 
DPRINTF
(
DEBUG_TABLE
,

398 "PackedTabË::In£¹TagToBuck‘ slÙ %zu i em±y\n", 
j
);

400 
	ggs
[
j
] = 
g
;

401 
Wr™eBuck‘
(
i
, 
gs
);

402 ià(
	gdebug_Ëv–
 & 
	gDEBUG_TABLE
) {

403 
PrštBuck‘
(
i
);

404 
R—dBuck‘
(
i
, 
gs
);

406 
DPRINTF
(
DEBUG_TABLE
, "PackedTable::InsertTagToBucket Ok\n");

407  
	gŒue
;

410 ià(
	gkickout
) {

411 
size_t
 
	gr
 = 
¿nd
() & 3;

412 
DPRINTF
(

413 
DEBUG_TABLE
,

415 
r
);

418 
	gŞdg
 = 
gs
[
r
];

419 
	ggs
[
r
] = 
g
;

420 
Wr™eBuck‘
(
i
, 
gs
);

421 ià(
	gdebug_Ëv–
 & 
	gDEBUG_TABLE
) {

422 
PrštTags
(
gs
);

425 
DPRINTF
(
DEBUG_TABLE
, "PackedTable::InsertTagToBucket, insert failed \n");

426  
	gçl£
;

	@benchmarking/cuckoofilter/src/permencoding.h

1 #iâdeà
CUCKOO_FILTER_PERM_ENCODING_H_


2 
	#CUCKOO_FILTER_PERM_ENCODING_H_


	)

4 
	~<¡dšt.h
>

5 
	~<¡dio.h
>

6 
	~<¡dlib.h
>

7 
	~<¡ršg.h
>

9 
	~<io¡»am
>

11 
	~"debug.h
"

13 
Çme¥aû
 
	gcuckoof‹r
 {

15 şas 
	cP”mEncodšg
 {

22 
šlše
 
uÅack
(
ušt16_t
 
š
, 
ušt8_t
 
out
[4]) const {

23 
	gout
[0] = (
š
 & 0x000f);

24 
	gout
[2] = ((
š
 >> 4) & 0x000f);

25 
	gout
[1] = ((
š
 >> 8) & 0x000f);

26 
	gout
[3] = ((
š
 >> 12) & 0x000f);

30 
šlše
 
ušt16_t
 
·ck
(cÚ¡ 
ušt8_t
 
š
[4]) const {

31 
ušt16_t
 
	gš1
 = *((ušt16_ˆ*)(
š
)) & 0x0f0f;

32 
ušt16_t
 
	gš2
 = *((ušt16_ˆ*)(
š
 + 2)) << 4;

33  
	gš1
 | 
	gš2
;

36 
	gpublic
:

37 
P”mEncodšg
() {

38 
ušt8_t
 
d¡
[4];

39 
ušt16_t
 
	gidx
 = 0;

40 
mem£t
(
dec_bË
, 0, (dec_table));

41 
mem£t
(
’c_bË
, 0, (enc_table));

42 
g’_bËs
(0, 0, 
d¡
, 
idx
);

45 ~
P”mEncodšg
() {}

47 cÚ¡ 
size_t
 
	gN_ENTS
 = 3876;

49 
ušt16_t
 
	gdec_bË
[
N_ENTS
];

50 
ušt16_t
 
	g’c_bË
[1 << 16];

52 
šlše
 
decode
(cÚ¡ 
ušt16_t
 
codewÜd
, 
ušt8_t
 
lowb™s
[4]) const {

53 
uÅack
(
dec_bË
[
codewÜd
], 
lowb™s
);

56 
šlše
 
ušt16_t
 
’code
(cÚ¡ 
ušt8_t
 
lowb™s
[4]) const {

57 ià(
	gDEBUG_ENCODE
 & 
	gdebug_Ëv–
) {

58 
´štf
("Perm.encode\n");

59 
	gi
 = 0; i < 4; i++) {

60 
´štf
("’codlowb™s[%d]=%x\n", 
i
, 
lowb™s
[i]);

62 
´štf
("·ckÖowb™sèğ%x\n", 
·ck
(
lowb™s
));

63 
´štf
("’c_bË[%x]=%x\n", 
·ck
(
lowb™s
), 
’c_bË
[pack(lowbits)]);

66  
	g’c_bË
[
·ck
(
lowb™s
)];

69 
g’_bËs
(
ba£
, 
k
, 
ušt8_t
 
d¡
[4], 
ušt16_t
 &
idx
) {

70 
	gi
 = 
ba£
; i < 16; i++) {

72 
	gd¡
[
k
] = 
i
;

73 ià(
	gk
 + 1 < 4) {

74 
g’_bËs
(
i
, 
k
 + 1, 
d¡
, 
idx
);

76 
	gdec_bË
[
idx
] = 
·ck
(
d¡
);

77 
	g’c_bË
[
·ck
(
d¡
)] = 
idx
;

78 ià(
	gDEBUG_ENCODE
 & 
	gdebug_Ëv–
) {

79 
´štf
("’c_bË[%04x]=%04x\t%x %x %x %x\n", 
·ck
(
d¡
), 
idx
, dst[0],

80 
d¡
[1], dst[2], dst[3]);

82 
	gidx
++;

	@benchmarking/cuckoofilter/src/printutil.cc

1 
	~"´štut.h
"

3 
	~<¡dio.h
>

5 
	~<io¡»am
>

7 
Çme¥aû
 
	gcuckoof‹r
 {

9 
	g¡d
::
¡ršg
 
PrštUt
::
by‹s_to_hex
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

10 
	g¡d
::
¡ršg
 
hex¡r
 = "";

11 cÚ¡ 
	ghexes
[] = "0123456789ABCDEF ";

13 
size_t
 
	gi
 = 0; i < 
	gËn
; i++) {

14 
	gc
 = 
d©a
[
i
];

15 
	ghex¡r
.
push_back
(
hexes
[
c
 >> 4]);

16 
	ghex¡r
.
push_back
(
hexes
[
c
 & 0xf]);

17 
	ghex¡r
.
push_back
(
hexes
[16]);

19  
	ghex¡r
;

22 
	g¡d
::
¡ršg
 
PrštUt
::
by‹s_to_hex
(cÚ¡ 
¡d
::¡ršg &
s
) {

23  
by‹s_to_hex
((cÚ¡ *)
s
.
d©a
(), s.
size
());

	@benchmarking/cuckoofilter/src/printutil.h

1 #iâdeà
CUCKOO_FILTER_PRINTUTIL_H_


2 
	#CUCKOO_FILTER_PRINTUTIL_H_


	)

4 
	~<¡ršg
>

6 
Çme¥aû
 
	gcuckoof‹r
 {

7 şas 
	cPrštUt
 {

8 
	gpublic
:

9 
¡d
::
¡ršg
 
by‹s_to_hex
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

10 
	g¡d
::
¡ršg
 
hex¡r
 = "";

11 cÚ¡ 
	ghexes
[] = "0123456789ABCDEF ";

13 
size_t
 
	gi
 = 0; i < 
	gËn
; i++) {

14 
	gc
 = 
d©a
[
i
];

15 
	ghex¡r
.
push_back
(
hexes
[
c
 >> 4]);

16 
	ghex¡r
.
push_back
(
hexes
[
c
 & 0xf]);

17 
	ghex¡r
.
push_back
(
hexes
[16]);

19  
	ghex¡r
;

22 
	g¡d
::
¡ršg
 
by‹s_to_hex
(cÚ¡ 
¡d
::¡ršg &
s
) {

23  
by‹s_to_hex
((cÚ¡ *)
s
.
d©a
(), s.
size
());

26 
	g´iv©e
:

27 
PrštUt
();

	@benchmarking/cuckoofilter/src/simd-block.h

13 #´agm¨
Úû


15 
	~<c¡dšt
>

16 
	~<c¡dlib
>

18 
	~<®gÜ™hm
>

19 
	~<Ãw
>

21 
	~<immšŒš.h
>

23 
	~"hashut.h
"

25 
usšg
 
	gušt32_t
 = ::
¡d
::
ušt32_t
;

26 
usšg
 
	gušt64_t
 = ::
¡d
::
ušt64_t
;

28 
	g‹m¶©e
<
ty³Çme
 
	gHashFamy
 = ::
cuckoof‹r
::
TwoInd•’d’tMuÉlyShiá
>

29 şas 
	cSimdBlockF‹r
 {

30 
´iv©e
:

32 
usšg
 
Buck‘
 = 
ušt32_t
[8];

35 
cÚ¡ex´
 
	mLOG_BUCKET_BYTE_SIZE
 = 5;

37 
¡©ic_as£¹
(

38 (1 << 
LOG_BUCKET_BYTE_SIZE
è=ğ(
Buck‘
è&& (Buck‘è=ğ(
__m256i
),

42 cÚ¡ 
	mlog_num_buck‘s_
;

46 cÚ¡ 
ušt32_t
 
	mdœeùÜy_mask_
;

48 
Buck‘
* 
	mdœeùÜy_
;

50 
HashFamy
 
	mhash”_
;

52 
	mpublic
:

54 
ex¶ic™
 
SimdBlockF‹r
(cÚ¡ 
log_h—p_¥aû
);

55 
	$SimdBlockF‹r
(
SimdBlockF‹r
&& 
th©
)

56 : 
	`log_num_buck‘s_
(
th©
.
log_num_buck‘s_
),

57 
	`dœeùÜy_mask_
(
th©
.
dœeùÜy_mask_
),

58 
	`dœeùÜy_
(
th©
.
dœeùÜy_
),

59 
	$hash”_
(
th©
.
hash”_
) {}

60 ~
	$SimdBlockF‹r
(è
nÛxû±
;

61 
	$Add
(cÚ¡ 
ušt64_t
 
key
è
nÛxû±
;

62 
boŞ
 
	$Fšd
(cÚ¡ 
ušt64_t
 
key
ècÚ¡ 
nÛxû±
;

63 
ušt64_t
 
	$SizeInBy‹s
(ècÚ¡ {  (
Buck‘
è* (1uÎ << 
log_num_buck‘s_
); 
	}
}

65 
	g´iv©e
:

68 
__m256i
 
	$MakeMask
(cÚ¡ 
ušt32_t
 
hash
è
nÛxû±
;

70 
	`SimdBlockF‹r
(cÚ¡ 
SimdBlockF‹r
&èğ
d–‘e
;

71 
İ”©Ü
=(cÚ¡ 
SimdBlockF‹r
&èğ
d–‘e
;

72 
	}
};

74 
	g‹m¶©e
<
ty³Çme
 
	gHashFamy
>

75 
	gSimdBlockF‹r
<
	gHashFamy
>::
	$SimdBlockF‹r
(cÚ¡ 
log_h—p_¥aû
)

78 
	`log_num_buck‘s_
(::
¡d
::
	`max
(1, 
log_h—p_¥aû
 - 
LOG_BUCKET_BYTE_SIZE
)),

81 
	`dœeùÜy_mask_
((1uÎ << ::
¡d
::
	`mš
(63, 
log_num_buck‘s_
)) - 1),

82 
	`dœeùÜy_
(
nuÎ±r
),

83 
	$hash”_
() {

84 ià(!
	`__butš_ıu_suµÜts
("avx2")) {

85 
throw
 ::
¡d
::
	`ruÁime_”rÜ
("SimdBlockFilter does‚ot work without AVX2 instructions");

87 cÚ¡ 
size_t
 
®loc_size
 = 1uÎ << (
log_num_buck‘s_
 + 
LOG_BUCKET_BYTE_SIZE
);

88 cÚ¡ 
m®loc_çed
 =

89 
	`posix_mem®ign
(
»š‹½»t_ÿ¡
<**>(&
dœeùÜy_
), 64, 
®loc_size
);

90 ià(
m®loc_çed
è
throw
 ::
¡d
::
	`bad_®loc
();

91 
	`mem£t
(
dœeùÜy_
, 0, 
®loc_size
);

92 
	}
}

94 
	g‹m¶©e
<
ty³Çme
 
	gHashFamy
>

95 
	gSimdBlockF‹r
<
	gHashFamy
>::~
	$SimdBlockF‹r
(è
nÛxû±
 {

96 
	`ä“
(
dœeùÜy_
);

97 
dœeùÜy_
 = 
nuÎ±r
;

98 
	}
}

102 
	g‹m¶©e
 <
ty³Çme
 
	gHashFamy
>

103 [[
gnu
::
®ways_šlše
]] 
šlše
 
__m256i


104 
SimdBlockF‹r
<
HashFamy
>::
	$MakeMask
(cÚ¡ 
ušt32_t
 
hash
è
nÛxû±
 {

105 cÚ¡ 
__m256i
 
Úes
 = 
	`_mm256_£t1_•i32
(1);

107 cÚ¡ 
__m256i
 
»hash
 = 
	`_mm256_£Œ_•i32
(0x47b6137bU, 0x44974d91U, 0x8824ad5bU,

110 
__m256i
 
hash_d©a
 = 
	`_mm256_£t1_•i32
(
hash
);

113 
hash_d©a
 = 
	`_mm256_muÎo_•i32
(
»hash
, hash_data);

114 
hash_d©a
 = 
	`_mm256_¤li_•i32
(hash_data, 27);

116  
	`_mm256_¦lv_•i32
(
Úes
, 
hash_d©a
);

117 
	}
}

119 
	g‹m¶©e
 <
ty³Çme
 
	gHashFamy
>

120 [[
gnu
::
®ways_šlše
]] 
šlše
 

121 
SimdBlockF‹r
<
HashFamy
>::
	$Add
(cÚ¡ 
ušt64_t
 
key
è
nÛxû±
 {

122 cÚ¡‡utØ
hash
 = 
	`hash”_
(
key
);

123 cÚ¡ 
ušt32_t
 
buck‘_idx
 = 
hash
 & 
dœeùÜy_mask_
;

124 cÚ¡ 
__m256i
 
mask
 = 
	`MakeMask
(
hash
 >> 
log_num_buck‘s_
);

125 
__m256i
* cÚ¡ 
buck‘
 = &
»š‹½»t_ÿ¡
<__m256i*>(
dœeùÜy_
)[
buck‘_idx
];

126 
	`_mm256_¡Üe_si256
(
buck‘
, 
	`_mm256_Ü_si256
(*buck‘, 
mask
));

127 
	}
}

129 
	g‹m¶©e
 <
ty³Çme
 
	gHashFamy
>

130 [[
gnu
::
®ways_šlše
]] 
šlše
 
boŞ


131 
SimdBlockF‹r
<
HashFamy
>::
	$Fšd
(cÚ¡ 
ušt64_t
 
key
ècÚ¡ 
nÛxû±
 {

132 cÚ¡‡utØ
hash
 = 
	`hash”_
(
key
);

133 cÚ¡ 
ušt32_t
 
buck‘_idx
 = 
hash
 & 
dœeùÜy_mask_
;

134 cÚ¡ 
__m256i
 
mask
 = 
	`MakeMask
(
hash
 >> 
log_num_buck‘s_
);

135 cÚ¡ 
__m256i
 
buck‘
 = 
»š‹½»t_ÿ¡
<__m256i*>(
dœeùÜy_
)[
buck‘_idx
];

140  
	`_mm256_‹¡c_si256
(
buck‘
, 
mask
);

141 
	}
}

	@benchmarking/cuckoofilter/src/singletable.h

1 #iâdeà
CUCKOO_FILTER_SINGLE_TABLE_H_


2 
	#CUCKOO_FILTER_SINGLE_TABLE_H_


	)

4 
	~<as£¹.h
>

6 
	~<s¡»am
>

8 
	~<xmmšŒš.h
>

10 
	~"b™sut.h
"

11 
	~"debug.h
"

12 
	~"´štut.h
"

14 
Çme¥aû
 
	gcuckoof‹r
 {

17 
	g‹m¶©e
 <
size_t
 
	gb™s_³r_g
>

18 şas 
	cSšgËTabË
 {

19 cÚ¡ 
size_t
 
	gkTagsP”Buck‘
 = 4;

20 cÚ¡ 
size_t
 
	gkBy‹sP”Buck‘
 =

21 (
b™s_³r_g
 * 
kTagsP”Buck‘
 + 7) >> 3;

22 cÚ¡ 
ušt32_t
 
	gkTagMask
 = (1ULL << 
b™s_³r_g
) - 1;

24 
	sBuck‘
 {

25 
	gb™s_
[
kBy‹sP”Buck‘
];

26 } 
__©Œibu‹__
((
__·cked__
));

29 
Buck‘
 *
	gbuck‘s_
;

30 
size_t
 
	gnum_buck‘s_
;

32 
	gpublic
:

33 
ex¶ic™
 
SšgËTabË
(cÚ¡ 
size_t
 
num
è: 
num_buck‘s_
(num) {

34 
buck‘s_
 = 
Ãw
 
Buck‘
[
num_buck‘s_
];

35 
mem£t
(
buck‘s_
, 0, 
kBy‹sP”Buck‘
 * 
num_buck‘s_
);

38 ~
SšgËTabË
() {

39 
	gd–‘e
[] 
	gbuck‘s_
;

42 
size_t
 
NumBuck‘s
() const {

43  
	gnum_buck‘s_
;

46 
size_t
 
SizeInBy‹s
() const {

47  
kBy‹sP”Buck‘
 * 
	gnum_buck‘s_
;

50 
size_t
 
SizeInTags
() const {

51  
kTagsP”Buck‘
 * 
	gnum_buck‘s_
;

54 
	g¡d
::
¡ršg
 
Info
() const {

55 
¡d
::
¡ršg¡»am
 
ss
;

56 
	gss
 << "SšgËHashbË w™hag size: " << 
	gb™s_³r_g
 << " bits \n";

57 
	gss
 << "\t\tAssocŸtiv™y: " << 
	gkTagsP”Buck‘
 << "\n";

58 
	gss
 << "\t\tTÙ® # oàrows: " << 
	gnum_buck‘s_
 << "\n";

59 
	gss
 << "\t\tTÙ® # slÙs: " << 
SizeInTags
() << "\n";

60  
	gss
.
¡r
();

64 
šlše
 
ušt32_t
 
R—dTag
(cÚ¡ 
size_t
 
i
, cÚ¡ size_ˆ
j
) const {

65 cÚ¡ *
	gp
 = 
buck‘s_
[
i
].
b™s_
;

66 
ušt32_t
 
	gg
;

68 ià(
	gb™s_³r_g
 == 2) {

69 
g
 = *((
ušt8_t
 *)
p
è>> (
j
 * 2);

70 } ià(
	gb™s_³r_g
 == 4) {

71 
p
 +ğ(
j
 >> 1);

72 
	gg
 = *((
ušt8_t
 *)
p
è>> ((
j
 & 1) << 2);

73 } ià(
	gb™s_³r_g
 == 8) {

74 
p
 +ğ
j
;

75 
	gg
 = *((
ušt8_t
 *)
p
);

76 } ià(
	gb™s_³r_g
 == 12) {

77 
p
 +ğ
j
 + (j >> 1);

78 
	gg
 = *((
ušt16_t
 *)
p
è>> ((
j
 & 1) << 2);

79 } ià(
	gb™s_³r_g
 == 16) {

80 
p
 +ğ(
j
 << 1);

81 
	gg
 = *((
ušt16_t
 *)
p
);

82 } ià(
	gb™s_³r_g
 == 32) {

83 
g
 = ((
ušt32_t
 *)
p
)[
j
];

85  
	gg
 & 
	gkTagMask
;

89 
šlše
 
Wr™eTag
(cÚ¡ 
size_t
 
i
, cÚ¡ size_ˆ
j
, cÚ¡ 
ušt32_t
 
t
) {

90 *
	gp
 = 
buck‘s_
[
i
].
b™s_
;

91 
ušt32_t
 
	gg
 = 
t
 & 
kTagMask
;

93 ià(
	gb™s_³r_g
 == 2) {

94 *((
ušt8_t
 *)
p
è|ğ
g
 << (2 * 
j
);

95 } ià(
	gb™s_³r_g
 == 4) {

96 
p
 +ğ(
j
 >> 1);

97 ià((
	gj
 & 1) == 0) {

98 *((
ušt8_t
 *)
p
) &= 0xf0;

99 *((
	gušt8_t
 *)
	gp
è|ğ
g
;

101 *((
	gušt8_t
 *)
	gp
) &= 0x0f;

102 *((
	gušt8_t
 *)
	gp
è|ğ(
g
 << 4);

104 } ià(
	gb™s_³r_g
 == 8) {

105 ((
ušt8_t
 *)
p
)[
j
] = 
g
;

106 } ià(
	gb™s_³r_g
 == 12) {

107 
p
 +ğ(
j
 + (j >> 1));

108 ià((
	gj
 & 1) == 0) {

109 ((
ušt16_t
 *)
p
)[0] &= 0xf000;

110 ((
	gušt16_t
 *)
	gp
)[0] |ğ
g
;

112 ((
	gušt16_t
 *)
	gp
)[0] &= 0x000f;

113 ((
	gušt16_t
 *)
	gp
)[0] |ğ(
g
 << 4);

115 } ià(
	gb™s_³r_g
 == 16) {

116 ((
ušt16_t
 *)
p
)[
j
] = 
g
;

117 } ià(
	gb™s_³r_g
 == 32) {

118 ((
ušt32_t
 *)
p
)[
j
] = 
g
;

122 
šlše
 
boŞ
 
FšdTagInBuck‘s
(cÚ¡ 
size_t
 
i1
, cÚ¡ size_ˆ
i2
,

123 cÚ¡ 
ušt32_t
 
g
) const {

124 cÚ¡ *
	gp1
 = 
buck‘s_
[
i1
].
b™s_
;

125 cÚ¡ *
	gp2
 = 
buck‘s_
[
i2
].
b™s_
;

127 
ušt64_t
 
	gv1
 = *((ušt64_ˆ*)
p1
);

128 
ušt64_t
 
	gv2
 = *((ušt64_ˆ*)
p2
);

131 ià(
	gb™s_³r_g
 =ğ4 && 
kTagsP”Buck‘
 == 4) {

132  
hasv®ue4
(
v1
, 
g
è|| hasv®ue4(
v2
,ag);

133 } ià(
	gb™s_³r_g
 =ğ8 && 
kTagsP”Buck‘
 == 4) {

134  
hasv®ue8
(
v1
, 
g
è|| hasv®ue8(
v2
,ag);

135 } ià(
	gb™s_³r_g
 =ğ12 && 
kTagsP”Buck‘
 == 4) {

136  
hasv®ue12
(
v1
, 
g
è|| hasv®ue12(
v2
,ag);

137 } ià(
	gb™s_³r_g
 =ğ16 && 
kTagsP”Buck‘
 == 4) {

138  
hasv®ue16
(
v1
, 
g
è|| hasv®ue16(
v2
,ag);

140 
size_t
 
	gj
 = 0; j < 
	gkTagsP”Buck‘
; j++) {

141 ià((
R—dTag
(
i1
, 
j
è=ğ
g
è|| (R—dTag(
i2
, j) ==ag)) {

142  
Œue
;

145  
	gçl£
;

149 
šlše
 
boŞ
 
FšdTagInBuck‘
(cÚ¡ 
size_t
 
i
, cÚ¡ 
ušt32_t
 
g
) const {

151 ià(
	gb™s_³r_g
 =ğ4 && 
kTagsP”Buck‘
 == 4) {

152 cÚ¡ *
p
 = 
buck‘s_
[
i
].
b™s_
;

153 
ušt64_t
 
	gv
 = *(ušt64_ˆ*)
p
;

154  
hasv®ue4
(
v
, 
g
);

155 } ià(
	gb™s_³r_g
 =ğ8 && 
kTagsP”Buck‘
 == 4) {

156 cÚ¡ *
p
 = 
buck‘s_
[
i
].
b™s_
;

157 
ušt64_t
 
	gv
 = *(ušt64_ˆ*)
p
;

158  
hasv®ue8
(
v
, 
g
);

159 } ià(
	gb™s_³r_g
 =ğ12 && 
kTagsP”Buck‘
 == 4) {

160 cÚ¡ *
p
 = 
buck‘s_
[
i
].
b™s_
;

161 
ušt64_t
 
	gv
 = *(ušt64_ˆ*)
p
;

162  
hasv®ue12
(
v
, 
g
);

163 } ià(
	gb™s_³r_g
 =ğ16 && 
kTagsP”Buck‘
 == 4) {

164 cÚ¡ *
p
 = 
buck‘s_
[
i
].
b™s_
;

165 
ušt64_t
 
	gv
 = *(ušt64_ˆ*)
p
;

166  
hasv®ue16
(
v
, 
g
);

168 
size_t
 
	gj
 = 0; j < 
	gkTagsP”Buck‘
; j++) {

169 ià(
R—dTag
(
i
, 
j
è=ğ
g
) {

170  
Œue
;

173  
	gçl£
;

177 
šlše
 
boŞ
 
D–‘eTagFromBuck‘
(cÚ¡ 
size_t
 
i
, cÚ¡ 
ušt32_t
 
g
) {

178 
size_t
 
	gj
 = 0; j < 
	gkTagsP”Buck‘
; j++) {

179 ià(
R—dTag
(
i
, 
j
è=ğ
g
) {

180 
as£¹
(
FšdTagInBuck‘
(
i
, 
g
è=ğ
Œue
);

181 
Wr™eTag
(
i
, 
j
, 0);

182  
	gŒue
;

185  
	gçl£
;

188 
šlše
 
boŞ
 
In£¹TagToBuck‘
(cÚ¡ 
size_t
 
i
, cÚ¡ 
ušt32_t
 
g
,

189 cÚ¡ 
boŞ
 
kickout
, 
ušt32_t
 &
Şdg
) {

190 
size_t
 
	gj
 = 0; j < 
	gkTagsP”Buck‘
; j++) {

191 ià(
R—dTag
(
i
, 
j
) == 0) {

192 
Wr™eTag
(
i
, 
j
, 
g
);

193  
	gŒue
;

196 ià(
	gkickout
) {

197 
size_t
 
	gr
 = 
¿nd
(è% 
kTagsP”Buck‘
;

198 
	gŞdg
 = 
R—dTag
(
i
, 
r
);

199 
Wr™eTag
(
i
, 
r
, 
g
);

201  
	gçl£
;

204 
šlše
 
size_t
 
NumTagsInBuck‘
(cÚ¡ size_ˆ
i
) const {

205 
size_t
 
	gnum
 = 0;

206 
size_t
 
	gj
 = 0; j < 
	gkTagsP”Buck‘
; j++) {

207 ià(
R—dTag
(
i
, 
j
) != 0) {

208 
num
++;

211  
	gnum
;

	@benchmarking/measure_bucket_accesses.cc

41 
	~"b’chm¬k_ut.h
"

42 
	~"mÜtÚ_f‹r.h
"

45 
	~"cuckoof‹r.h
"

47 
usšg
 
Çme¥aû
 
	gB’chm¬k
;

49 
	$maš
(
¬gc
, ** 
¬gv
){

51 
cÚ¡ex´
 
ušt64_t
 
tÙ®_¦Ùs
 = 128ULL * 1024ULL * 1024ULL;

52 
cÚ¡ex´
 
lßd_çùÜ
 = 0.95;

53 
cÚ¡ex´
 
ušt64_t
 
tÙ®_™ems_to_š£¹
 = 
tÙ®_¦Ùs
 * 
lßd_çùÜ
;

54 
cÚ¡ex´
 
ušt64_t
 
tÙ®_™ems_to_´obe
 = 
tÙ®_™ems_to_š£¹
;

56 
cÚ¡ex´
 
š£¹_ªd_´obe_™em_ov”Ïp
 = 1.0;

58 
¡d
::
veùÜ
<
keys_t
> 
	`š£¹_™ems
(
tÙ®_™ems_to_š£¹
);

59 
¡d
::
veùÜ
<
keys_t
> 
	`´obe_™ems
(
tÙ®_™ems_to_´obe
);

61 
boŞ
 
du¶iÿ‹s_³rm™‹d_š_´obe_veùÜ
 = 
Œue
;

63 
pİuÏ‹_w™h_¿ndom_numb”s
<
keys_t
>(
š£¹_™ems
, 
´obe_™ems
,

64 
š£¹_ªd_´obe_™em_ov”Ïp
, 
du¶iÿ‹s_³rm™‹d_š_´obe_veùÜ
);

66 
Com´es£dCuckoo
::
MÜtÚ3_8
 
	`ccf
(
tÙ®_¦Ùs
);

69 
¡d
::
cout
 << "Primary,BlockOverflow,BucketOverflow,HybridOverflow\n";

70 
ušt64_t
 
i
 = 0; i < 
tÙ®_™ems_to_š£¹
; i++){

71 
hash_t
 
¿w_hash
 = 
ccf
.
	`¿w_´im¬y_hash
(
š£¹_™ems
[
i
]);

72 
ccf
.
	`¿ndom_kickout_cuckoo
(ccf.
	`m­_to_buck‘
(
¿w_hash
, ccf.
_tÙ®_buck‘s
),

73 
ccf
.
	`fšg”´št_funùiÚ
(
¿w_hash
));

79 
cÚ¡ex´
 
ušt64_t
 
fšg”´št_Ën_b™s
 = 12;

80 
cÚ¡ex´
 
ušt64_t
 
buck‘s
 = 
tÙ®_¦Ùs
 / 4;

81 
cuckoof‹r
::
CuckooF‹r
<
ušt64_t
, 
fšg”´št_Ën_b™s
, cuckoof‹r::
SšgËTabË
>

82 
	`cf
(
buck‘s
, 
çl£
);

83 
¡d
::
cout
 << "Count\n";

84 
ušt64_t
 
i
 = 0; i < 
tÙ®_™ems_to_š£¹
; i++){

85 
cf
.
	`Add
(
š£¹_™ems
[
i
]);

89 
	}
}

	@bf.h

37 #iâdeà
_BF_H


38 
	#_BF_H


	)

46 
	~<¬¿y
>

48 
Çme¥aû
 
	gBlockedBF
{

49 
usšg
 
	g¦Ù_ty³
 = 
ušt32_t
;

50 
	sBuck‘
{

51 
¦Ù_ty³
 
	gf1
, 
	gf2
, 
	gf3
, 
	gf4
;

53 
	g‹m¶©e
<
ušt64_t
 
	gT_NUM_BUCKETS
>

54 
	sBloomF‹r
{

55 
¡©ic_as£¹
(
__butš_pİcouÁÎ
(
T_NUM_BUCKETS
) == 1, "BloomFilter must "

57 
	g¡d
::
¬¿y
<
Buck‘
, 
	gT_NUM_BUCKETS
> 
	gbuck‘s
{};

60 
šlše
 
boŞ
 
cÚšs_ªd_upd©e
(cÚ¡ 
hash_t
 
™em
){

61 
cÚ¡ex´
 
¦Ù_ty³
 
	gÚe
 = 1;

62 
cÚ¡ex´
 
¦Ù_ty³
 
	g¦Ù_width_b™s
 = (slot_type) * 8;

63 
cÚ¡ex´
 
¦Ù_ty³
 
	glog2_¦Ù_width
 = 
ut
::
log2û
(
¦Ù_width_b™s
);

64 
cÚ¡ex´
 
¦Ù_ty³
 
	gshiá0
 = 0;

65 
cÚ¡ex´
 
¦Ù_ty³
 
	gshiá1
 = 
log2_¦Ù_width
;

66 
cÚ¡ex´
 
¦Ù_ty³
 
	gshiá2
 = 
log2_¦Ù_width
 * 2;

67 
cÚ¡ex´
 
¦Ù_ty³
 
	gshiá3
 = 
log2_¦Ù_width
 * 3;

68 
cÚ¡ex´
 
¦Ù_ty³
 
	gbuck‘_shiá
 = 
log2_¦Ù_width
 * 4;

70 
ušt64_t
 
	ghashes
 = 0xff51afd7ed558ccdULL * 
™em
;

71 
¦Ù_ty³
 
	gh1
 = (
hashes
 >> 
shiá0
è% 
¦Ù_width_b™s
;

72 
¦Ù_ty³
 
	gh2
 = (
hashes
 >> 
shiá1
è% 
¦Ù_width_b™s
;

73 
¦Ù_ty³
 
	gh3
 = (
hashes
 >> 
shiá2
è% 
¦Ù_width_b™s
;

74 
¦Ù_ty³
 
	gh4
 = (
hashes
 >> 
shiá3
è% 
¦Ù_width_b™s
;

75 
¦Ù_ty³
 
	gbuck‘_id
 = (
hashes
 >> 
buck‘_shiá
è% (
T_NUM_BUCKETS
);

76 
boŞ
 
	gcÚæiù_´e£Á
 = (
buck‘s
[
buck‘_id
].
f1
 >> 
h1
) &

77 (
buck‘s
[
buck‘_id
].
f2
 >> 
h2
) &

78 (
buck‘s
[
buck‘_id
].
f3
 >> 
h3
) &

79 (
buck‘s
[
buck‘_id
].
f4
 >> 
h4
è& 
Úe
;

80 
	gbuck‘s
[
buck‘_id
].
	gf1
 |ğ
Úe
 << 
h1
;

81 
	gbuck‘s
[
buck‘_id
].
	gf2
 |ğ
Úe
 << 
h2
;

82 
	gbuck‘s
[
buck‘_id
].
	gf3
 |ğ
Úe
 << 
h3
;

83 
	gbuck‘s
[
buck‘_id
].
	gf4
 |ğ
Úe
 << 
h4
;

84  
	gcÚæiù_´e£Á
;

	@block.h

37 #iâdeà
_BLOCK_H


38 
	#_BLOCK_H


	)

40 
	~<¡dšt.h
>

42 
	~<c¡ršg
>

43 
	~<s¡»am
>

44 
	~<io¡»am
>

46 
	~"ut.h
"

47 
	~"veùÜ_ty³s.h
"

49 #iâdeà
INLINE


50 
	#INLINE
 
	`__©Œibu‹__
((
®ways_šlše
)è
šlše


	)

53 
Çme¥aû
 
	gMÜtÚ
{

55 cÚ¡ 
ušt64_t
 
	gby‹s_to_b™s
 = 8lu;

57 
	g‹m¶©e
<
ušt64_t
 
	gblock_size_b™s
,

58 
ušt64_t
 
	g’Œy_size_b™s
,

59 
ty³Çme
 
	g©om_t
>

60 
	sBlock
{

61 
	~"veùÜ_ty³s.h
"

63 
	g´iv©e
:

64 cÚ¡ 
ušt64_t
 
©om_size_b™s
 = 
by‹s_to_b™s
 * (
©om_t
);

66 cÚ¡ 
ušt64_t
 
	g»ad_mask
 = (
¡©ic_ÿ¡
<
©om_t
>(1è<< 
’Œy_size_b™s
) - 1;

67 cÚ¡ 
ušt64_t
 
	g©oms_³r_block
 = 
block_size_b™s
 / (
©om_size_b™s
);

70 cÚ¡ 
ušt64_t
 
	g’Œ›s_³r_©om
 = 
©om_size_b™s
 / 
’Œy_size_b™s
;

71 
©om_t
 
	g_block_¡Üage
[
©oms_³r_block
]{};

72 cÚ¡ 
boŞ
 
	gex¶ic™_´št
 = 
Œue
;

73 
	gpublic
:

74 
šlše
 
©om_t
 
İ”©Ü
[](
ušt32_t
 
©om_šdex
) const{

75  
_block_¡Üage
[
©om_šdex
];

79 
šlše
 
add
(
ušt64_t
 
šdex
, 
©om_t
 
™em
){

81 
ušt64_t
 
	g©om_šdex
 = 
šdex
 / 
’Œ›s_³r_©om
;

83 
ušt64_t
 
	g©om_b™_off£t
 = (
šdex
 % 
’Œ›s_³r_©om
è* 
’Œy_size_b™s
;

84 
	g_block_¡Üage
[
©om_šdex
] &ğ~(
»ad_mask
 << 
©om_b™_off£t
);

85 
	g_block_¡Üage
[
©om_šdex
] |ğ(
™em
 << 
©om_b™_off£t
);

88 
INLINE
 
boŞ
 
»ad_b™
(
ušt64_t
 
¿w_šdex_š_b™s
) const{

89 
ušt64_t
 
	g©om_šdex
 = 
¿w_šdex_š_b™s
 / ((
©om_t
) * 8);

90 
ušt64_t
 
	g©om_off£t
 = 
¿w_šdex_š_b™s
 % ((
©om_t
) * 8);

91  (
	g_block_¡Üage
[
©om_šdex
] >> 
	g©om_off£t
) & 0x1;

94 
INLINE
 
©om_t
 
»ad_by‹
(
ušt64_t
 
by‹_šdex
) const{

95 
ušt64_t
 
	g©om_šdex
 = 
by‹_šdex
 / ((
©om_t
));

96 
ušt64_t
 
	gloÿl_by‹_šdex
 = 
by‹_šdex
 % ((
©om_t
));

97  (
	g_block_¡Üage
[
©om_šdex
] >>

98 ((
	g©om_t
è* 
	gloÿl_by‹_šdex
)) & 0xff;

101 
INLINE
 
£t_b™
(
ušt64_t
 
¿w_šdex_š_b™s
, 
©om_t
 
v®ue
){

102 
ušt64_t
 
	g©om_šdex
 = 
¿w_šdex_š_b™s
 / ((
©om_t
) * 8);

103 
ušt64_t
 
	g©om_off£t
 = 
¿w_šdex_š_b™s
 % ((
©om_t
) * 8);

104 
©om_t
 
	gmask
 = (~
¡©ic_ÿ¡
<©om_t>(0)è^ (
v®ue
 << 
©om_off£t
);

105 
	g_block_¡Üage
[
©om_šdex
] &ğ
mask
;

111 
INLINE
 
¡icky_£t_b™
(
ušt64_t
 
¿w_šdex_š_b™s
, ušt64_ˆ
v®ue
){

112 
ušt64_t
 
	g©om_šdex
 = 
¿w_šdex_š_b™s
 / ((
©om_t
) * 8);

113 
ušt64_t
 
	g©om_off£t
 = 
¿w_šdex_š_b™s
 % ((
©om_t
) * 8);

114 
	g_block_¡Üage
[
©om_šdex
] |ğ
v®ue
 << 
©om_off£t
;

120 
	g‹m¶©e
<
şass
 
	gT
>

121 
šlše
 
add_t
(
ušt64_t
 
¿w_off£t_b™s
, ušt64_ˆ
f›ld_width_b™s
,

122 
ušt64_t
 
šdex
, 
T
 
™em
){

123 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

124 
ušt8_t
 
	gwÜd_šdex
 = 
glob®_šdex
 / ((
T
) * 8ULL);

125 
T
 
	g»ad_mask_¥ecific
 = (
¡©ic_ÿ¡
<T>(1è<< 
f›ld_width_b™s
) -

126 
¡©ic_ÿ¡
<
T
>(1);

127 
ušt8_t
 
	gwÜd_b™_off£t
 = 
glob®_šdex
 % ((
T
) * 8ULL);

128 
T
* 
	gblock_¡Üage
 = 
»š‹½»t_ÿ¡
<T*>(
_block_¡Üage
);

129 
	gblock_¡Üage
[
wÜd_šdex
] &ğ~(
»ad_mask_¥ecific
 << 
wÜd_b™_off£t
);

130 
	gblock_¡Üage
[
wÜd_šdex
] |ğ
™em
 << 
wÜd_b™_off£t
;

137 
šlše
 
add
(
ušt64_t
 
¿w_off£t_b™s
, ušt64_ˆ
f›ld_width_b™s
,

138 
ušt64_t
 
šdex
, 
©om_t
 
™em
){

139 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

144 
ušt8_t
 
	g©om
 = 
glob®_šdex
 / 
©om_size_b™s
;

148 
©om_t
 
	g»ad_mask_¥ecific
 = (
¡©ic_ÿ¡
<©om_t>(1è<< 
f›ld_width_b™s
) - static_cast<atom_t>(1);

150 
ušt8_t
 
	g©om_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

153 
	g_block_¡Üage
[
©om
] &ğ~(
»ad_mask_¥ecific
 << 
©om_b™_off£t
);

156 
	g_block_¡Üage
[
©om
] |ğ
™em
 << 
©om_b™_off£t
;

166 
INLINE
 
add_üoss
(
ušt64_t
 
¿w_off£t_b™s
,

167 
ušt64_t
 
f›ld_width_b™s
,

168 
ušt64_t
 
šdex
, 
©om_t
 
™em
){

169 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

174 
©om_t
 
	g©om0
 = 
glob®_šdex
 / 
©om_size_b™s
;

175 
©om_t
 
	g©om1
 = (
glob®_šdex
 + 
f›ld_width_b™s
è/ 
©om_size_b™s
;

177 
ušt16_t
 
	g¥lov”
 = (
glob®_šdex
 + 
f›ld_width_b™s
è% 
©om_size_b™s
;

178 
	g¥lov”
 = (
©om1
 - 
©om0
è? 
¥lov”
 : 0;

183 
©om_t
 
	g»ad_mask_¥ecific
 = (
¡©ic_ÿ¡
<©om_t>(1è<< 
f›ld_width_b™s
) - 1;

186 
ušt16_t
 
	g©om0_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

188 
	g_block_¡Üage
[
©om0
] &ğ~(
»ad_mask_¥ecific
 << 
©om0_b™_off£t
);

190 
©om_t
 
	gshiáed_»ad_mask
 = 
»ad_mask_¥ecific
 >> (
f›ld_width_b™s
 - 
¥lov”
);

191 
	g_block_¡Üage
[
©om1
] &ğ~(
shiáed_»ad_mask
);

193 
	g_block_¡Üage
[
©om0
] |ğ(
™em
 << 
©om0_b™_off£t
);

194 
	g_block_¡Üage
[
©om1
] |ğ(
™em
 >> (
f›ld_width_b™s
 - 
¥lov”
));

198 
INLINE
 
add_üoss
(
ušt64_t
 
šdex
, 
©om_t
 
™em
){

199 
add_üoss
(0, 
’Œy_size_b™s
, 
šdex
, 
™em
);

202 
	g‹m¶©e
<
şass
 
	gT
>

203 
šlše
 
T
 
»ad_z”Ùh_wÜd
(
ušt64_t
 
¿w_off£t_b™s
,

204 
ušt64_t
 
f›ld_width_b™s
, ušt64_ˆ
šdex
) const{

205 
cÚ¡ex´
 
T
 
	gÚe
 = 
¡©ic_ÿ¡
<T>(1);

206 
ušt_ç¡8_t
 
	glsb
 = 
¿w_off£t_b™s
 + 
f›ld_width_b™s
 * 
šdex
;

207 cÚ¡ 
T
 
	g»ad_mask_¥ecific
 = (
Úe
 << 
f›ld_width_b™s
) - one;

208 cÚ¡ 
T
* 
	gblock_¡Üage
 = 
»š‹½»t_ÿ¡
<cÚ¡ T*>(
_block_¡Üage
);

209  (
	gblock_¡Üage
[0] >> 
	glsb
è& 
	g»ad_mask_¥ecific
;

213 
šlše
 
©om_t
 
»ad_©om0
(
ušt64_t
 
¿w_off£t_b™s
,

214 
ušt64_t
 
f›ld_width_b™s
, ušt64_ˆ
šdex
) const{

215 
cÚ¡ex´
 
©om_t
 
	gÚe
 = 
¡©ic_ÿ¡
<atom_t>(1);

217 
ušt_ç¡8_t
 
	glsb
 = 
¿w_off£t_b™s
 + 
f›ld_width_b™s
 * 
šdex
;

219 cÚ¡ 
©om_t
 
	g»ad_mask_¥ecific
 = (
Úe
 << 
f›ld_width_b™s
) - one;

220  (
	g_block_¡Üage
[0] >> 
	glsb
è& 
	g»ad_mask_¥ecific
;

227 
šlše
 
©om_t
 
»ad
(
ušt64_t
 
¿w_off£t_b™s
, ušt64_ˆ
f›ld_width_b™s
,

228 
ušt64_t
 
šdex
) const{

229 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

234 
ušt8_t
 
	g©om
 = 
glob®_šdex
 / 
©om_size_b™s
;

238 
©om_t
 
	g»ad_mask_¥ecific
 = (
¡©ic_ÿ¡
<©om_t>(1è<< 
f›ld_width_b™s
) - static_cast<atom_t>(1);

240 
ušt8_t
 
	g©om_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

242  (
	g_block_¡Üage
[
©om
] >> 
	g©om_b™_off£t
) &

243 
	g»ad_mask_¥ecific
;

247 
šlše
 
©om_t
 
»ad
(
ušt64_t
 
šdex
) const{

249 
ušt64_t
 
	g©om_šdex
 = 
šdex
 / 
’Œ›s_³r_©om
;

251 
ušt64_t
 
	g©om_b™_off£t
 = (
šdex
 % 
’Œ›s_³r_©om
è* 
’Œy_size_b™s
;

252  (
	g_block_¡Üage
[
©om_šdex
] >> 
	g©om_b™_off£t
è& 
	g»ad_mask
;

262 
šlše
 
©om_t
 
»ad_üoss_mªy
(
ušt64_t
 
¿w_off£t_b™s
,

263 
ušt64_t
 
f›ld_width_b™s
, ušt64_ˆ
šdex
, ušt64_ˆ
™ems_»ad
) const{

264 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

269 
ušt16_t
 
	g©om0
 = 
glob®_šdex
 / 
©om_size_b™s
;

270 
ušt16_t
 
	g©om1
 = (
glob®_šdex
 + 
f›ld_width_b™s
 * 
™ems_»ad
è/ 
©om_size_b™s
;

271 
©om_t
 
	gmuÉi_™em_»ad_mask
 = (
¡©ic_ÿ¡
<©om_t>(1è<< (
f›ld_width_b™s
 * 
™ems_»ad
)) - 1;

273 
ušt16_t
 
	g¥lov”
 = (
glob®_šdex
 + 
f›ld_width_b™s
 * 
™ems_»ad
è% 
©om_size_b™s
;

274 
	g¥lov”
 = (
©om1
 - 
©om0
è? 
¥lov”
 : 0;

277 
©om_t
 
	g©om0_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

279 
©om_t
 
	glow”
 = (
_block_¡Üage
[
©om0
] >> 
©om0_b™_off£t
è& 
muÉi_™em_»ad_mask
;

281 
©om_t
 
	gshiáed_»ad_mask
 = 
muÉi_™em_»ad_mask
 >> (
f›ld_width_b™s
 * 
™ems_»ad
 - 
¥lov”
);

283 
©om_t
 
	guµ”
 = (
_block_¡Üage
[
©om1
] & (
shiáed_»ad_mask
));

284  (
	guµ”
 << (
f›ld_width_b™s
 * 
	g™ems_»ad
 - 
	g¥lov”
)è| 
	glow”
;

291 
šlše
 
šc
(
ušt64_t
 
¿w_off£t_b™s
,

292 
ušt64_t
 
f›ld_width_b™s
, ušt64_ˆ
šdex
){

293 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

294 
©om_t
 
	g©om
 = 
glob®_šdex
 / 
©om_size_b™s
;

295 
ušt64_t
 
	gcouÁ”_lsb
 = 
glob®_šdex
 % 
©om_size_b™s
;

296 
	g_block_¡Üage
[
©om
] +ğ
¡©ic_ÿ¡
<
©om_t
>(1è<< 
couÁ”_lsb
;

300 
šlše
 
šc_üoss
(
ušt64_t
 
¿w_off£t_b™s
, ušt64_ˆ
f›ld_width_b™s
,

301 
ušt64_t
 
šdex
){

302 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

303 
ušt16_t
 
	g©om
 = 
glob®_šdex
 / 
©om_size_b™s
;

305 
ušt16_t
 
	gcouÁ”_lsb
 = 
glob®_šdex
 % 
©om_size_b™s
;

309 
ušt8_t
 
	gmsb
 = 
_block_¡Üage
[
©om
] >> (
©om_size_b™s
 - 1);

310 
	g_block_¡Üage
[
©om
] +ğ(
¡©ic_ÿ¡
<
©om_t
>(1è<< 
couÁ”_lsb
);

311 
ušt8_t
 
	gmsb_aá”_šc
 = 
_block_¡Üage
[
©om
] >> (
©om_size_b™s
 - 1);

318 
ušt8_t
 
	gÿ¼y
 = (
msb
 =ğ1è& (
msb_aá”_šc
 == 0);

319 
	g_block_¡Üage
[
©om
 + 1] +ğ
ÿ¼y
;

325 
INLINE
 
©om_t
 
»ad_üoss
(
ušt64_t
 
¿w_off£t_b™s
,

326 
ušt64_t
 
f›ld_width_b™s
, ušt64_ˆ
šdex
) const{

327 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

332 
ušt8_t
 
	g©om0
 = 
glob®_šdex
 / 
©om_size_b™s
;

333 
ušt8_t
 
	g©om1
 = (
glob®_šdex
 + 
f›ld_width_b™s
è/ 
©om_size_b™s
;

335 
ušt8_t
 
	g¥lov”
 = (
glob®_šdex
 + 
f›ld_width_b™s
è% 
©om_size_b™s
;

336 
	g¥lov”
 = (
©om1
 - 
©om0
è? 
¥lov”
 : 0;

340 
©om_t
 
	g»ad_mask_¥ecific
 = (
¡©ic_ÿ¡
<©om_t>(1è<< 
f›ld_width_b™s
) - static_cast<atom_t>(1);

343 
ušt8_t
 
	g©om0_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

345 
©om_t
 
	glow”
 = (
_block_¡Üage
[
©om0
] >> 
©om0_b™_off£t
) &

346 
»ad_mask_¥ecific
;

348 
©om_t
 
	gshiáed_»ad_mask
 = 
»ad_mask_¥ecific
 >> (
f›ld_width_b™s
 - 
¥lov”
);

350 
©om_t
 
	guµ”
 = (
_block_¡Üage
[
©om1
] & (
shiáed_»ad_mask
));

351  (
	guµ”
 << (
	gf›ld_width_b™s
 - 
	g¥lov”
)è| 
	glow”
;

356 
INLINE
 
©om_t
 
»ad_üoss
(
ušt64_t
 
šdex
) const{

357  
»ad_üoss
(0, 
’Œy_size_b™s
, 
šdex
);

362 
INLINE
 
add_üoss_Ëá_di¥Ïû_v2
(
ušt64_t
 
¿w_off£t_b™s
,

363 
ušt64_t
 
f›ld_width_b™s
, ušt64_ˆ
šdex
, 
©om_t
 
™em
){

364 
cÚ¡ex´
 
©om_t
 
	gÚe
 = 1;

365 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

368 
ušt8_t
 
	g©om0
 = 
glob®_šdex
 / 
©om_size_b™s
;

371 
ušt8_t
 
	g©om0_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

373 
	gBlock
<
	gblock_size_b™s
, 
	g’Œy_size_b™s
, 
	g©om_t
> 
	gshiáed_block
 = *
this
;

375 
ušt64_t
 
	g©om
 = 0;‡tom < 
	g©oms_³r_block
;‡tom++){

376 
	gshiáed_block
.
	g_block_¡Üage
[
©om
] <<ğ
f›ld_width_b™s
;

378 
ušt64_t
 
	g©om
 = 1;‡tom < 
	g©oms_³r_block
;‡tom++){

379 
	gshiáed_block
.
	g_block_¡Üage
[
©om
] |ğ
_block_¡Üage
[©om - 1] >> (
©om_size_b™s
 - 
f›ld_width_b™s
);

384 
©om_t
 
	g©om0_»ad_mask
 = (
Úe
 << 
©om0_b™_off£t
) - one;

392 
	g_block_¡Üage
[
©om0
] &ğ
©om0_»ad_mask
;

393 
	g_block_¡Üage
[
©om0
] |ğ((~
©om0_»ad_mask
è& 
shiáed_block
.
_block_¡Üage
[atom0]);

396 
ušt64_t
 
	g©om
 = 
©om0
 + 1;‡tom < 
	g©oms_³r_block
;‡tom++){

397 
	g_block_¡Üage
[
©om
] = 
shiáed_block
[atom];

401 
add_üoss
(
¿w_off£t_b™s
, 
f›ld_width_b™s
, 
šdex
, 
™em
);

404 
INLINE
 
add_Ëá_di¥Ïû
(
ušt64_t
 
¿w_off£t_by‹s
,

405 
ušt64_t
 
f›ld_width_by‹s
, ušt64_ˆ
šdex
, 
©om_t
 
™em
,

406 
ušt64_t
 
»giÚ_size_by‹s
){

408 
ušt8_t
* 
	gsourû_add»ss
 = 
»š‹½»t_ÿ¡
<ušt8_t*>(&
_block_¡Üage
[0])

409 + 
¿w_off£t_by‹s
 + 
f›ld_width_by‹s
 * 
šdex
;

410 
ušt8_t
* 
	gde¡š©iÚ_add»ss
 = 
sourû_add»ss
 + 
f›ld_width_by‹s
;

411 
ušt64_t
 
	gby‹s_moved
 = 
»giÚ_size_by‹s
 - 
f›ld_width_by‹s
 - 
šdex
 * field_width_bytes;

412 
memmove
(
de¡š©iÚ_add»ss
, 
sourû_add»ss
, 
by‹s_moved
);

413 
memıy
(
sourû_add»ss
, &
™em
, 
f›ld_width_by‹s
);

416 
INLINE
 
add_üoss_Ëá_di¥Ïû
(
ušt64_t
 
¿w_off£t_b™s
,

417 
ušt64_t
 
f›ld_width_b™s
, ušt64_ˆ
šdex
, 
©om_t
 
™em
){

418 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

420 
ušt8_t
 
	g©om0
 = 
glob®_šdex
 / 
©om_size_b™s
;

423 
ušt8_t
 
	g©om0_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

425 
	gBlock
<
	gblock_size_b™s
, 
	g’Œy_size_b™s
, 
	g©om_t
> 
	gshiáed_block
 = *
this
;

427 
ušt64_t
 
	g©om
 = 0;‡tom < 
	g©oms_³r_block
;‡tom++){

428 
	gshiáed_block
.
	g_block_¡Üage
[
©om
] <<ğ
f›ld_width_b™s
;

430 
ušt64_t
 
	g©om
 = 1;‡tom < 
	g©oms_³r_block
;‡tom++){

431 
	gshiáed_block
.
	g_block_¡Üage
[
©om
] |ğ
_block_¡Üage
[©om - 1] >> (
©om_size_b™s
 - 
f›ld_width_b™s
);

437 
cÚ¡ex´
 
©om_t
 
	gfuÎ_ş—r_mask
 = 
¡©ic_ÿ¡
<atom_t>(0);

440 
cÚ¡ex´
 
©om_t
 
	gfuÎ_´e£rve_mask
 = ~
fuÎ_ş—r_mask
;

444 
©om_t
 
	g©om0_»ad_mask
 = (
¡©ic_ÿ¡
<©om_t>(1è<< 
©om0_b™_off£t
) -

445 
¡©ic_ÿ¡
<
©om_t
>(1);

446 
ušt64_t
 
	g©om
 = 0;‡tom < 
	g©oms_³r_block
;‡tom++){

447 
©om_t
 
	g®‹º©e_ş—r_mask
 = (
©om
 =ğ
©om0
è? 
©om0_»ad_mask
 :

448 
fuÎ_´e£rve_mask
;

449 
©om_t
 
	gş—r_mask
 = (
©om
 > 
©om0
è? 
fuÎ_ş—r_mask
 : 
®‹º©e_ş—r_mask
;

450 
©om_t
 
	g©om_»ad_mask
 = ~
ş—r_mask
;

451 
	g_block_¡Üage
[
©om
] &ğ
ş—r_mask
;

452 
	g_block_¡Üage
[
©om
] |ğ((
©om_»ad_mask
è& 
shiáed_block
.
_block_¡Üage
[atom]);

455 
add_üoss
(
¿w_off£t_b™s
, 
f›ld_width_b™s
, 
šdex
, 
™em
);

460 
INLINE
 
d–_right_di¥Ïû
(
ušt64_t
 
¿w_off£t_by‹s
, uint64_t

461 
f›ld_width_by‹s
, 
ušt64_t
 
šdex
, ušt64_ˆ
»giÚ_size_by‹s
){

463 
ušt8_t
* 
	gba£_add»ss
 = 
»š‹½»t_ÿ¡
<ušt8_t*>(&
_block_¡Üage
[0])

464 + 
¿w_off£t_by‹s
;

465 
ušt8_t
* 
	gsourû_add»ss
 = 
ba£_add»ss
 + 
f›ld_width_by‹s
 * (
šdex
 + 1);

466 
ušt8_t
* 
	gde¡š©iÚ_add»ss
 = 
sourû_add»ss
 - 
f›ld_width_by‹s
;

467 
ušt64_t
 
	gby‹s_moved
 = 
»giÚ_size_by‹s
 - 
f›ld_width_by‹s
 * (
šdex
 + 1);

468 
memmove
(
de¡š©iÚ_add»ss
, 
sourû_add»ss
, 
by‹s_moved
);

469 
mem£t
(
ba£_add»ss
 + 
»giÚ_size_by‹s
 - 
f›ld_width_by‹s
, 0x0,

470 
f›ld_width_by‹s
);

475 
INLINE
 
d–_üoss_right_di¥Ïû
(
ušt64_t
 
¿w_off£t_b™s
,

476 
ušt64_t
 
f›ld_width_b™s
, ušt64_ˆ
šdex
){

477 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
f›ld_width_b™s
 + 
¿w_off£t_b™s
;

479 
ušt8_t
 
	g©om0
 = 
glob®_šdex
 / 
©om_size_b™s
;

482 
ušt8_t
 
	g©om0_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

484 
	gBlock
<
	gblock_size_b™s
, 
	g’Œy_size_b™s
, 
	g©om_t
> 
	gshiáed_block
 = *
this
;

487 
ušt64_t
 
	g©om
 = 0;‡tom < 
	g©oms_³r_block
;‡tom++){

488 
	gshiáed_block
.
	g_block_¡Üage
[
©om
] >>ğ
f›ld_width_b™s
;

492 
ušt64_t
 
	g©om
 = 1;‡tom < 
	g©oms_³r_block
;‡tom++){

493 
	gshiáed_block
.
	g_block_¡Üage
[
©om
 - 1] |ğ
_block_¡Üage
[©om] << (
©om_size_b™s
 - 
f›ld_width_b™s
);

502 
cÚ¡ex´
 
©om_t
 
	gfuÎ_ş—r_mask
 = 
¡©ic_ÿ¡
<atom_t>(0);

505 
cÚ¡ex´
 
©om_t
 
	gfuÎ_´e£rve_mask
 = ~
fuÎ_ş—r_mask
;

509 
©om_t
 
	g©om0_»ad_mask
 = (
¡©ic_ÿ¡
<©om_t>(1è<< 
©om0_b™_off£t
) -

510 
¡©ic_ÿ¡
<
©om_t
>(1);

511 
ušt64_t
 
	g©om
 = 0;‡tom < 
	g©oms_³r_block
;‡tom++){

512 
©om_t
 
	g®‹º©e_ş—r_mask
 = (
©om
 =ğ
©om0
è? 
©om0_»ad_mask
 :

513 
fuÎ_´e£rve_mask
;

514 
©om_t
 
	gş—r_mask
 = (
©om
 > 
©om0
è? 
fuÎ_ş—r_mask
 : 
®‹º©e_ş—r_mask
;

515 
©om_t
 
	g©om_»ad_mask
 = ~
ş—r_mask
;

516 
	g_block_¡Üage
[
©om
] &ğ
ş—r_mask
;

517 
	g_block_¡Üage
[
©om
] |ğ((
©om_»ad_mask
è& 
shiáed_block
.
_block_¡Üage
[atom]);

522 
šlše
 
ş—r_sw©h
(
ušt64_t
 
¿w_off£t_b™s
, ušt64_ˆ
Ën_š_b™s
){

523 
cÚ¡ex´
 
ušt64_t
 
	gÚe
 = 1;

524 
ušt8_t
* 
	gz”Ùh_by‹_poš‹r
 = 
»š‹½»t_ÿ¡
<ušt8_t*>(&
_block_¡Üage
[0]);

525 
št64_t
 
	gfœ¡_fuÎ_by‹
 = (
¿w_off£t_b™s
 / 8) + ((raw_offset_bits % 8) != 0);

526 
št64_t
 
	gËadšg_·¹Ÿl_by‹
 = 
¿w_off£t_b™s
 / 8;

527 
št64_t
 
	gÏ¡_fuÎ_by‹
 = ((
¿w_off£t_b™s
 + 
Ën_š_b™s
) / 8) - ((raw_offset_bits % 8) != 0);

528 
št64_t
 
	gŒašg_·¹Ÿl_by‹
 = (
¿w_off£t_b™s
 + 
Ën_š_b™s
) / 8;

529 
ušt8_t
* 
	gfœ¡_fuÎ_by‹_±r
 = 
z”Ùh_by‹_poš‹r
 + 
fœ¡_fuÎ_by‹
;

530 if(
	gÏ¡_fuÎ_by‹
 >ğ
fœ¡_fuÎ_by‹
è
mem£t
(
fœ¡_fuÎ_by‹_±r
, 0x0, 
Ï¡_fuÎ_by‹
 - fœ¡_fuÎ_by‹ + 
Úe
);

531 
ušt8_t
* 
	gËadšg_·¹Ÿl_by‹_poš‹r
 = 
z”Ùh_by‹_poš‹r
 + 
Ëadšg_·¹Ÿl_by‹
;

532 *
	gËadšg_·¹Ÿl_by‹_poš‹r
 &ğ(
Úe
 << (
¿w_off£t_b™s
 % 8)) - one;

533 
ušt8_t
* 
	gŒašg_·¹Ÿl_by‹_poš‹r
 = 
z”Ùh_by‹_poš‹r
 + 
Œašg_·¹Ÿl_by‹
;

534 *
	gŒašg_·¹Ÿl_by‹_poš‹r
 &ğ~((
Úe
 << ((
¿w_off£t_b™s
 + 
Ën_š_b™s
) % 8)) - one);

537 
šlše
 
ş—r
(
ušt64_t
 
šdex
){

539 
ušt64_t
 
	g©om_šdex
 = 
šdex
 / 
’Œ›s_³r_©om
;

541 
ušt64_t
 
	g©om_b™_off£t
 = (
šdex
 % 
’Œ›s_³r_©om
è* 
’Œy_size_b™s
;

542 
	g_block_¡Üage
[
©om_šdex
] &ğ~(
»ad_mask
 << 
©om_b™_off£t
);

546 
šlše
 
ş—r_üoss
(
ušt64_t
 
šdex
){

547 
ušt64_t
 
	gglob®_šdex
 = 
šdex
 * 
’Œy_size_b™s
;

552 
©om_t
 
	g©om0
 = 
glob®_šdex
 / 
©om_size_b™s
;

553 
©om_t
 
	g©om1
 = (
glob®_šdex
 + 
’Œy_size_b™s
è/ 
©om_size_b™s
;

555 
ušt64_t
 
	g¥lov”
 = (
glob®_šdex
 + 
’Œy_size_b™s
è% 
©om_size_b™s
;

556 
	g¥lov”
 = (
©om1
 - 
©om0
è? 
¥lov”
 : 0;

559 
ušt64_t
 
	g©om0_b™_off£t
 = 
glob®_šdex
 % 
©om_size_b™s
;

561 
	g_block_¡Üage
[
©om0
] &ğ~(
»ad_mask
 << 
©om0_b™_off£t
);

563 
ušt64_t
 
	gshiáed_»ad_mask
 = 
»ad_mask
 >> (
’Œy_size_b™s
 - 
¥lov”
);

564 
	g_block_¡Üage
[
©om1
] &ğ~(
shiáed_»ad_mask
);

569 
	g¡d
::
¡ršg
 
block_¡Üage_as_b™_¡ršg
(
ušt32_t
 
¥acšg
){

570 
¡d
::
¡ršg¡»am
 
ss
;

571 
št32_t
 
	g©om_id
 = 
©oms_³r_block
 - 1;‡tom_id > -1;

572 
	g©om_id
--){

573 
št32_t
 
	gi
 = (
©om_t
) * 8 - 1; i > -1; i--){

574 
	gss
 << ((
	g_block_¡Üage
[
©om_id
] >> 
	gi
) & 1 ? '1' : '0');

575 if((
	gi
 + 
©om_size_b™s
 * 
	g©om_id
è% 
	g¥acšg
 == 0){

576 
ss
 << ' ';

580  
	gss
.
¡r
();

583 
ä›nd
 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am &
os
,

584 cÚ¡ 
	gBlock
<
	gblock_size_b™s
, 
	g’Œy_size_b™s
, 
	g©om_t
>& 
	gb
){

588 if(
	gb
.
	gex¶ic™_´št
){

589 
št64_t
 
	gi
 = 
©oms_³r_block
 - 1; i >= 0; i--){

590 
št64_t
 
	gj
 = 
©om_size_b™s
 - 1; j >= 0; j--){

591 
	gdig™
 = ((
b
.
_block_¡Üage
[
i
] >> (
j
)) & 1) ? '1' : '0';

592 
	gos
 << 
	gdig™
;

594 
	gos
 << " ";

598 
št64_t
 
	gi
 = 
©oms_³r_block
 - 1; i >= 0; i--){

599 
št64_t
 
	gj
 = 
’Œ›s_³r_©om
 - 1; j >= 0; j--){

600 
	gos
 << 
	gb
.
»ad
(
i
 * 
’Œ›s_³r_©om
 + 
j
) << " ";

602 
	gos
 << " ";

605  
	gos
;

	@compressed_cuckoo_config.h

37 #iâdeà
_COMPRESSED_CUCKOO_CONFIG_H


38 
	#_COMPRESSED_CUCKOO_CONFIG_H


	)

40 
Çme¥aû
 
	gCom´es£dCuckoo
{

43 cÚ¡ 
boŞ
 
	gg_ÿche_®igÃd_®loÿ‹
 = 
Œue
;

44 cÚ¡ 
size_t
 
	gg_ÿche_lše_size_by‹s
 = 64;

45 cÚ¡ 
ušt64_t
 
	g¡ash_´efix_g_Ën
 = 4;

48 cÚ¡ 
ušt8_t
 
	gmax_fuÎÃss_couÁ”_width
 = 8;

49 
cÚ¡ex´
 
©om_t
 
	gÚe
 = 
¡©ic_ÿ¡
<atom_t>(1);

51 
	sAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
{

52 
	gTABLE_BASED_OFFSET
,

53 
	gFUNCTION_BASED_OFFSET
,

54 
	gFAN_ET_AL_PARTIAL_KEY


58 
	sIn£¹iÚM‘hodEnum
{

59 
	gFIRST_FIT
,

60 
	gTWO_CHOICE
,

61 
	gHYBRID_SIMPLE
,

62 
	gHYBRID_PIECEWISE
,

64 
	gFIRST_FIT_OPT
,

67 
	sCouÁ”R—dM‘hodEnum
{

68 
	gREAD_SIMPLE
,

69 
	gREAD_CROSS
,

70 
	gREAD_RAW
,

73 
	gREAD_RAW128


76 
	sFšg”´štR—dM‘hodEnum
{

77 
	gREAD_SIMPLE
,

78 
	gREAD_CROSS
,

79 
	gREAD_BYTE


86 
	sFšg”´štCom·risÚM‘hodEnum
{

87 
	gVARIABLE_COUNT
,

88 
	gFIXED_COUNT_AGGRESSIVE
,

89 
	gSEMI_FIXED


92 
	sReduùiÚM‘hodEnum
{

93 
	gPOP_CNT
,

94 
	gPARALLEL_REDUCE
,

95 
	gNAIVE_FULL_EXCLUSIVE_SCAN
,

98 
	sOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
{

100 
	gLEMIRE_FINGERPRINT_MULTIPLY
,

101 
	gRAW_BUCKET_HASH
,

102 
	gCLUSTERED_BUCKET_HASH
,

105 
	sIn£¹Stus
{

106 
	gFAILED_TO_INSERT
 = 0,

107 
	gPLACED_IN_PRIMARY_BUCKET
 = 1,

108 
	gPLACED_IN_SECONDARY_BUCKET
 = 2

	@compressed_cuckoo_filter.h

37 #iâdeà
_COMPRESSED_CUCKOO_FILTER_H


38 
	#_COMPRESSED_CUCKOO_FILTER_H


	)

40 
	~<b™£t
>

41 
	~<c¡dšt
>

42 
	~<io¡»am
>

43 
	~<cm©h
>

44 
	~<c¡dlib
>

45 
	~<c¡ršg
>

47 
	~<ty³_Œa™s
>

48 
	~<£t
>

49 
	~<unÜd”ed_£t
>

50 
	~<®gÜ™hm
>

52 
	~"fixed_pošt.h
"

53 
	~"block.h
"

54 
	~"mÜtÚ_ut.h
"

55 
	~"hash_ut.h
"

56 
	~"veùÜ_ty³s.h
"

57 
	~"com´es£d_cuckoo_cÚfig.h
"

58 
	~"bf.h
"

60 #iâdeà
INLINE


61 
	#INLINE
 
	`__©Œibu‹__
((
®ways_šlše
)è
šlše


	)

64 
	#UNROLL
 
	`__©Œibu‹__
((
	`İtimize
("uÄŞl-loİs")))

	)

66 
	gTe¡”
;

67 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am& 
os
, 
__ušt128_t
 
	gš‹g”
);

69 
Çme¥aû
 
	gCom´es£dCuckoo
{

70 
	sAcûssCouÁ”
{

71 
ušt8_t
 
	g´im¬y_couÁ
 = 0;

72 
ušt8_t
 
	gblock_ov”æow_couÁ
 = 0;

73 
ušt8_t
 
	gbuck‘_ov”æow_couÁ
 = 0;

74 
ušt8_t
 
	gblock_ªd_buck‘_ov”æow_couÁ
 = 0;

87 
	g‹m¶©e
<

88 
ušt16_t
 
	gt_¦Ùs_³r_buck‘
,

89 
ušt16_t
 
	gt_fšg”´št_Ën_b™s
,

90 
ušt16_t
 
	gt_Ùa_Ën_b™s
,

91 
ušt16_t
 
	gt_block_size_b™s
,

92 
S”ŸlizedFixedPošt
 
	gt_rg‘_com´essiÚ_¿tio
,

93 
CouÁ”R—dM‘hodEnum
 
	gt_»ad_couÁ”s_m‘hod
,

94 
Fšg”´štR—dM‘hodEnum
 
	gt_»ad_fšg”´šts_m‘hod
,

95 
ReduùiÚM‘hodEnum
 
	gt_»duùiÚ_m‘hod
,

96 
AÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
 
	gt_®‹º©e_buck‘_£ËùiÚ_m‘hod
,

97 
Ov”æowT¿ckšgA¼ayHashšgM‘hodEnum
 
	gt_mÜtÚ_Ùa_hashšg_m‘hod
,

98 
boŞ
 
	gt_»sizšg_’abËd
,

99 
boŞ
 
	gt_»m­_’abËd
,

100 
boŞ
 
	gt_cŞlisiÚ_»sŞutiÚ_’abËd
,

101 
boŞ
 
	gt_mÜtÚ_f‹r_funùiÚ®™y_’abËd
,

102 
boŞ
 
	gt_block_fuÎÃss_¬¿y_’abËd
,

103 
boŞ
 
	gt_hªdË_cÚæiùs
,

104 
Fšg”´štCom·risÚM‘hodEnum
 
	gt_fšg”´št_com·risÚ_m‘hod


106 
	sCom´es£dCuckooF‹r
{

108 
usšg
 
	gblock_t
 = 
MÜtÚ
::
Block
<
t_block_size_b™s
, 
	gt_fšg”´št_Ën_b™s
,

109 
	g©om_t
>;

110 
cÚ¡ex´
 
boŞ
 
	g_DEBUG
 = 
çl£
;

112 
cÚ¡ex´
 
boŞ
 
	g_´št_acûss_couÁs
 = 
çl£
;

113 
cÚ¡ex´
 
boŞ
 
	g_»sizšg_’abËd
 = 
t_»sizšg_’abËd
;

114 
cÚ¡ex´
 
boŞ
 
	g_u£_bloom_Ùa
 = 
çl£
;

127 
cÚ¡ex´
 
boŞ
 
	g_¥ecŸl_nuÎ_fšg”´št
 = 
çl£
;

129 
cÚ¡ex´
 
ušt_ç¡16_t
 
	g_¦Ùs_³r_buck‘
 = 
t_¦Ùs_³r_buck‘
;

130 
cÚ¡ex´
 
ušt_ç¡16_t
 
	g_fšg”´št_Ën_b™s
 = 
t_fšg”´št_Ën_b™s
;

132 
cÚ¡ex´
 
ušt_ç¡16_t
 
	g_Ùa_Ën_b™s
 = 
t_Ùa_Ën_b™s
;

133 
cÚ¡ex´
 
ušt_ç¡16_t
 
	g_block_size_b™s
 = 
t_block_size_b™s
;

148 
cÚ¡ex´
 
In£¹iÚM‘hodEnum
 
	g_š£¹iÚ_m‘hod
 =

149 
In£¹iÚM‘hodEnum
::
FIRST_FIT
;

166 
cÚ¡ex´
 
CouÁ”R—dM‘hodEnum
 
	g_»ad_couÁ”s_m‘hod
 =

167 
t_»ad_couÁ”s_m‘hod
;

173 
cÚ¡ex´
 
Fšg”´štR—dM‘hodEnum
 
	g_»ad_fšg”´šts_m‘hod
 =

174 
t_»ad_fšg”´šts_m‘hod
;

176 
cÚ¡ex´
 
ReduùiÚM‘hodEnum
 
	g_»duùiÚ_m‘hod
 =

177 
t_»duùiÚ_m‘hod
;

179 
cÚ¡ex´
 
AÉ”Ç‹Buck‘S–eùiÚM‘hodEnum


180 
	g_®‹º©e_buck‘_£ËùiÚ_m‘hod
 = 
t_®‹º©e_buck‘_£ËùiÚ_m‘hod
;

189 
cÚ¡ex´
 
Ov”æowT¿ckšgA¼ayHashšgM‘hodEnum


190 
	g_mÜtÚ_Ùa_hashšg_m‘hod
 = 
t_mÜtÚ_Ùa_hashšg_m‘hod
;

194 
cÚ¡ex´
 
boŞ
 
	g_»m­_’abËd
 = 
t_»m­_’abËd
;

195 
cÚ¡ex´
 
boŞ
 
	g_cŞlisiÚ_»sŞutiÚ_’abËd
 =

196 
t_cŞlisiÚ_»sŞutiÚ_’abËd
;

197 
cÚ¡ex´
 
boŞ
 
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
 =

198 (
t_Ùa_Ën_b™s
 > 0);

203 
cÚ¡ex´
 
boŞ
 
	g_block_fuÎÃss_¬¿y_’abËd
 =

204 
t_block_fuÎÃss_¬¿y_’abËd
;

207 
cÚ¡ex´
 
boŞ
 
	g_hªdË_cÚæiùs
 = 
t_hªdË_cÚæiùs
;

219 
cÚ¡ex´
 
Fšg”´štCom·risÚM‘hodEnum


220 
	g_fšg”´št_com·risÚ_m‘hod
 = 
t_fšg”´št_com·risÚ_m‘hod
;

222 
cÚ¡ex´
 
ušt_ç¡8_t
 
	g_max_pİ_couÁ_width_š_b™s
 = 128;

225 
ušt_ç¡64_t
 
	g_tÙ®_buck‘s
;

226 
ušt_ç¡64_t
 
	g_tÙ®_¦Ùs
;

228 
cÚ¡ex´
 
ušt_ç¡64_t
 
	g_fuÎÃss_couÁ”_width
 =

229 
ut
::
log2û
(
_¦Ùs_³r_buck‘
 + 1);

230 
cÚ¡ex´
 
ušt_ç¡64_t
 
	g_b™s_³r_uncom´es£d_buck‘
 =

231 
t_fšg”´št_Ën_b™s
 * 
_¦Ùs_³r_buck‘
;

232 
cÚ¡ex´
 
ušt_ç¡64_t
 
	g_buck‘s_³r_block
 = (
_block_size_b™s
 -

233 
_Ùa_Ën_b™s
)/ (
_fuÎÃss_couÁ”_width
 +

234 
FixedPošt
(
t_rg‘_com´essiÚ_¿tio
).
to_doubË
() *

235 
_b™s_³r_uncom´es£d_buck‘
);

248 
cÚ¡ex´
 
št_ç¡16_t
 
	g_Ùa_lbi_š£¹iÚ_th»shŞd
 = -1;

252 
ušt_ç¡64_t
 
	g_tÙ®_blocks
;

253 
cÚ¡ex´
 
ušt_ç¡64_t
 
	g_max_fšg”´šts_³r_block
 = (
_block_size_b™s
 - 
_Ùa_Ën_b™s
 - 
_buck‘s_³r_block
 * 
_fuÎÃss_couÁ”_width
è/ 
_fšg”´št_Ën_b™s
;

254 
cÚ¡ex´
 
ušt_ç¡64_t
 
	g_fuÎÃss_couÁ”s_off£t
 = 0;

255 
cÚ¡ex´
 
ušt_ç¡64_t
 
	g_ov”æow_Œackšg_¬¿y_off£t
 = 
_fuÎÃss_couÁ”s_off£t
 + 
_buck‘s_³r_block
 * 
_fuÎÃss_couÁ”_width
;

257 
cÚ¡ex´
 
ušt_ç¡64_t
 
	g_fšg”´št_off£t
 = 
_fuÎÃss_couÁ”s_off£t
 + 
_buck‘s_³r_block
 * 
_fuÎÃss_couÁ”_width
 + 
_Ùa_Ën_b™s
;

259 
©om_t
 
	g_pİcouÁ_masks
[
max_fuÎÃss_couÁ”_width
] = {};

260 
__ušt128_t
 
	g_pİcouÁ_masks128
[
max_fuÎÃss_couÁ”_width
] = {};

262 
usšg
 
	gfÿ_t
 = 
ty³Çme
 
¡d
::
cÚd™iÚ®
<(
_fuÎÃss_couÁ”_width
 * 
_buck‘s_³r_block
 <ğ64), 
	gušt64_t
, 
	g__ušt128_t
>::
ty³
;

263 
fÿ_t
 
	g_»duùiÚ_masks
[
ut
::
log2û
(
_buck‘s_³r_block
)] = {};

265 
couÁ”_t
* 
	g_summed_couÁ”s
;

266 
block_t
* 
	g_¡Üage
;

267 
	g¡d
::
veùÜ
<
boŞ
> 
_block_fuÎÃss_¬¿y
;

268 
B™MixMurmur
 
	g_hash”
;

270 
ušt_ç¡16_t
 
	g_»size_couÁ
;

272 
ä›nd
 
	gTe¡”
;

274 
	gpublic
:

276 
ex¶ic™
 
Com´es£dCuckooF‹r
(
ušt64_t
 
tÙ®_¦Ùs
) :

281 
_tÙ®_buck‘s
(
d‘”mše_tÙ®_buck‘s
<
ušt_ç¡64_t
>(
_¦Ùs_³r_buck‘
,

282 
tÙ®_¦Ùs
 / 
FixedPošt
(
t_rg‘_com´essiÚ_¿tio
).
to_doubË
(), 
_buck‘s_³r_block
)),

283 
_tÙ®_¦Ùs
(
_tÙ®_buck‘s
 * 
_¦Ùs_³r_buck‘
),

284 
_tÙ®_blocks
(
_tÙ®_buck‘s
 / 
_buck‘s_³r_block
),

285 
_block_fuÎÃss_¬¿y
(
_block_fuÎÃss_¬¿y_’abËd
 ? 
_tÙ®_blocks
 : 0, 0),

286 
_»size_couÁ
(0)

290 
¡©ic_as£¹
((
_mÜtÚ_f‹r_funùiÚ®™y_’abËd
 ^ (
_Ùa_Ën_b™s
 == 0)),

314 if(
	g_tÙ®_buck‘s
 & 0x1){

315 
	g¡d
::
û¼
 << "ERROR: Total buckets‚eedso beƒven\n";

316 
ex™
(1);

322 if(
	g_»duùiÚ_m‘hod
 =ğ
ReduùiÚM‘hodEnum
::
POP_CNT
 && !(
_fuÎÃss_couÁ”_width
 * 
_buck‘s_³r_block
 <ğ
_max_pİ_couÁ_width_š_b™s
)){

323 
¡d
::
û¼
 << "ERROR: With…opcount-based„eduction,he fullness counters"

325 
	g¡d
::
û¼
 << *
this
 << 
¡d
::
’dl
;

326 
ex™
(1);

330 
	gg’”©e_pİcouÁ_masks
<
	g©om_t
>(
	g_pİcouÁ_masks
);

331 
	gg’”©e_pİcouÁ_masks
<
	g__ušt128_t
>(
	g_pİcouÁ_masks128
);

332 
	gg’”©e_»duùiÚ_masks
<
	gfÿ_t
>(
	g_»duùiÚ_masks
);

335 
h—p_®loÿ‹_bË_ªd_summed_couÁ”s_bufãr
();

338 ~
Com´es£dCuckooF‹r
(){

339 if(
	gg_ÿche_®igÃd_®loÿ‹
){

340 
ä“
(
_summed_couÁ”s
);

341 
ä“
(
_¡Üage
);

344 
	gd–‘e
[] 
	g_summed_couÁ”s
;

345 
	gd–‘e
[] 
	g_¡Üage
;

350 
INLINE
 
©om_t
 
fšg”´št_funùiÚ
(cÚ¡ 
hash_t
 
¿w_hash
) const{

351 
©om_t
 
	gfšg”´št
 =

352 
¿w_hash
 >> (8 * Ôaw_hashè- 
_fšg”´št_Ën_b™s
);

353 if(
	g_¥ecŸl_nuÎ_fšg”´št
 && (
	gfšg”´št
 == 0)){

354 
fšg”´št
 = 1;

356  
	gfšg”´št
;

361 
INLINE
 
hash_t
 
m­_to_buck‘
(cÚ¡ hash_ˆ
¿w_hash
, cÚ¡ hash_ˆ
modulus
) const{

362 
cÚ¡ex´
 
hash_t
 
	gÚe
 = 1;

363 
cÚ¡ex´
 
hash_t
 
	gshiá
 = 8 * (
¿w_hash
è- 
_fšg”´št_Ën_b™s
;

364 
cÚ¡ex´
 
hash_t
 
	gmask
 = (
Úe
 << 
shiá
) - one;

365 ià(
	g_»sizšg_’abËd
){

366 cÚ¡ 
hash_t
 
	gÜigš®_modulus
 = 
modulus
 >> 
_»size_couÁ
;

367 cÚ¡ 
hash_t
 
	gÜigš®_buck‘_id
 = 
ut
::
ç¡_mod_®‹º©ive
<hash_t>(

368 
¿w_hash
 & 
mask
, 
	gÜigš®_modulus
, 
	gshiá
);

369 cÚ¡ 
hash_t
 
	gÜigš®_block_id
 = 
Üigš®_buck‘_id
 / 
_buck‘s_³r_block
;

370 cÚ¡ 
hash_t
 
	glbi
 = 
Üigš®_buck‘_id
 % 
_buck‘s_³r_block
;

371 cÚ¡ 
©om_t
 
	gfšg”´št
 = 
fšg”´št_funùiÚ
(
¿w_hash
);

372 cÚ¡ 
hash_t
 
	gÃw_block_id
 = (
Üigš®_block_id
 << 
_»size_couÁ
) |

373 ((
fšg”´št
 >> (
_fšg”´št_Ën_b™s
 - 
_»size_couÁ
)è& ((
Úe
 << _resize_count) - one));

374 cÚ¡ 
hash_t
 
	gÃw_buck‘_id
 = (
Ãw_block_id
 * 
_buck‘s_³r_block
è+ 
lbi
;

375  
	gÃw_buck‘_id
;

377  
	gut
::
ç¡_mod_®‹º©ive
<
hash_t
>(
¿w_hash
 & 
mask
, 
	gmodulus
, 
	gshiá
);

381 
INLINE
 
hash_t
 
çn_‘_®_·¹Ÿl_key_cuckoo_hash_®‹º©e_buck‘
(hash_t

382 
buck‘_id
, cÚ¡ 
©om_t
 
fšg”´št
) const{

383  (
	gbuck‘_id
 ^ 
¿w_´im¬y_hash
(
fšg”´št
)è& (
	g_tÙ®_buck‘s
 - 1);

387 
INLINE
 
hash_t
 
d‘”mše_®‹º©e_buck‘
(hash_ˆ
buck‘_id
,

388 cÚ¡ 
©om_t
 
fšg”´št
) const{

389 
št64_t
 
	goff£t
;

390 
cÚ¡ex´
 
hash_t
 
	gÚe
 = 1;

391 
	g_®‹º©e_buck‘_£ËùiÚ_m‘hod
){

392 
	gAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
TABLE_BASED_OFFSET
:{

393 
cÚ¡ex´
 
št16_t
 
off£ts
[] = {83, 149, 211, 277, 337, 397, 457, 521,

397 
¡©ic_as£¹
(
off£ts
[0] > 
_buck‘s_³r_block
,

399 
	goff£t
 = 
off£ts
[
fšg”´št
 % ((offsets) / (offsets[0]))];

403 
	gAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
FUNCTION_BASED_OFFSET
:{

404 
off£t
 = ((
¿w_´im¬y_hash
(
fšg”´št
) & 0x1fff) +

405 (
_buck‘s_³r_block
)è| 
Úe
;

408 
	gAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
FAN_ET_AL_PARTIAL_KEY
:

409  
çn_‘_®_·¹Ÿl_key_cuckoo_hash_®‹º©e_buck‘
(
buck‘_id
,

410 
fšg”´št
);

414 if(
	g_»sizšg_’abËd
){

415 
hash_t
 
	gblock_id
 = 
buck‘_id
 / 
_buck‘s_³r_block
;

416 
hash_t
 
	glbi
 = 
buck‘_id
 % 
_buck‘s_³r_block
;

417 
hash_t
 
	gŞd_block_id
 = 
block_id
 >> 
_»size_couÁ
;

418 
hash_t
 
	gŞd_buck‘_id
 = 
Şd_block_id
 * 
_buck‘s_³r_block
 + 
lbi
;

419 
	gbuck‘_id
 = 
Şd_buck‘_id
;

423 
	goff£t
 = (
buck‘_id
 & 
Úe
è? 
off£t
 : -offset;

426 
št64_t
 
	gouut
 = 
¡©ic_ÿ¡
<št64_t>(
buck‘_id
è+ 
off£t
;

427 if(
	g_»sizšg_’abËd
){

428 if(
	gouut
 < 0){

429 
	gouut
 +ğ
_tÙ®_buck‘s
 >> 
_»size_couÁ
;

431 if(
	g¡©ic_ÿ¡
<
	gušt64_t
>(
	gouut
è>ğ(
_tÙ®_buck‘s
 >> 
_»size_couÁ
)){

432 
ouut
 -ğ
_tÙ®_buck‘s
 >> 
_»size_couÁ
;

435 
hash_t
 
	gouut_block_id
 = 
ouut
 / 
_buck‘s_³r_block
;

436 
hash_t
 
	gouut_lbi
 = 
ouut
 % 
_buck‘s_³r_block
;

437 
hash_t
 
	gÃw_ouut_block_id
 = (
ouut_block_id
 << 
_»size_couÁ
) |

438 ((
fšg”´št
 >> (
_fšg”´št_Ën_b™s
 - 
_»size_couÁ
)è& ((
Úe
 << _resize_count) - one));

439 
	gouut
 = 
Ãw_ouut_block_id
 * 
_buck‘s_³r_block
 + 
ouut_lbi
;

442 if(
	gouut
 < 0){

443 
	gouut
 +ğ
_tÙ®_buck‘s
;

445 if(
	g¡©ic_ÿ¡
<
	gušt64_t
>(
	gouut
è>ğ
_tÙ®_buck‘s
){

446 
ouut
 -ğ
_tÙ®_buck‘s
;

449  
	gouut
;

453 
šlše
 
block_t
* 
®loÿ‹_ÿche_®igÃd_¡Üage
(
ušt64_t
 
tÙ®_blocks
){

454 
size_t
 
	g®loÿtiÚ_size
 = (
block_t
è* 
tÙ®_blocks
;

455 
block_t
* 
	g¡Üage
 = 
¡©ic_ÿ¡
<block_t*>(
®igÃd_®loc
(

456 
g_ÿche_lše_size_by‹s
, 
®loÿtiÚ_size
));

458 
cÚ¡ex´
 
boŞ
 
	g_Úly_ş—r_Ùa_ªd_fÿ
 = 
çl£
;

459 if(!
	g_Úly_ş—r_Ùa_ªd_fÿ
){

460 
hash_t
 
	gi
 = 0; i < 
	gtÙ®_blocks
; i++){

461 
	g¡Üage
[
i
] = 
block_t
{};

463  
	g¡Üage
;

465 
hash_t
 
	gi
 = 0; i < 
	gtÙ®_blocks
; i++){

467 
cÚ¡ex´
 
ušt64_t
 
	gfÿ_Ëngth_b™s
 = 
_buck‘s_³r_block
 *

468 
_fuÎÃss_couÁ”_width
;

469 
cÚ¡ex´
 
ušt64_t
 
	gcombšed_fÿ_Ùa_Ën_š_b™s
 = 
fÿ_Ëngth_b™s
 +

470 
_Ùa_Ën_b™s
;

471 
¡©ic_as£¹
((
_fuÎÃss_couÁ”s_off£t
 + 
fÿ_Ëngth_b™s
 ==

472 
_ov”æow_Œackšg_¬¿y_off£t
è&& (
_fuÎÃss_couÁ”s_off£t
 <

473 
_ov”æow_Œackšg_¬¿y_off£t
), "In compressed_cuckoo_filter.h,\n"

477 
cÚ¡ex´
 
boŞ
 
	gu£_mem£t
 =

478 (((
fÿ_Ëngth_b™s
 + 
_Ùa_Ën_b™s
) % 8) == 0)

479 && (
_fuÎÃss_couÁ”s_off£t
 % 8 == 0);

480 if(
	gu£_mem£t
){

481 
mem£t
(
»š‹½»t_ÿ¡
<
ušt8_t
*>(&
¡Üage
[
i
]) +

482 (
_fuÎÃss_couÁ”s_off£t
 / 8), 0x0,

483 
combšed_fÿ_Ùa_Ën_š_b™s
 / 8);

486 
	g¡Üage
[
i
].
ş—r_sw©h
(
_fuÎÃss_couÁ”s_off£t
,

487 
combšed_fÿ_Ùa_Ën_š_b™s
);

490  
	g¡Üage
;

493 
h—p_®loÿ‹_bË_ªd_summed_couÁ”s_bufãr
(){

494 if(
	gg_ÿche_®igÃd_®loÿ‹
){

497 
	g_¡Üage
 = 
®loÿ‹_ÿche_®igÃd_¡Üage
(
_tÙ®_blocks
);

499 
size_t
 
	g®loÿtiÚ_size
 = (*
_summed_couÁ”s
) *

500 (
_buck‘s_³r_block
 + 1);

502 
	g®loÿtiÚ_size
 = (
®loÿtiÚ_size
 + 
g_ÿche_lše_size_by‹s
 - 1) &

503 ~(
g_ÿche_lše_size_by‹s
 - 1);

504 
	g_summed_couÁ”s
 = 
¡©ic_ÿ¡
<
deşty³
(
_summed_couÁ”s
)>(
®igÃd_®loc
(
g_ÿche_lše_size_by‹s
, 
®loÿtiÚ_size
));

507 if(
	g_¡Üage
 =ğ
NULL
 || 
_summed_couÁ”s
 == NULL){

508 
¡d
::
û¼
 << "ERROR: AÎoÿtšgabË memÜy faed" << std::
’dl
;

509 
ex™
(1);

513 
	g_summed_couÁ”s
 = 
Ãw
 
couÁ”_t
[
_buck‘s_³r_block
 + 1]();

514 
	g_¡Üage
 = 
Ãw
 
block_t
[
_tÙ®_blocks
]();

518 
	g‹m¶©e
<
şass
 
	gT
>

519 
šlše
 
g’”©e_»duùiÚ_masks
(
T
* 
»duùiÚ_masks
){

522 
ušt32_t
 
	gi
 = 0; i < 
	gut
::
log2û
(
_buck‘s_³r_block
); i++){

523 
ušt32_t
 
	gj
 = 0; j < (
	gT
è* 8; j+=2*(
_fuÎÃss_couÁ”_width
 << 
i
)){

524 
»duùiÚ_masks
[
i
] +=

525 ((
¡©ic_ÿ¡
<
T
>(1è<< (
_fuÎÃss_couÁ”_width
 << 
i
)è- 1è<< 
j
;

527 if(
	g_DEBUG
){

528 
	g¡d
::
cout
 << "REDUCTION MASK " << 
i
 << ": " <<

529 
ut
::
bš_¡ršg
<
T
>(
»duùiÚ_masks
[
i
], 
	g_fuÎÃss_couÁ”_width
)

530 << 
	g¡d
::
’dl
;

541 
	g‹m¶©e
 <
şass
 
	gT
>

542 
šlše
 
g’”©e_pİcouÁ_masks
(
T
* 
pİcouÁ_masks
){

543 
ušt32_t
 
	gi
 = 0; i < 
	g_fuÎÃss_couÁ”_width
; i++){

544 
ušt32_t
 
	gj
 = 
i
; j < (
	gT
è* 8; j+ğ
_fuÎÃss_couÁ”_width
){

545 
pİcouÁ_masks
[
i
] +ğ(
¡©ic_ÿ¡
<
T
>(1è<< 
j
);

547 if(
	g_DEBUG
){

548 
	g¡d
::
cout
 << "POPCOUNT MASK " << 
i
 << " " <<

549 
ut
::
bš_¡ršg
(
pİcouÁ_masks
[
i
], 
_fuÎÃss_couÁ”_width
)

550 << 
	g¡d
::
’dl
;

561 
šlše
 
couÁ”_t
* 
fuÎ_exşusive_sÿn
(cÚ¡ 
ušt64_t
 
block_id
){

562 
	g_summed_couÁ”s
[0] = 0;

563 
couÁ”_t
 
	gi
 = 1; i < 
	g_buck‘s_³r_block
 + 1; i++){

564 
	g_summed_couÁ”s
[
i
] = 
_summed_couÁ”s
[˜- 1] + 
»ad_couÁ”
(
block_id
,

565 
i
 - 1);

567  
	g_summed_couÁ”s
;

571 
INLINE
 
ušt16_t
 
exşusive_»duû_w™h_pİcouÁ
(cÚ¡ 
block_t
& 
b
,

572 
ušt8_t
 
couÁ”_šdex
) const{

573 
cÚ¡ex´
 
boŞ
 
	gu£_64b™_pİút
 = 
_fuÎÃss_couÁ”_width
 *

574 
_buck‘s_³r_block
 <= 64;

575 if(
	gu£_64b™_pİút
){

576  
exşusive_»duû_w™h_pİcouÁ64
(
b
, 
couÁ”_šdex
);

579  
exşusive_»duû_w™h_pİcouÁ128
(
b
, 
couÁ”_šdex
);

583 
INLINE
 
ušt16_t
 
exşusive_»duû
(cÚ¡ 
block_t
& 
b
,

584 
ušt8_t
 
couÁ”_šdex
) const{

585 
ušt16_t
 
	gsum
;

586 
	g_»duùiÚ_m‘hod
){

587 
	gReduùiÚM‘hodEnum
::
NAIVE_FULL_EXCLUSIVE_SCAN
:

588 
sum
 = 
»duû_up_to_šdex
(
b
, 
couÁ”_šdex
);

590 
	gReduùiÚM‘hodEnum
::
POP_CNT
:

591 
sum
 = 
exşusive_»duû_w™h_pİcouÁ
(
b
, 
couÁ”_šdex
);

593 
	gReduùiÚM‘hodEnum
::
PARALLEL_REDUCE
:

594 
sum
 = 
exşusive_»duû_w™h_·¿Î–_sum
(
b
, 
couÁ”_šdex
);

597 
¡d
::
û¼
 << "ERROR: Unsupported ReductionMethodEnum value\n";

598 
ex™
(1);

601  
	gsum
;

604 
	g‹m¶©e
<
ušt64_t
 
	gSIZE
>

605 
INLINE
 
	g¡d
::
¬¿y
<
couÁ”_t
, 
	gSIZE
> 
exşusive_»duû_mªy
(

606 cÚ¡ 
¡d
::
¬¿y
<
hash_t
, 
SIZE
>& 
block_ids
,

607 cÚ¡ 
¡d
::
¬¿y
<
couÁ”_t
, 
SIZE
>& 
couÁ”_šdexes
) const{

608 
	g¡d
::
¬¿y
<
couÁ”_t
, 
	gSIZE
> 
	gsums
;

609 
	g_»duùiÚ_m‘hod
){

611 
	gReduùiÚM‘hodEnum
::
NAIVE_FULL_EXCLUSIVE_SCAN
:

612 
ušt64_t
 
i
 = 0; 
	gi
 < 
	gSIZE
; i++){

613 
	gsums
[
i
] = 
»duû_up_to_šdex
(
_¡Üage
[
block_ids
[i]],

614 
couÁ”_šdexes
[
i
]);

617 
	gReduùiÚM‘hodEnum
::
POP_CNT
:{

620 
cÚ¡ex´
 
boŞ
 
u£_pİút64
 = (
_fuÎÃss_couÁ”s_off£t
 +

621 
_fuÎÃss_couÁ”_width
 * 
_buck‘s_³r_block
) <= 64;

622 if(
	gu£_pİút64
){

623  
	gexşusive_»duû_w™h_pİcouÁ64
<
	gb©ch_size
>(
	gblock_ids
,

624 
	gcouÁ”_šdexes
);

627  
	gexşusive_»duû_w™h_pİcouÁ128
<
	gb©ch_size
>(
	gblock_ids
,

628 
	gcouÁ”_šdexes
);

632 
	gReduùiÚM‘hodEnum
::
PARALLEL_REDUCE
:

633 
ušt64_t
 
i
 = 0; 
	gi
 < 
	gSIZE
; i++){

634 
	gsums
[
i
] = 
exşusive_»duû_w™h_·¿Î–_sum
(
_¡Üage
[
block_ids
[i]],

635 
couÁ”_šdexes
[
i
]);

639 
¡d
::
û¼
 << "ERROR: Unsupported ReductionMethodEnum value\n";

640 
ex™
(1);

643  
	gsums
;

654 
ušt16_t
 
exşusive_»duû_w™h_·¿Î–_sum
(cÚ¡ 
block_t
& 
b
,

655 
ušt8_t
 
couÁ”_šdex
) const{

659 cÚ¡ 
fÿ_t
 
	gmask
 = (
¡©ic_ÿ¡
<fÿ_t>(
Úe
è<< (
_fuÎÃss_couÁ”_width
 * 
couÁ”_šdex
)) - one;

663 
fÿ_t
 
	gsum
;

664 
memıy
(&
sum
, &
b
, (
fÿ_t
));

665 
	gsum
 >>ğ
_fuÎÃss_couÁ”s_off£t
;

666 
	gsum
 &ğ
mask
;

670 
cÚ¡ex´
 
ušt_ç¡8_t
 
	gnum_·s£s
 = 
ut
::
log2û
(
_buck‘s_³r_block
);

671 
¡©ic_as£¹
(
_max_fšg”´šts_³r_block
 > 0, "The‚umber of fingerprints "

673 
cÚ¡ex´
 
ušt_ç¡8_t
 
	gmasked_couÁ
 = 
¡©ic_ÿ¡
<ušt_ç¡8_t>(
ut
::
log2û
(

674 
_max_fšg”´šts_³r_block
è/ 
_fuÎÃss_couÁ”_width
) - 1;

675 
št8_t
 
	gi
 = 0; i < 
	gmasked_couÁ
; i++){

676 
	gsum
 = (
sum
 & 
_»duùiÚ_masks
[
i
]è+ ((sum >> (
_fuÎÃss_couÁ”_width
 << i)) & _reduction_masks[i]);

678 
št8_t
 
	gi
 = 
masked_couÁ
; i < 
	gnum_·s£s
; i++){

679 
	gsum
 +ğ(
sum
 >> (
_fuÎÃss_couÁ”_width
 << 
i
));

681  
	gsum
 & ((
	gÚe
 << (
	g_fuÎÃss_couÁ”_width
 * (
	gmasked_couÁ
 + one))) - one);

684 
	g‹m¶©e
<
ušt64_t
 
	gSIZE
>

685 
INLINE
 
	g¡d
::
¬¿y
<
couÁ”_t
, 
	gSIZE
> 
exşusive_»duû_w™h_pİcouÁ64
(

686 cÚ¡ 
¡d
::
¬¿y
<
hash_t
, 
SIZE
>& 
block_ids
,

687 cÚ¡ 
¡d
::
¬¿y
<
couÁ”_t
, 
SIZE
>& 
couÁ”_šdexes
) const{

688 
cÚ¡ex´
 
ušt64_t
 
	gÚe
 = 1;

689 
ušt64_t
 
	gcouÁ”s
;

690 
	g¡d
::
¬¿y
<
couÁ”_t
, 
	gSIZE
> 
	gsums
;

692 
ušt64_t
 
	gpİcouÁ_mask
 = 
_pİcouÁ_masks
[0];

693 
ušt64_t
 
	gi
 = 0; i < 
	gSIZE
; i++){

694 
memıy
(&
couÁ”s
, &
_¡Üage
[
block_ids
[
i
]], (
__ušt64_t
));

695 
ušt64_t
 
	gmask
 = (
Úe
 << (
_fuÎÃss_couÁ”_width
 * (
couÁ”_šdexes
[
i
])))

696 - 
Úe
;

697 
	gcouÁ”s
 &ğ
mask
;

698 
	gsums
[
i
] = 0;

699 
ušt8_t
 
	gj
 = 0; j < 
	g_fuÎÃss_couÁ”_width
; j++){

700 
	gsums
[
i
] +ğ
__butš_pİcouÁÎ
(
couÁ”s
 & (
pİcouÁ_mask
 << 
j
)) << j;

703  
	gsums
;

706 
	g‹m¶©e
<
ušt64_t
 
	gSIZE
>

707 
INLINE
 
	g¡d
::
¬¿y
<
couÁ”_t
, 
	gSIZE
> 
exşusive_»duû_w™h_pİcouÁ128
(

708 cÚ¡ 
¡d
::
¬¿y
<
hash_t
, 
SIZE
>& 
block_ids
,

709 cÚ¡ 
¡d
::
¬¿y
<
couÁ”_t
, 
SIZE
>& 
couÁ”_šdexes
) const{

710 
cÚ¡ex´
 
__ušt128_t
 
	gÚe
 = 1;

711 
cÚ¡ex´
 
ušt64_t
 
	gušt64_max
 = ~(
¡©ic_ÿ¡
<uint64_t>(0));

713 
	g¡d
::
¬¿y
<
__ušt128_t
, 
	gSIZE
> 
	gcouÁ”s
;

714 
	g¡d
::
¬¿y
<
couÁ”_t
, 
	gSIZE
> 
	gsums
;

716 
ušt64_t
 
	gi
 = 0; i < 
	gSIZE
; i++){

717 
memıy
(&
couÁ”s
[
i
], &
_¡Üage
[
block_ids
[i]], (
__ušt128_t
));

718 
__ušt128_t
 
	gmask
 = (
Úe
 << (
_fuÎÃss_couÁ”_width
 *

719 (
couÁ”_šdexes
[
i
]))è- 
Úe
;

720 
	gcouÁ”s
[
i
] &ğ
mask
;

721 
	gsums
[
i
] = 0;

722 
__ušt128_t
 
	gpİcouÁ_mask128
 = 
_pİcouÁ_masks128
[0];

723 
ušt8_t
 
	gj
 = 0; j < 
	g_fuÎÃss_couÁ”_width
; j++){

724 cÚ¡ 
ušt64_t
 
	gpİcouÁ_mask1
 = 
pİcouÁ_mask128
 & 
ušt64_max
;

725 cÚ¡ 
ušt64_t
 
	gpİcouÁ_mask2
 = 
pİcouÁ_mask128
 >> 64;

726 
	gsums
[
i
] +ğ
__butš_pİcouÁÎ
(
couÁ”s
[i] & 
pİcouÁ_mask1
è<< 
j
;

727 
	gsums
[
i
] +ğ
__butš_pİcouÁÎ
((
couÁ”s
[i] >> 64è& 
pİcouÁ_mask2
è<< 
j
;

728 
	gpİcouÁ_mask128
 <<= 1;

732  
	gsums
;

735 
INLINE
 
ušt16_t
 
exşusive_»duû_w™h_pİcouÁ128
(cÚ¡ 
block_t
& 
b
,

736 
ušt8_t
 
couÁ”_šdex
) const{

737 
cÚ¡ex´
 
__ušt128_t
 
	gÚe
 = 1;

739 cÚ¡ 
ušt64_t
 
	gshiá
 = 
_fuÎÃss_couÁ”_width
 * 
couÁ”_šdex
;

740 cÚ¡ 
__ušt128_t
 
	gmask
 = 
shiá
 =ğ128 ? __ušt128_t(-1è: (
Úe
 << shift) - one;

741 
ušt8_t
 
	gsum
 = 0u;

742 
__ušt128_t
 
	gcouÁ”s
;

743 
memıy
(&
couÁ”s
, &
b
, (
__ušt128_t
));

744 
	gcouÁ”s
 &ğ
mask
;

746 
cÚ¡ex´
 
ušt64_t
 
	gušt64_max
 = ~(
¡©ic_ÿ¡
<uint64_t>(0));

748 
__ušt128_t
 
	gpİcouÁ_mask128
 = 
_pİcouÁ_masks128
[0];

750 
ušt8_t
 
	gi
 = 0; i < 
	g_fuÎÃss_couÁ”_width
; i++){

752 cÚ¡ 
ušt64_t
 
	gpİcouÁ_mask1
 = 
pİcouÁ_mask128
 & 
ušt64_max
;

753 cÚ¡ 
ušt64_t
 
	gpİcouÁ_mask2
 = 
pİcouÁ_mask128
 >> 64;

754 
	gsum
 +ğ
__butš_pİcouÁÎ
(
couÁ”s
 & 
pİcouÁ_mask1
è<< 
i
;

755 
	gsum
 +ğ
__butš_pİcouÁÎ
((
couÁ”s
 >> 64è& 
pİcouÁ_mask2
è<< 
i
;

756 
	gpİcouÁ_mask128
 <<= 1;

759  
	gsum
;

765 
INLINE
 
ušt16_t
 
exşusive_»duû_w™h_pİcouÁ64
(cÚ¡ 
block_t
& 
b
,

766 
ušt8_t
 
couÁ”_šdex
) const{

767 
cÚ¡ex´
 
©om_t
 
	gÚe
 = 1;

771 cÚ¡ 
©om_t
 
	gmask
 = (
Úe
 << (
_fuÎÃss_couÁ”_width
 * 
couÁ”_šdex
)) - one;

772 
ušt8_t
 
	gsum
 = 0u;

776 
©om_t
 
	gcouÁ”s
 = 
b
[0] >> 
_fuÎÃss_couÁ”s_off£t
;

779 
	gcouÁ”s
 &ğ
mask
;

780 
©om_t
 
	gpİcouÁ_mask
 = 
_pİcouÁ_masks
[0];

782 
ušt8_t
 
	gi
 = 0; i < 
	g_fuÎÃss_couÁ”_width
; i++){

783 
	gsum
 +ğ
__butš_pİcouÁÎ
(
couÁ”s
 & 
pİcouÁ_mask
è<< 
i
;

784 
	gpİcouÁ_mask
 <<= 1;

787  
	gsum
;

792 
couÁ”_t
 
»duû_up_to_šdex
(cÚ¡ 
block_t
& 
b
, 
ušt8_t
 
couÁ”_šdex
) const{

793 
ušt8_t
 
	gšdex
 = 0;

794 
ušt8_t
 
	gi
 = 0; i < 
	gcouÁ”_šdex
; i++){

795 
	gšdex
 +ğ
b
.
»ad_üoss
(
_fuÎÃss_couÁ”s_off£t
, 
_fuÎÃss_couÁ”_width
,

796 
i
);

798  
	gšdex
;

801 
INLINE
 
deüem’t_fuÎÃss_couÁ”
(
block_t
& 
b
, 
ušt32_t
 
šdex
,

802 
©om_t
 
couÁ”
){

803 
£t_fuÎÃss_couÁ”
(
b
, 
šdex
, 
couÁ”
 - 1);

807 
INLINE
 
£t_fuÎÃss_couÁ”
(
block_t
& 
b
, 
ušt32_t
 
šdex
,

808 
©om_t
 
couÁ”
){

809 
	g_»ad_couÁ”s_m‘hod
){

810 
	gCouÁ”R—dM‘hodEnum
::
READ_RAW128
:

811 
b
.
‹m¶©e
 
add_t
<
__ušt128_t
>(
_fuÎÃss_couÁ”s_off£t
,

812 
	g_fuÎÃss_couÁ”_width
, 
	gšdex
, 
	gcouÁ”
);

815 
	gCouÁ”R—dM‘hodEnum
::
READ_RAW
:

816 
b
.
add
(
_fuÎÃss_couÁ”s_off£t
, 
_fuÎÃss_couÁ”_width
, 
šdex
,

817 
couÁ”
);

819 
	gCouÁ”R—dM‘hodEnum
::
READ_SIMPLE
:

820 
b
.
add
(
_fuÎÃss_couÁ”s_off£t
, 
_fuÎÃss_couÁ”_width
, 
šdex
,

821 
couÁ”
);

823 
	gCouÁ”R—dM‘hodEnum
::
READ_CROSS
:

824 
b
.
add_üoss
(
_fuÎÃss_couÁ”s_off£t
, 
_fuÎÃss_couÁ”_width
, 
šdex
,

825 
couÁ”
);

833 
INLINE
 
šüem’t_fuÎÃss_couÁ”
(
block_t
& 
b
, 
ušt32_t
 
šdex
){

834 
ušt32_t
 
	g»ad
;

835 if(
	g_DEBUG
){

836 
	g»ad
 = 
b
.
»ad_üoss
(
_fuÎÃss_couÁ”s_off£t
, 
_fuÎÃss_couÁ”_width
,

837 
šdex
);

839 
	g_»ad_couÁ”s_m‘hod
){

840 
	gCouÁ”R—dM‘hodEnum
::
READ_CROSS
:

841 
b
.
šc_üoss
(
_fuÎÃss_couÁ”s_off£t
, 
_fuÎÃss_couÁ”_width
, 
šdex
);

844 
b
.
šc
(
_fuÎÃss_couÁ”s_off£t
, 
_fuÎÃss_couÁ”_width
, 
šdex
);

847 if(
	g_DEBUG
){

848 
ušt32_t
 
	g»ad_aá”_šc
 = 
b
.
»ad_üoss
(
_fuÎÃss_couÁ”s_off£t
, 
_fuÎÃss_couÁ”_width
, 
šdex
);

849 if(
	g»ad
 + 1 !ğ
»ad_aá”_šc
){

850 
¡d
::
cout
 << std::
æush
;

851 
	g¡d
::
û¼
 << "Index: " << 
šdex
 << ". I started with‡ count of "

852 << 
»ad
 <<

853 "‡ndƒnded w™h‡ couÁ oà" << 
»ad_aá”_šc
 << 
¡d
::
’dl
;

854 
	g¡d
::
û¼
 << 
b
 << 
¡d
::
’dl
;

859 
šlše
 
hash_t
 
¿w_´im¬y_hash
(
keys_t
 
key
) const{

860  
_hash”
(
key
);

863 
šlše
 
boŞ
 
š£¹_mªy
(cÚ¡ 
¡d
::
veùÜ
<
keys_t
>& 
keys
,

864 
¡d
::
veùÜ
<
boŞ
>& 
¡©us
, cÚ¡ 
ušt64_t
 
num_keys
){

865 
hash_t
 
	gi
 = 0; i < 
	gnum_keys
; i +ğ
b©ch_size
){

866 
¬_hash
 
buck‘_hashes
;

867 
¬_©om
 
	gfšg”´šts
;

868 
hash_t
 
	gj
 = 0; j < 
	gb©ch_size
; j++){

869 
	gbuck‘_hashes
[
j
] = 
¿w_´im¬y_hash
(
keys
[
i
 + j]);

871 
hash_t
 
	gj
 = 0; j < 
	gb©ch_size
; j++){

873 
	gfšg”´šts
[
j
] = 
fšg”´št_funùiÚ
(
buck‘_hashes
[j]);

874 
	gbuck‘_hashes
[
j
] = 
m­_to_buck‘
(
buck‘_hashes
[j], 
_tÙ®_buck‘s
);

876 
	g_š£¹iÚ_m‘hod
){

877 
	gIn£¹iÚM‘hodEnum
::
TWO_CHOICE
:

878 
bË_¡Üe_mªy_two_choiû
(
buck‘_hashes
, 
fšg”´šts
, 
¡©us
, 
i
);

880 
	gIn£¹iÚM‘hodEnum
::
FIRST_FIT
:

881 
bË_¡Üe_mªy
(
buck‘_hashes
, 
fšg”´šts
, 
¡©us
, 
i
);

884 
	gIn£¹iÚM‘hodEnum
::
HYBRID_PIECEWISE
:

885 
In£¹iÚM‘hodEnum
::
FIRST_FIT_OPT
:{

886 
cutoff_äaùiÚ
 = 0.7;

887 
hash_t
 
	gcutoff_pošt
 = 
cutoff_äaùiÚ
 * 
_tÙ®_blocks
 *

888 
_max_fšg”´šts_³r_block
;

889 if(
	gi
 < 
	gcutoff_pošt
){

890 
bË_¡Üe_mªy
(
buck‘_hashes
, 
fšg”´šts
, 
¡©us
, 
i
);

893 
bË_¡Üe_mªy_two_choiû
(
buck‘_hashes
, 
fšg”´šts
, 
¡©us
, 
i
);

897 
	gIn£¹iÚM‘hodEnum
::
HYBRID_SIMPLE
:{

899 
cÚ¡ex´
 
hash_t
 
cutoff_divisÜ
 = 3;

900 if((
	gi
 % (
cutoff_divisÜ
 * 
	gb©ch_size
)) != 0){

901 
bË_¡Üe_mªy
(
buck‘_hashes
, 
fšg”´šts
, 
¡©us
, 
i
);

904 
bË_¡Üe_mªy_two_choiû
(
buck‘_hashes
, 
fšg”´šts
, 
¡©us
, 
i
);

909 
¡d
::
û¼
 << "SOMETHING IS WRONG IF YOU ARE HERE\n";

910 
ex™
(1);

914  
	gŒue
;

918 
šlše
 
boŞ
 
š£¹
(cÚ¡ 
keys_t
 
key
){

919 
hash_t
 
	g¿w_hash
 = 
¿w_´im¬y_hash
(
key
);

921 
©om_t
 
	gfšg”´št
 = 
fšg”´št_funùiÚ
(
¿w_hash
);

923 
hash_t
 
	g´im¬y_buck‘
 = 
m­_to_buck‘
(
¿w_hash
, 
_tÙ®_buck‘s
);

925 if(
	g_DEBUG
){

926 
	g¡d
::
cout
 << "Inserting key: "

927 << 
key
 << " "

928 << "Fšg”´št: " << 
fšg”´št
 << " Bucket index: "

929 << 
´im¬y_buck‘
 << 
¡d
::
’dl
;

930 
fæush
(
¡dout
);

933 
ušt8_t
* 
	gcouÁ”s
;

934 if(
	g_DEBUG
){

935 
	g¡d
::
cout
 << "IN DEBUG" << 
¡d
::
’dl
;

936 
	gcouÁ”s
 = 
Ãw
 
ušt8_t
[
_tÙ®_buck‘s
];

937 
ušt64_t
 
	gi
 = 0; i < 
	g_tÙ®_buck‘s
; i++){

938 
	gcouÁ”s
[
i
] = 
»ad_couÁ”
(˜/ 
_buck‘s_³r_block
,

939 
i
 % 
_buck‘s_³r_block
);

942 
boŞ
 
	g»t
 = 
bË_¡Üe
(
´im¬y_buck‘
, 
fšg”´št
);

943 if(
	g_DEBUG
){

944 
ušt64_t
 
	gi
 = 0; i < 
	g_tÙ®_buck‘s
; i++){

945 
©om_t
 
	gcouÁ”_»ad
 = 
»ad_couÁ”
(
i
 / 
_buck‘s_³r_block
, i % _buckets_per_block);

946 if(
	gcouÁ”s
[
i
] !ğ
couÁ”_»ad
 && i !ğ
´im¬y_buck‘
){

947 
¡d
::
û¼
 << "bË_¡Üi cÜru±šg couÁ”s.\n" << std::
’dl
;

948 
	g¡d
::
û¼
 << 
¡d
::
æush
;

949 
ex™
(1);

951 if(
	gi
 =ğ
´im¬y_buck‘
 && 
couÁ”s
[
i
] + 1u !ğ
couÁ”_»ad
){

952 
¡d
::
û¼
 << "table_store is‚ot…roperly incrementing counters.\n"

953 << 
¡d
::
’dl
;

954 
	g¡d
::
û¼
 << 
¡d
::
æush
;

955 
ex™
(1);

958 
	gd–‘e
[] 
	gcouÁ”s
;

960  
	g»t
;

963 
šlše
 
lik–y_cÚšs_mªy
(cÚ¡ 
¡d
::
veùÜ
<
keys_t
>& 
keys
,

964 
¡d
::
veùÜ
<
boŞ
>& 
¡©us
, cÚ¡ 
ušt64_t
 
num_keys
) const{

965 
hash_t
 
	gi
 = 0; i < 
	gnum_keys
; i +ğ
b©ch_size
){

966 
¬_hash
 
buck‘_hashes
;

967 
¬_©om
 
	gfšg”´šts
;

968 
hash_t
 
	gj
 = 0; j < 
	gb©ch_size
; j++){

969 
	gbuck‘_hashes
[
j
] = 
¿w_´im¬y_hash
(
keys
[
i
 + j]);

971 
hash_t
 
	gj
 = 0; j < 
	gb©ch_size
; j++){

973 
	gfšg”´šts
[
j
] = 
fšg”´št_funùiÚ
(
buck‘_hashes
[j]);

974 
	gbuck‘_hashes
[
j
] = 
m­_to_buck‘
(
buck‘_hashes
[j],

975 
_tÙ®_buck‘s
);

978 
bË_»ad_ªd_com·»_mªy
(
buck‘_hashes
, 
fšg”´šts
, 
¡©us
, 
i
);

982 
šlše
 
boŞ
 
bË_d–‘e_™em
(
hash_t
 
buck‘_id
, 
©om_t
 
fšg”´št
){

983 
ušt64_t
 
	gblock_id
 = 
buck‘_id
 / 
_buck‘s_³r_block
;

984 
ušt16_t
 
	gcouÁ”_šdex
 = (
buck‘_id
 % 
_buck‘s_³r_block
);

987 
couÁ”_t
 
	gfuÎ_¦Ùs
 = 
»ad_couÁ”
(
block_id
, 
couÁ”_šdex
);

990 if(
	gfuÎ_¦Ùs
 == 0){

991  
çl£
;

994 
couÁ”_t
 
	gbuck‘_¡¬t_šdex
 = 
g‘_buck‘_¡¬t_šdex
(
block_id
,

995 
couÁ”_šdex
);

997 
boŞ
 
	gsucûss
 = 
çl£
;

998 
ušt8_t
 
	gj
 = 0;

1000 if(
	gfšg”´št
 =ğ
»ad_fšg”´št
(
block_id
, 
buck‘_¡¬t_šdex
 + 
j
)){

1001 
d–‘e_fšg”´št_right_di¥Ïû
(
_¡Üage
[
block_id
], 
buck‘_¡¬t_šdex


1002 + 
j
);

1003 
deüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
block_id
], 
couÁ”_šdex
,

1004 
fuÎ_¦Ùs
);

1005 
	gsucûss
 = 
Œue
;

1008 } ++
	gj
 !ğ
fuÎ_¦Ùs
);

1011 if(
	g_block_fuÎÃss_¬¿y_’abËd
 && 
	gsucûss
 & (
g‘_buck‘_¡¬t_šdex
(

1012 
block_id
, 
_buck‘s_³r_block
è=ğ
_max_fšg”´šts_³r_block
 - 1)){

1013 
_block_fuÎÃss_¬¿y
[
block_id
] = 0;

1016  
	gsucûss
;

1019 
šlše
 
d–‘e_mªy
(cÚ¡ 
¡d
::
veùÜ
<
keys_t
>& 
keys
,

1020 
¡d
::
veùÜ
<
boŞ
>& 
¡©us
, cÚ¡ 
ušt64_t
 
num_keys
){

1021 
hash_t
 
	gi
 = 0; i < 
	gnum_keys
; i +ğ
b©ch_size
){

1022 
¬_hash
 
buck‘_hashes
;

1023 
¬_©om
 
	gfšg”´šts
;

1024 
hash_t
 
	gj
 = 0; j < 
	gb©ch_size
; j++){

1025 
	gbuck‘_hashes
[
j
] = 
¿w_´im¬y_hash
(
keys
[
i
 + j]);

1026 
	gfšg”´šts
[
j
] = 
fšg”´št_funùiÚ
(
buck‘_hashes
[j]);

1028 
hash_t
 
	gj
 = 0; j < 
	gb©ch_size
; j++){

1030 
	gbuck‘_hashes
[
j
] = 
m­_to_buck‘
(
buck‘_hashes
[j],

1031 
_tÙ®_buck‘s
);

1033 
bË_d–‘e_™em_mªy
(
buck‘_hashes
, 
fšg”´šts
, 
¡©us
, 
i
);

1037 
šlše
 
bË_d–‘e_™em_mªy
(cÚ¡ 
¬_hash
& 
buck‘_ids
, cÚ¡ 
¬_©om
&

1038 
fšg”´šts
, 
¡d
::
veùÜ
<
boŞ
>& 
¡©us
, cÚ¡ 
hash_t
 
wr™e_off£t
){

1039 
¬_hash
 
	gblock_ids
;

1040 
¬_couÁ”
 
	gcouÁ”_šdexes
;

1041 if(
	g_hªdË_cÚæiùs
){

1043 
cÚ¡ex´
 
ušt64_t
 
	gnum_buck‘s
 = 64;

1044 
	gBlockedBF
::
BloomF‹r
<
num_buck‘s
> 
bf
;

1045 
	g¡d
::
b™£t
<
b©ch_size
> 
cÚæiù_veùÜ
;

1046 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1047 
	gblock_ids
[
i
] = 
buck‘_ids
[i] / 
_buck‘s_³r_block
;

1048 
	gcouÁ”_šdexes
[
i
] = 
buck‘_ids
[i] % 
_buck‘s_³r_block
;

1049 
	gcÚæiù_veùÜ
[
i
] = 
cÚæiù_exi¡s
<
num_buck‘s
>(
bf
, 
	gblock_ids
[i]);

1054 if(
	gcÚæiù_veùÜ
.
ªy
()){

1055 
ušt_ç¡64_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1056 
	g¡©us
[
wr™e_off£t
 + 
i
] = 
bË_d–‘e_™em
(
buck‘_ids
[i],

1057 
fšg”´šts
[
i
]);

1058 if(
	g¡©us
[
wr™e_off£t
 + 
i
] =ğ
çl£
){

1059 
hash_t
 
®‹º©e_buck‘_id
 =

1060 
d‘”mše_®‹º©e_buck‘
(
buck‘_ids
[
i
], 
fšg”´šts
[i]);

1061 
	g¡©us
[
wr™e_off£t
 + 
i
] = 
bË_d–‘e_™em
(
®‹º©e_buck‘_id
,

1062 
fšg”´šts
[
i
]);

1069 
ušt_ç¡64_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1070 
	gblock_ids
[
i
] = 
buck‘_ids
[i] / 
_buck‘s_³r_block
;

1071 
	gcouÁ”_šdexes
[
i
] = 
buck‘_ids
[i] % 
_buck‘s_³r_block
;

1075 
¬_couÁ”
 
	gfuÎ_¦Ùs
;

1076 
»ad_couÁ”_mªy
(
block_ids
, 
couÁ”_šdexes
, 
fuÎ_¦Ùs
);

1078 
¬_couÁ”
 
	gi_w™h_£cÚd¬y_lookup
;

1079 
couÁ”_t
 
	g£cÚd¬y_couÁ
 = 0;

1081 
¬_couÁ”
 
	gbuck‘_¡¬t_šdexes
;

1082 
ušt_ç¡64_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1083 
	gbuck‘_¡¬t_šdexes
[
i
] = 
g‘_buck‘_¡¬t_šdex
(
block_ids
[i],

1084 
couÁ”_šdexes
[
i
]);

1085 
ušt8_t
 
	gdiscov”y_¦Ù
 = 
»tuº_¦Ù_id_Ú_m©ch
<>(
block_ids
[
i
],

1086 
	gbuck‘_¡¬t_šdexes
[
i
], 
	gfuÎ_¦Ùs
[i], 
	gfšg”´šts
[i]);

1088 if(
	gdiscov”y_¦Ù
 !ğ
_¦Ùs_³r_buck‘
){

1089 
d–‘e_fšg”´št_right_di¥Ïû
(
_¡Üage
[
block_ids
[
i
]],

1090 
buck‘_¡¬t_šdexes
[
i
] + 
discov”y_¦Ù
);

1091 
deüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
block_ids
[
i
]], 
couÁ”_šdexes
[i],

1092 
fuÎ_¦Ùs
[
i
]);

1093 
	g¡©us
[
wr™e_off£t
 + 
i
] = 
Œue
;

1094 if(
	g_block_fuÎÃss_¬¿y_’abËd
 & (
g‘_buck‘_¡¬t_šdex
(

1095 
block_ids
[
i
], 
_buck‘s_³r_block
è=ğ
_max_fšg”´šts_³r_block
 - 1)){

1096 
_block_fuÎÃss_¬¿y
[
block_ids
[
i
]] = 0;

1100 
	gi_w™h_£cÚd¬y_lookup
[
£cÚd¬y_couÁ
] = 
i
;

1101 
	g£cÚd¬y_couÁ
++;

1107 
ušt_ç¡64_t
 
	gi
 = 0; i < 
	g£cÚd¬y_couÁ
; i++){

1108 
ušt_ç¡64_t
 
	gŒue_i
 = 
i_w™h_£cÚd¬y_lookup
[
i
];

1109 
hash_t
 
	g£cÚd¬y_buck‘_id
 = 
d‘”mše_®‹º©e_buck‘
(

1110 
buck‘_ids
[
Œue_i
], 
fšg”´šts
[true_i]);

1111 
	g¡©us
[
wr™e_off£t
 + 
Œue_i
] =

1112 
bË_d–‘e_™em
(
£cÚd¬y_buck‘_id
, 
fšg”´šts
[
Œue_i
]);

1117 
šlše
 
boŞ
 
d–‘e_™em
(cÚ¡ 
keys_t
 
key
){

1118 
hash_t
 
	g¿w_hash
 = 
¿w_´im¬y_hash
(
key
);

1119 
©om_t
 
	gfšg”´št
 = 
fšg”´št_funùiÚ
(
¿w_hash
);

1121 
hash_t
 
	g´im¬y_buck‘
 = 
m­_to_buck‘
(
¿w_hash
, 
_tÙ®_buck‘s
);

1122 
boŞ
 
	g»tuº_¡©us
 = 
çl£
;

1123 if(!
	g_»m­_’abËd
){

1124 
	g»tuº_¡©us
 = 
bË_d–‘e_™em
(
´im¬y_buck‘
, 
fšg”´št
);

1128 
	g»tuº_¡©us
 = 
bË_d–‘e_™em
(
´im¬y_buck‘
, 
fšg”´št
);

1129 if(!
	g»tuº_¡©us
){

1130 
hash_t
 
	g£cÚd¬y_buck‘
 = 
d‘”mše_®‹º©e_buck‘
(
´im¬y_buck‘
,

1131 
fšg”´št
);

1132 
	g»tuº_¡©us
 = 
bË_d–‘e_™em
(
£cÚd¬y_buck‘
, 
fšg”´št
);

1137  
	g»tuº_¡©us
;

1141 
šlše
 
boŞ
 
lik–y_cÚšs
(cÚ¡ 
keys_t
 
key
){

1142 
hash_t
 
	g¿w_hash
 = 
¿w_´im¬y_hash
(
key
);

1143 
©om_t
 
	gfšg”´št
 = 
fšg”´št_funùiÚ
(
¿w_hash
);

1145 
hash_t
 
	g´im¬y_buck‘
 = 
m­_to_buck‘
(
¿w_hash
, 
_tÙ®_buck‘s
);

1148 if(!
	g_»m­_’abËd
){

1149  
bË_»ad_ªd_com·»
(
´im¬y_buck‘
, 
fšg”´št
);

1154 if(!
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
){

1155 
hash_t
 
	g£cÚd¬y_buck‘
 = 
d‘”mše_®‹º©e_buck‘
(
´im¬y_buck‘
,

1156 
fšg”´št
);

1157  
bË_»ad_ªd_com·»
(
´im¬y_buck‘
, 
fšg”´št
) |

1158 
bË_»ad_ªd_com·»
(
£cÚd¬y_buck‘
, 
fšg”´št
);

1163 
boŞ
 
	g¡©us1
 = 
bË_»ad_ªd_com·»
(
´im¬y_buck‘
, 
fšg”´št
);

1164 
boŞ
 
	g¡©us2
 = 
çl£
;

1165 if(
g‘_ov”æow_¡©us
(
´im¬y_buck‘
, 
fšg”´št
)){

1166 
hash_t
 
	g£cÚd¬y_buck‘
 = 
d‘”mše_®‹º©e_buck‘
(
´im¬y_buck‘
,

1167 
fšg”´št
);

1168 
	g¡©us2
 = 
bË_»ad_ªd_com·»
(
£cÚd¬y_buck‘
, 
fšg”´št
);

1170  
	g¡©us1
 | 
	g¡©us2
;

1174 
šlše
 
couÁ”_t
 
g‘_buck‘_¡¬t_šdex
(
ušt64_t
 
block_id
, 
ušt16_t


1175 
couÁ”_šdex
) const{

1176 
couÁ”_t
 
	gbuck‘_¡¬t_šdex
;

1177 
	g_»duùiÚ_m‘hod
){

1178 (
	gReduùiÚM‘hodEnum
::
POP_CNT
):

1179 
buck‘_¡¬t_šdex
 = 
exşusive_»duû_w™h_pİcouÁ
(
_¡Üage
[
block_id
],

1180 
couÁ”_šdex
);

1183 (
	gReduùiÚM‘hodEnum
::
NAIVE_FULL_EXCLUSIVE_SCAN
):

1184 
buck‘_¡¬t_šdex
 = 
»duû_up_to_šdex
(
_¡Üage
[
block_id
],

1185 
couÁ”_šdex
);

1187 (
	gReduùiÚM‘hodEnum
::
PARALLEL_REDUCE
):

1188 
buck‘_¡¬t_šdex
 = 
exşusive_»duû_w™h_·¿Î–_sum
(

1189 
_¡Üage
[
block_id
], 
couÁ”_šdex
);

1192 
¡d
::
û¼
 << "ERROR: Undefined setting for _reduction_method\n";

1193 
ex™
(1);

1196  
	gbuck‘_¡¬t_šdex
;

1201 
cÚ¡ex´
 
»pÜt_com´essiÚ_¿tio
() const{

1202  
	g¡©ic_ÿ¡
<>(
	g_max_fšg”´šts_³r_block
è/ (
_buck‘s_³r_block
 * 
	g_¦Ùs_³r_buck‘
);

1206 
šlše
 
»pÜt_block_occu·ncy
() const{

1207 
ušt64_t
 
	gfuÎ_¦Ùs_couÁ
 = 0;

1208 
ušt64_t
 
	gblock_id
 = 0; block_id < 
	g_tÙ®_blocks
; block_id++){

1209 
	gfuÎ_¦Ùs_couÁ
 +ğ
g‘_buck‘_¡¬t_šdex
(
block_id
, 
_buck‘s_³r_block
);

1211  
	g¡©ic_ÿ¡
<>(
	gfuÎ_¦Ùs_couÁ
è/ (
_max_fšg”´šts_³r_block
 * 
	g_tÙ®_blocks
);

1217 
»pÜt_Ùa_occu·ncy
() const{

1218 
ušt64_t
 
	g£t_b™_couÁ
 = 0;

1219 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
){

1220 
ušt64_t
 
	gi
 = 0; i < 
	g_tÙ®_blocks
; i++){

1221 
ušt64_t
 
	gb™_šdex
 = 0; b™_šdex < 
	g_Ùa_Ën_b™s
; bit_index++){

1222 
	g£t_b™_couÁ
 +ğ
_¡Üage
[
i
].
»ad_b™
(
_ov”æow_Œackšg_¬¿y_off£t


1223 + 
b™_šdex
);

1227  
	g¡©ic_ÿ¡
<>(
	g£t_b™_couÁ
è/ (
_tÙ®_blocks
 * 
	g_Ùa_Ën_b™s
);

1230 
‹¡_fšg”´št_š_buck‘_mªy_mÜtÚ
(cÚ¡ 
¬_hash
& 
buck‘_ids
,

1231 cÚ¡ 
¬_hash
& 
block_ids
,

1232 cÚ¡ 
¬_couÁ”
& 
buck‘_¡¬t_šdexes
, cÚ¡‡r_couÁ”& 
fuÎ_¦Ùs
,

1233 cÚ¡ 
¬_©om
& 
fšg”´šts
, 
¡d
::
veùÜ
<
boŞ
>& 
¡©us
,

1234 cÚ¡ 
hash_t
 
wr™e_off£t
) const{

1235 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1236 
boŞ
 
	gfound_fšg”
 = 
‹¡_fšg”´št_š_buck‘
<>(
block_ids
[
i
],

1237 
	gbuck‘_¡¬t_šdexes
[
i
],

1238 
	gfuÎ_¦Ùs
[
i
], 
	gfšg”´šts
[i]);

1240 
ušt_ç¡8_t
 
	g£cÚd¬y_lookup_Ãûs§ry
 = (!
found_fšg”
) &

1241 
g‘_ov”æow_¡©us
(
buck‘_ids
[
i
], 
fšg”´šts
[i]);

1242 if(
	g£cÚd¬y_lookup_Ãûs§ry
){

1243 
hash_t
 
	g£cÚd¬y_buck‘_id
 = 
d‘”mše_®‹º©e_buck‘
(

1244 
buck‘_ids
[
i
],

1245 
fšg”´šts
[
i
]);

1246 
hash_t
 
	gblock_id
 = 
£cÚd¬y_buck‘_id
 / 
_buck‘s_³r_block
;

1247 
ušt16_t
 
	gcouÁ”_šdex
 = 
£cÚd¬y_buck‘_id
 % 
_buck‘s_³r_block
;

1248 
ušt16_t
 
	gbuck‘_¡¬t_šdex
 = 
g‘_buck‘_¡¬t_šdex
(
block_id
,

1249 
couÁ”_šdex
);

1250 
couÁ”_t
 
	g£cÚd¬y_fuÎ_¦Ùs
 = 
»ad_couÁ”
(
block_id
, 
couÁ”_šdex
);

1252 
	gfound_fšg”
 = 
‹¡_fšg”´št_š_buck‘
<>(

1253 
block_id
,

1254 
	gbuck‘_¡¬t_šdex
,

1255 
	g£cÚd¬y_fuÎ_¦Ùs
, 
	gfšg”´šts
[
i
]);

1257 
	g¡©us
[
wr™e_off£t
 + 
i
] = 
found_fšg”
;

1261 
šlše
 
‹¡_fšg”´št_š_buck‘_mªy
(cÚ¡ 
¬_hash
& 
block_ids
,

1262 cÚ¡ 
¬_couÁ”
& 
buck‘_¡¬t_šdexes
, cÚ¡‡r_couÁ”& 
fuÎ_¦Ùs
,

1263 cÚ¡ 
¬_©om
& 
fšg”´šts
, 
¡d
::
veùÜ
<
boŞ
>& 
¡©us
,

1264 cÚ¡ 
hash_t
 
wr™e_off£t
) const{

1265 if(
	g_DEBUG
){

1266 
	gut
::
´št_¬¿y
<
¬_hash
>("block_ids: ", 
	gblock_ids
);

1267 
	gut
::
´št_¬¿y
<
¬_couÁ”
>("bucket_start_indexes: ",

1268 
	gbuck‘_¡¬t_šdexes
);

1269 
	gut
::
´št_¬¿y
<
¬_couÁ”
>("fuÎ_¦Ùs: ", 
	gfuÎ_¦Ùs
);

1270 
	gut
::
´št_¬¿y
<
¬_©om
>("fšg”´šts: ", 
	gfšg”´šts
);

1271 
	g¡d
::
cout
 << "Wr™Off£t: " << 
wr™e_off£t
 << 
¡d
::
’dl
;

1273 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1274 
	g¡©us
[
wr™e_off£t
 + 
i
] = 
‹¡_fšg”´št_š_buck‘
<>(
block_ids
[i],

1275 
	gbuck‘_¡¬t_šdexes
[
i
], 
	gfuÎ_¦Ùs
[i], 
	gfšg”´šts
[i]);

1279 
	g‹m¶©e
<
Fšg”´štCom·risÚM‘hodEnum
 
	gt_com·risÚ_m‘hod
 =

1280 
_fšg”´št_com·risÚ_m‘hod
>

1281 
INLINE
 
boŞ
 
‹¡_fšg”´št_š_buck‘
(
hash_t
 
block_id
,

1282 
couÁ”_t
 
buck‘_¡¬t_šdex
, 
ušt8_t
 
fuÎ_¦Ùs
,

1283 
©om_t
 
fšg”´št
) const{

1284  
	g»tuº_¦Ù_id_Ú_m©ch
<
	gt_com·risÚ_m‘hod
>(
	gblock_id
,

1285 
	gbuck‘_¡¬t_šdex
, 
	gfuÎ_¦Ùs
, 
	gfšg”´št
è!ğ
_¦Ùs_³r_buck‘
;

1290 
	g‹m¶©e
<
Fšg”´štCom·risÚM‘hodEnum
 
	gt_com·risÚ_m‘hod
 =

1291 
_fšg”´št_com·risÚ_m‘hod
>

1292 
INLINE
 
hash_t
 
»tuº_¦Ù_id_Ú_m©ch
(hash_ˆ
block_id
,

1293 
couÁ”_t
 
buck‘_¡¬t_šdex
, 
ušt8_t
 
fuÎ_¦Ùs
, 
©om_t
 
fšg”´št
) const{

1295 
hash_t
 
	gm©ch_šdex
 = 
_¦Ùs_³r_buck‘
;

1305 ià(
	gt_com·risÚ_m‘hod
 =ğ
Fšg”´štCom·risÚM‘hodEnum
::
VARIABLE_COUNT
) {

1308 
ušt8_t
 
i
 = 0; 
	gi
 < 
	gfuÎ_¦Ùs
; i++){

1309 if(
	gfšg”´št
 =ğ
»ad_fšg”´št
(
block_id
, 
buck‘_¡¬t_šdex
 + 
i
)){

1310 
	gm©ch_šdex
 = 
i
;

1316 ià(
	gt_com·risÚ_m‘hod
 =ğ
Fšg”´štCom·risÚM‘hodEnum
::
FIXED_COUNT_AGGRESSIVE
) {

1321 
ušt8_t
 
i
 = 0; (
	gi
 < 
	g_¦Ùs_³r_buck‘
); i++){

1322 
boŞ
 
	gv®id_»ad
 = (
i
 < 
fuÎ_¦Ùs
è& (
buck‘_¡¬t_šdex
 + i < 
_max_fšg”´šts_³r_block
);

1323 
boŞ
 
	gfound
 = (
fšg”´št
 =ğ
»ad_fšg”´št
(
block_id
,

1324 
buck‘_¡¬t_šdex
 + 
i
)è& 
	gv®id_»ad
;

1325 if(
	gfound
){

1326 
	gm©ch_šdex
 = 
i
;

1333 ià(
	gt_com·risÚ_m‘hod
 =ğ
Fšg”´štCom·risÚM‘hodEnum
::
SEMI_FIXED
) {

1334 
ušt8_t
 
i
 = 0; (
	gi
 < 
	g_¦Ùs_³r_buck‘
) &

1335 (
	gbuck‘_¡¬t_šdex
 + 
	gi
 < 
	g_max_fšg”´šts_³r_block
); i++){

1336 
boŞ
 
	gv®id_»ad
 = 
i
 < 
fuÎ_¦Ùs
;

1337 
boŞ
 
	gfound
 = (
fšg”´št
 =ğ
»ad_fšg”´št
(
block_id
,

1338 
buck‘_¡¬t_šdex
 + 
i
)è& 
	gv®id_»ad
;

1339 if(
	gfound
){

1340 
	gm©ch_šdex
 = 
i
;

1344  
	gm©ch_šdex
;

1347 
šlše
 
bË_»ad_ªd_com·»_mªy_³ssimi¡ic
(cÚ¡ 
¬_hash
& 
buck‘_ids
,

1348 cÚ¡ 
¬_©om
& 
fšg”´šts
, 
¡d
::
veùÜ
<
boŞ
>& 
¡©us
,

1349 cÚ¡ 
hash_t
 
wr™e_off£t
) const{

1350 
¬_hash
 
	gblock_ids
[2];

1351 
¬_hash
 
	g®‹º©e_buck‘_ids
;

1352 
¬_couÁ”
 
	gcouÁ”_šdexes
[2];

1353 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1354 
	g®‹º©e_buck‘_ids
[
i
] = 
d‘”mše_®‹º©e_buck‘
(
buck‘_ids
[i],

1355 
fšg”´šts
[
i
]);

1356 
	gblock_ids
[0][
i
] = 
buck‘_ids
[i] / 
_buck‘s_³r_block
;

1357 
	gblock_ids
[1][
i
] = 
®‹º©e_buck‘_ids
[i] / 
_buck‘s_³r_block
;

1358 
	gcouÁ”_šdexes
[0][
i
] = 
buck‘_ids
[i] % 
_buck‘s_³r_block
;

1359 
	gcouÁ”_šdexes
[1][
i
] = 
®‹º©e_buck‘_ids
[i] % 
_buck‘s_³r_block
;

1361 
¬_couÁ”
 
	gfuÎ_¦Ùs
[2];

1362 
»ad_couÁ”_mªy
(
block_ids
[0], 
couÁ”_šdexes
[0], 
fuÎ_¦Ùs
[0]);

1363 
»ad_couÁ”_mªy
(
block_ids
[1], 
couÁ”_šdexes
[1], 
fuÎ_¦Ùs
[1]);

1365 
¬_couÁ”
 
	gbuck‘_¡¬t_šdexes
[2];

1366 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1367 
	gbuck‘_¡¬t_šdexes
[0][
i
] = 
g‘_buck‘_¡¬t_šdex
(
block_ids
[0][i],

1368 
couÁ”_šdexes
[0][
i
]);

1369 
	gbuck‘_¡¬t_šdexes
[1][
i
] = 
g‘_buck‘_¡¬t_šdex
(
block_ids
[1][i],

1370 
couÁ”_šdexes
[1][
i
]);

1373 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1374 
	g¡d
::
b™£t
<
_¦Ùs_³r_buck‘
> 
found1
;

1375 
	g¡d
::
b™£t
<
_¦Ùs_³r_buck‘
> 
found2
;

1376 
ušt_ç¡8_t
 
	gj
 = 0; j < 
	gfuÎ_¦Ùs
[0][
i
]; j++){

1377 
	gfound1
[
j
] = (
fšg”´šts
[
i
] =ğ
»ad_fšg”´št
(
block_ids
[0][i],

1378 
buck‘_¡¬t_šdexes
[0][
i
] + 
j
));

1380 
ušt_ç¡8_t
 
	gj
 = 0; j < 
	gfuÎ_¦Ùs
[1][
i
]; j++){

1381 
	gfound2
[
j
] = (
fšg”´šts
[
i
] =ğ
»ad_fšg”´št
(
block_ids
[1][i],

1382 
buck‘_¡¬t_šdexes
[1][
i
] + 
j
));

1384 
	g¡©us
[
wr™e_off£t
 + 
i
] = 
found1
.
ªy
(è| 
found2
.any();

1388 
šlše
 
bË_»ad_ªd_com·»_mªy
(cÚ¡ 
¬_hash
& 
buck‘_ids
,

1389 cÚ¡ 
¬_©om
& 
fšg”´šts
, 
¡d
::
veùÜ
<
boŞ
>& 
¡©us
,

1390 cÚ¡ 
hash_t
 
wr™e_off£t
) const{

1391 
¬_hash
 
	gblock_ids
;

1392 
¬_couÁ”
 
	gcouÁ”_šdexes
;

1393 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1394 
	gblock_ids
[
i
] = 
buck‘_ids
[i] / 
_buck‘s_³r_block
;

1395 
	gcouÁ”_šdexes
[
i
] = 
buck‘_ids
[i] % 
_buck‘s_³r_block
;

1397 
¬_couÁ”
 
	gfuÎ_¦Ùs
;

1398 
»ad_couÁ”_mªy
(
block_ids
, 
couÁ”_šdexes
, 
fuÎ_¦Ùs
);

1400 
¬_couÁ”
 
	gbuck‘_¡¬t_šdexes
;

1401 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1402 
	gbuck‘_¡¬t_šdexes
[
i
] = 
g‘_buck‘_¡¬t_šdex
(
block_ids
[i],

1403 
couÁ”_šdexes
[
i
]);

1407 if(!
	g_»m­_’abËd
){

1408 
‹¡_fšg”´št_š_buck‘_mªy
(
block_ids
, 
buck‘_¡¬t_šdexes
,

1409 
fuÎ_¦Ùs
, 
fšg”´šts
, 
¡©us
, 
wr™e_off£t
);

1413 if(!
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
){

1415 
‹¡_fšg”´št_š_buck‘_mªy
(
block_ids
, 
buck‘_¡¬t_šdexes
,

1416 
fuÎ_¦Ùs
, 
fšg”´šts
, 
¡©us
, 
wr™e_off£t
);

1418 
¬_hash
 
	g£cÚd¬y_buck‘_ids
;

1419 
¬_hash
 
	g£cÚd¬y_block_ids
;

1420 
¬_couÁ”
 
	g£cÚd¬y_couÁ”_šdexes
;

1421 
¬_couÁ”
 
	g£cÚd¬y_buck‘_¡¬t_šdexes
;

1422 
¬_couÁ”
 
	g£cÚd¬y_fuÎ_¦Ùs
;

1424 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1425 
	g£cÚd¬y_buck‘_ids
[
i
] = 
d‘”mše_®‹º©e_buck‘
(
buck‘_ids
[i],

1426 
fšg”´šts
[
i
]);

1427 
	g£cÚd¬y_block_ids
[
i
] = 
£cÚd¬y_buck‘_ids
[i] / 
_buck‘s_³r_block
;

1428 
	g£cÚd¬y_couÁ”_šdexes
[
i
] =

1429 
£cÚd¬y_buck‘_ids
[
i
] % 
_buck‘s_³r_block
;

1430 
	g£cÚd¬y_buck‘_¡¬t_šdexes
[
i
] = 
g‘_buck‘_¡¬t_šdex
(

1431 
£cÚd¬y_block_ids
[
i
], 
£cÚd¬y_couÁ”_šdexes
[i]);

1433 
»ad_couÁ”_mªy
(
£cÚd¬y_block_ids
, 
£cÚd¬y_couÁ”_šdexes
,

1434 
£cÚd¬y_fuÎ_¦Ùs
);

1437 
‹¡_fšg”´št_š_buck‘_mªy
(
£cÚd¬y_block_ids
,

1438 
£cÚd¬y_buck‘_¡¬t_šdexes
,

1439 
£cÚd¬y_fuÎ_¦Ùs
, 
fšg”´šts
, 
¡©us
, 
wr™e_off£t
);

1444 
‹¡_fšg”´št_š_buck‘_mªy_mÜtÚ
(
buck‘_ids
, 
block_ids
,

1445 
buck‘_¡¬t_šdexes
, 
fuÎ_¦Ùs
, 
fšg”´šts
, 
¡©us
, 
wr™e_off£t
);

1453 
šlše
 
boŞ
 
bË_»ad_ªd_com·»
(
ušt64_t
 
buck‘_id
,

1454 
©om_t
 
fšg”´št
) const{

1455 
ušt64_t
 
	gblock_id
 = 
buck‘_id
 / 
_buck‘s_³r_block
;

1456 
ušt16_t
 
	gcouÁ”_šdex
 = (
buck‘_id
 % 
_buck‘s_³r_block
);

1458 
couÁ”_t
 
	gfuÎ_¦Ùs
 = 
»ad_couÁ”
(
block_id
, 
couÁ”_šdex
);

1461 
couÁ”_t
 
	gbuck‘_¡¬t_šdex
 = 
g‘_buck‘_¡¬t_šdex
(
block_id
,

1462 
couÁ”_šdex
);

1464  
	g‹¡_fšg”´št_š_buck‘
<>(
	gblock_id
, 
	gbuck‘_¡¬t_šdex
,

1465 
	gfuÎ_¦Ùs
, 
	gfšg”´št
);

1469 
šlše
 
»ad_couÁ”_mªy
(cÚ¡ 
¬_hash
& 
block_ids
,

1470 cÚ¡ 
¬_couÁ”
& 
couÁ”_šdexes
,‡r_couÁ”& 
fuÎ_¦Ùs
) const{

1471 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1472 
	gfuÎ_¦Ùs
[
i
] = 
»ad_couÁ”
(
block_ids
[i], 
couÁ”_šdexes
[i]);

1477 
INLINE
 
wr™e_fšg”´št
(
block_t
& 
block
, 
ušt64_t
 
f§_¦Ù_id
,

1478 
©om_t
 
fšg”´št
){

1480 
cÚ¡ex´
 
boŞ
 
	gf§_usšg_by‹_muÉËs
 = ((
_fšg”´št_Ën_b™s
 % 8 == 0)

1481 || (
_fšg”´št_Ën_b™s
 =ğ4)è&& (
_fšg”´št_off£t
 % 8 == 0);

1482 if(
	gf§_usšg_by‹_muÉËs
){

1483 
	gblock
.
add
(
_fšg”´št_off£t
, 
_fšg”´št_Ën_b™s
, 
f§_¦Ù_id
,

1484 
fšg”´št
);

1487 
	gblock
.
add_üoss
(
_fšg”´št_off£t
, 
_fšg”´št_Ën_b™s
, 
f§_¦Ù_id
,

1488 
fšg”´št
);

1492 
INLINE
 
wr™e_fšg”´št_Ëá_di¥Ïû
(
block_t
& 
block
,

1493 
ušt64_t
 
f§_¦Ù_id
, 
©om_t
 
fšg”´št
){

1495 
cÚ¡ex´
 
boŞ
 
	gf§_usšg_by‹_muÉËs
 = (
_fšg”´št_Ën_b™s
 % 8 == 0)

1496 && (
_fšg”´št_off£t
 % 8 == 0);

1497 if(
	gf§_usšg_by‹_muÉËs
){

1498 
cÚ¡ex´
 
ušt64_t
 
	gf§_size_by‹s
 = (
_max_fšg”´šts_³r_block
 *

1499 
_fšg”´št_Ën_b™s
) / 8;

1500 
cÚ¡ex´
 
ušt64_t
 
	gfšg”´št_Ën_by‹s
 = 
_fšg”´št_Ën_b™s
 / 8;

1501 
cÚ¡ex´
 
ušt64_t
 
	gfšg”´št_off£t_by‹s
 = 
_fšg”´št_off£t
 / 8;

1502 
	gblock
.
add_Ëá_di¥Ïû
(
fšg”´št_off£t_by‹s
, 
fšg”´št_Ën_by‹s
,

1503 
f§_¦Ù_id
, 
fšg”´št
, 
f§_size_by‹s
);

1506 
	gblock
.
add_üoss_Ëá_di¥Ïû
(
_fšg”´št_off£t
, 
_fšg”´št_Ën_b™s
,

1507 
f§_¦Ù_id
, 
fšg”´št
);

1511 
INLINE
 
d–‘e_fšg”´št_right_di¥Ïû
(
block_t
& 
block
,

1512 
ušt64_t
 
f§_¦Ù_id
){

1514 
cÚ¡ex´
 
boŞ
 
	gf§_usšg_by‹_muÉËs
 = (
_fšg”´št_Ën_b™s
 % 8 == 0)

1515 && (
_fšg”´št_off£t
 % 8 == 0);

1516 if(
	gf§_usšg_by‹_muÉËs
){

1517 
cÚ¡ex´
 
ušt64_t
 
	gf§_size_by‹s
 = (
_max_fšg”´šts_³r_block
 *

1518 
_fšg”´št_Ën_b™s
) / 8;

1519 
cÚ¡ex´
 
ušt64_t
 
	gfšg”´št_Ën_by‹s
 = 
_fšg”´št_Ën_b™s
 / 8;

1520 
cÚ¡ex´
 
ušt64_t
 
	gfšg”´št_off£t_by‹s
 = 
_fšg”´št_off£t
 / 8;

1521 
	gblock
.
d–_right_di¥Ïû
(
fšg”´št_off£t_by‹s
, 
fšg”´št_Ën_by‹s
,

1522 
f§_¦Ù_id
, 
f§_size_by‹s
);

1525 
	gblock
.
d–_üoss_right_di¥Ïû
(
_fšg”´št_off£t
, 
_fšg”´št_Ën_b™s
,

1526 
f§_¦Ù_id
);

1533 
INLINE
 
©om_t
 
»ad_fšg”´št
(
ušt64_t
 
block_id
, ušt64_ˆ
block_¦Ù_id
)

1535 
©om_t
 
	gfšg”´št
 = 0;

1536 
	g_»ad_fšg”´šts_m‘hod
){

1538 
	gFšg”´štR—dM‘hodEnum
::
READ_CROSS
:

1539 
fšg”´št
 = 
_¡Üage
[
block_id
].
»ad_üoss
(
_fšg”´št_off£t
,

1540 
_fšg”´št_Ën_b™s
, 
block_¦Ù_id
);

1542 
	gFšg”´štR—dM‘hodEnum
::
READ_SIMPLE
:

1543 
fšg”´št
 = 
_¡Üage
[
block_id
].
»ad
(
_fšg”´št_off£t
,

1544 
_fšg”´št_Ën_b™s
, 
block_¦Ù_id
);

1546 
	gFšg”´štR—dM‘hodEnum
::
READ_BYTE
:{

1548 
ušt64_t
 
by‹_šdex
 = (
_fšg”´št_off£t
 / 8è+ 
block_¦Ù_id
;

1549 
	gfšg”´št
 = 
_¡Üage
[
block_id
].
»ad_by‹
(
by‹_šdex
);

1553 
¡d
::
û¼
 << "ERROR: UnknowÀfšg”´šˆ»adšg mode" << std::
’dl
;

1554 
ex™
(1);

1557  
	gfšg”´št
;

1562 
INLINE
 
couÁ”_t
 
»ad_couÁ”
(
ušt64_t
 
block_id
, ušt64_ˆ
couÁ”_šdex
)

1564 
couÁ”_t
 
	gcouÁ”
 = 0;

1565 
	g_»ad_couÁ”s_m‘hod
){

1567 
	gCouÁ”R—dM‘hodEnum
::
READ_CROSS
:

1568 
couÁ”
 = 
_¡Üage
[
block_id
].
»ad_üoss
(
_fuÎÃss_couÁ”s_off£t
,

1569 
_fuÎÃss_couÁ”_width
, 
couÁ”_šdex
);

1572 
	gCouÁ”R—dM‘hodEnum
::
READ_SIMPLE
:

1573 
couÁ”
 = 
_¡Üage
[
block_id
].
»ad
(
_fuÎÃss_couÁ”s_off£t
,

1574 
_fuÎÃss_couÁ”_width
, 
couÁ”_šdex
);

1577 
	gCouÁ”R—dM‘hodEnum
::
READ_RAW
:

1578 
couÁ”
 = 
_¡Üage
[
block_id
].
»ad_©om0
(
_fuÎÃss_couÁ”s_off£t
,

1579 
_fuÎÃss_couÁ”_width
, 
couÁ”_šdex
);

1581 
	gCouÁ”R—dM‘hodEnum
::
READ_RAW128
:

1582 
couÁ”
 = 
_¡Üage
[
block_id
].
‹m¶©e
 
»ad_z”Ùh_wÜd
<
__ušt128_t
>(

1583 
_fuÎÃss_couÁ”s_off£t
, 
	g_fuÎÃss_couÁ”_width
,

1584 
	gcouÁ”_šdex
);

1587 
¡d
::
û¼
 << "ERROR: UnknowÀcouÁ”„—dšg mode" << std::
’dl
;

1588 
ex™
(1);

1591  
	gcouÁ”
;

1594 
šlše
 
two_choiû_¡Üe_mªy
(cÚ¡ 
¬_hash
& 
buck‘_ids_1
,

1595 cÚ¡ 
¬_hash
& 
buck‘_ids_2
, cÚ¡ 
¬_©om
& 
fšg”´šts
,

1596 cÚ¡ 
¬_hash
& 
block_ids_1
, cÚ¡‡r_hash& 
block_ids_2
,

1597 
¡d
::
veùÜ
<
boŞ
>& 
¡©u£s
, cÚ¡ 
hash_t
 
off£t
){

1598 
¬_hash
 
	g–em’ts_š_blocks_1
, 
	g–em’ts_š_blocks_2
;

1599 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1600 
	g–em’ts_š_blocks_1
[
i
] = 
exşusive_»duû
(

1601 
_¡Üage
[
block_ids_1
[
i
]], 
_buck‘s_³r_block
);

1602 
	g–em’ts_š_blocks_2
[
i
] = 
exşusive_»duû
(

1603 
_¡Üage
[
block_ids_2
[
i
]], 
_buck‘s_³r_block
);

1605 
	g¡d
::
b™£t
<
b©ch_size
> 
Œy_fœ¡_block_š£¹
;

1606 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1607 
	g_š£¹iÚ_m‘hod
){

1608 
	gIn£¹iÚM‘hodEnum
::
FIRST_FIT_OPT
:

1609 
Œy_fœ¡_block_š£¹
[
i
] = (
–em’ts_š_blocks_1
[i] !=

1610 
_max_fšg”´šts_³r_block
è| (
–em’ts_š_blocks_2
[
i
] ==

1611 
_max_fšg”´šts_³r_block
);

1614 
Œy_fœ¡_block_š£¹
[
i
] = (
–em’ts_š_blocks_1
[i] <=

1615 
–em’ts_š_blocks_2
[
i
]);

1620 
¬_hash
 
	gbuck‘_ids
;

1621 
¬_hash
 
	gblock_ids
;

1622 
¬_couÁ”
 
	gcouÁ”_šdexes
;

1623 
¬_couÁ”
 
	g–em’ts_š_blocks
;

1624 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1625 
	gbuck‘_ids
[
i
] = (
Œy_fœ¡_block_š£¹
[i] ?

1626 
buck‘_ids_1
[
i
] : 
buck‘_ids_2
[i]);

1627 
	gblock_ids
[
i
] = (
Œy_fœ¡_block_š£¹
[i] ?

1628 
block_ids_1
[
i
] : 
block_ids_2
[i]);

1629 
	g–em’ts_š_blocks
[
i
] = (
Œy_fœ¡_block_š£¹
[i] ?

1630 
–em’ts_š_blocks_1
[
i
] : 
–em’ts_š_blocks_2
[i]);

1632 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1633 
	gcouÁ”_šdexes
[
i
] = 
buck‘_ids
[i] % 
_buck‘s_³r_block
;

1636 
¬_couÁ”
 
	gbuck‘_¡¬t_šdexes
 =

1637 
exşusive_»duû_mªy
<
b©ch_size
>(
block_ids
, 
	gcouÁ”_šdexes
);

1639 
¬_couÁ”
 
	gcouÁ”_v®ues
;

1640 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1641 
	gcouÁ”_v®ues
[
i
] = 
»ad_couÁ”
(
block_ids
[i],

1642 
couÁ”_šdexes
[
i
]);

1643 
	g¡©u£s
[
off£t
 + 
i
] = !((
–em’ts_š_blocks
[i] =ğ
_max_fšg”´šts_³r_block
) ||

1644 (
couÁ”_v®ues
[
i
] =ğ
_¦Ùs_³r_buck‘
));

1646 if(
	g¡©u£s
[
off£t
 + 
i
]){

1647 
wr™e_fšg”´št_Ëá_di¥Ïû
(
_¡Üage
[
block_ids
[
i
]],

1648 
buck‘_¡¬t_šdexes
[
i
], 
fšg”´šts
[i]);

1649 
šüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
block_ids
[
i
]],

1650 
couÁ”_šdexes
[
i
]);

1653 if(
	g_block_fuÎÃss_¬¿y_’abËd
 && (
	g–em’ts_š_blocks
[
i
] ==

1654 
_max_fšg”´šts_³r_block
 - 1)){

1655 
_block_fuÎÃss_¬¿y
[
block_ids
[
i
]] = 1;

1659 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1660 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
 && (
	g¡©u£s
[
off£t
 + 
i
]) &&

1661 (!
	gŒy_fœ¡_block_š£¹
[
i
])){

1662 
£t_ov”æow_¡©us
(
buck‘_ids_1
[
i
], 
fšg”´šts
[i],

1663 
block_ids_1
[
i
], 
couÁ”_šdexes
[i]);

1667 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1668 if(!
	g¡©u£s
[
off£t
 + 
i
]){

1669 
	g¡©u£s
[
off£t
 + 
i
] = 
¿ndom_kickout_cuckoo
(
buck‘_ids_1
[i],

1670 
fšg”´šts
[
i
]);

1675 
šlše
 
couÁ”_t
 
»pÜt_f§_lßd
(
hash_t
 
block_id
){

1681 if(
	g_¥ecŸl_nuÎ_fšg”´št
){

1682 
boŞ
 
	gis_nÚz”o_fšg”´št
 = 
»ad_fšg”´št
(
block_id
,

1683 
_max_fšg”´šts_³r_block
 - 1);

1684  
	gis_nÚz”o_fšg”´št
 ?

1685 
	g_max_fšg”´šts_³r_block
 : 
_max_fšg”´šts_³r_block
 - 1;

1688  
exşusive_»duû
(
_¡Üage
[
block_id
], 
_buck‘s_³r_block
);

1692 
šlše
 
fœ¡_Ëv–_¡Üe_mªy
(cÚ¡ 
¬_hash
& 
buck‘_ids
,

1693 cÚ¡ 
¬_©om
& 
fšg”´šts
, cÚ¡ 
¬_hash
& 
block_ids
,

1694 
¬_couÁ”
& 
couÁ”_šdexes
,

1695 
¬_couÁ”
& 
buck‘_¡¬t_šdexes
,‡r_couÁ”& 
–em’ts_š_blocks
,

1696 
¬_couÁ”
& 
couÁ”_v®ues
, 
¡d
::
veùÜ
<
boŞ
>& 
¡©u£s
, cÚ¡ 
hash_t
 
off£t
){

1698 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1699 
	gcouÁ”_šdexes
[
i
] = 
buck‘_ids
[i] % 
_buck‘s_³r_block
;

1702 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1703 
	g–em’ts_š_blocks
[
i
] = 
»pÜt_f§_lßd
(
block_ids
[i]);

1705 
	gbuck‘_¡¬t_šdexes
 =

1706 
exşusive_»duû_mªy
<
b©ch_size
>(
block_ids
, 
	gcouÁ”_šdexes
);

1708 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1709 
	gcouÁ”_v®ues
[
i
] = 
»ad_couÁ”
(
block_ids
[i], 
couÁ”_šdexes
[i]);

1710 
	g¡©u£s
[
off£t
 + 
i
] = !((
–em’ts_š_blocks
[i] ==

1711 
_max_fšg”´šts_³r_block
è| (
couÁ”_v®ues
[
i
] =ğ
_¦Ùs_³r_buck‘
));

1713 if(
	g¡©u£s
[
off£t
 + 
i
]){

1714 
wr™e_fšg”´št_Ëá_di¥Ïû
(
_¡Üage
[
block_ids
[
i
]],

1715 
buck‘_¡¬t_šdexes
[
i
], 
fšg”´šts
[i]);

1716 
šüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
block_ids
[
i
]],

1717 
couÁ”_šdexes
[
i
]);

1720 if(
	g_block_fuÎÃss_¬¿y_’abËd
 && (
	g–em’ts_š_blocks
[
i
] ==

1721 
_max_fšg”´šts_³r_block
 - 1)){

1722 
_block_fuÎÃss_¬¿y
[
block_ids
[
i
]] = 1;

1727 
	g‹m¶©e
<
ušt64_t
 
	gnum_buck‘s
>

1728 
INLINE
 
boŞ
 
cÚæiù_exi¡s
(
BlockedBF
::
BloomF‹r
<
num_buck‘s
>& 
bf
,

1729 cÚ¡ 
hash_t
 
block_id
){

1730  
	gbf
.
cÚšs_ªd_upd©e
(
block_id
);

1733 
šlše
 
bË_¡Üe_mªy_two_choiû
(cÚ¡ 
¬_hash
& 
buck‘_ids_1
,

1734 cÚ¡ 
¬_©om
& 
fšg”´šts
, 
¡d
::
veùÜ
<
boŞ
>& 
¡©u£s
,

1735 cÚ¡ 
hash_t
 
off£t
){

1739 
¬_¡Üe_·¿ms
 
	gc1
;

1740 
¬_¡Üe_·¿ms
 
	gc2
;

1743 
¬_hash
 
	gbuck‘_ids_2
;

1744 
¬_hash
 
	gblock_ids_1
;

1745 
¬_hash
 
	gblock_ids_2
;

1747 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1748 
	gbuck‘_ids_2
[
i
] = 
d‘”mše_®‹º©e_buck‘
(
buck‘_ids_1
[i],

1749 
fšg”´šts
[
i
]);

1753 
cÚ¡ex´
 
ušt64_t
 
	gnum_buck‘s
 = 128;

1754 
	gBlockedBF
::
BloomF‹r
<
num_buck‘s
> 
bf
;

1755 
	g¡d
::
b™£t
<2 * 
b©ch_size
> 
cÚæiù_veùÜ
;

1756 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1757 
	gblock_ids_1
[
i
] = 
buck‘_ids_1
[i] / 
_buck‘s_³r_block
;

1758 
	gblock_ids_2
[
i
] = 
buck‘_ids_2
[i] / 
_buck‘s_³r_block
;

1759 
	gcÚæiù_veùÜ
[
i
 << 1] = 
cÚæiù_exi¡s
<
num_buck‘s
>(
bf
, 
	gblock_ids_1
[i]);

1760 
	gcÚæiù_veùÜ
[(
i
 << 1è+ 1] = 
cÚæiù_exi¡s
<
num_buck‘s
>(
bf
, 
	gblock_ids_2
[i]);

1763 if(
	g_hªdË_cÚæiùs
 && 
	gcÚæiù_veùÜ
.
ªy
()){

1765 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1766 
	g¡©u£s
[
off£t
 + 
i
] = 
fœ¡_Ëv–_¡Üe
(
buck‘_ids_1
[i],

1767 
fšg”´šts
[
i
], 
c1
[i]);

1768 if(!
	g¡©u£s
[
off£t
 + 
i
]){

1769 
	g¡©u£s
[
off£t
 + 
i
] = 
fœ¡_Ëv–_¡Üe
(
buck‘_ids_2
[i],

1770 
fšg”´šts
[
i
], 
c2
[i]);

1771 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
 && 
	g¡©u£s
[
off£t
 + 
i
]){

1772 
£t_ov”æow_¡©us
(
buck‘_ids_1
[
i
], 
fšg”´šts
[i],

1773 
c1
[
i
].
block_id
, c1[i].
couÁ”_šdex
);

1779  
two_choiû_¡Üe_mªy
(
buck‘_ids_1
, 
buck‘_ids_2
, 
fšg”´šts
,

1780 
block_ids_1
, 
block_ids_2
, 
¡©u£s
, 
off£t
);

1783 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1784 
boŞ
 
	g¡©us1
 = 
¡©u£s
[
off£t
 + 
i
];

1785 
In£¹Stus
 
	g¡©us2
 = In£¹Stus::
FAILED_TO_INSERT
;

1787 if(
	g_cŞlisiÚ_»sŞutiÚ_’abËd
 && !
	g¡©us1
){

1788 
	g¡©us2
 = 
»sŞve_cŞlisiÚ
(
buck‘_ids_1
[
i
], 
buck‘_ids_2
[i],

1789 
fšg”´šts
[
i
], 
c1
[i], 
c2
[i]);

1792 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
 &

1793 (
	g¡©us2
 =ğ
In£¹Stus
::
PLACED_IN_SECONDARY_BUCKET
)){

1794 
£t_ov”æow_¡©us
(
buck‘_ids_1
[
i
], 
fšg”´šts
[i], 
block_ids_1
[i],

1795 
c1
[
i
].
couÁ”_šdex
);

1798 
	g¡©u£s
[
off£t
 + 
i
] = 
¡©us1
 |

1799 (
¡©us2
 !ğ
In£¹Stus
::
FAILED_TO_INSERT
);

1801 ifĞ!
	g¡©u£s
[
off£t
 + 
i
]){

1808 
šlše
 
bË_¡Üe_mªy
(cÚ¡ 
¬_hash
& 
buck‘_ids
,

1809 cÚ¡ 
¬_©om
& 
fšg”´šts
, 
¡d
::
veùÜ
<
boŞ
>& 
¡©u£s
,

1810 cÚ¡ 
hash_t
 
off£t
){

1812 
¬_¡Üe_·¿ms
 
	gc1
;

1813 
¬_¡Üe_·¿ms
 
	gc2
;

1816 
¬_hash
 
	gblock_ids
;

1817 
¬_couÁ”
 
	gcouÁ”_šdexes
;

1818 
¬_couÁ”
 
	gbuck‘_¡¬t_šdexes
;

1819 
¬_couÁ”
 
	g–em’ts_š_blocks
;

1820 
¬_couÁ”
 
	gcouÁ”_v®ues
;

1823 
cÚ¡ex´
 
ušt64_t
 
	gnum_buck‘s
 = 64;

1824 
	gBlockedBF
::
BloomF‹r
<
num_buck‘s
> 
bf
;

1825 
	g¡d
::
b™£t
<
b©ch_size
> 
cÚæiù_veùÜ
;

1826 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1827 
	gblock_ids
[
i
] = 
buck‘_ids
[i] / 
_buck‘s_³r_block
;

1828 
	gcÚæiù_veùÜ
[
i
] = 
cÚæiù_exi¡s
<
num_buck‘s
>(
bf
, 
	gblock_ids
[i]);

1831 if(
__butš_ex³ù
(
_hªdË_cÚæiùs
 && 
cÚæiù_veùÜ
.
ªy
(), 0)){

1833 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1834 
	g¡©u£s
[
off£t
 + 
i
] = 
fœ¡_Ëv–_¡Üe
(
buck‘_ids
[i],

1835 
fšg”´šts
[
i
], 
c1
[i]);

1839 
fœ¡_Ëv–_¡Üe_mªy
(
buck‘_ids
, 
fšg”´šts
, 
block_ids
,

1840 
couÁ”_šdexes
, 
buck‘_¡¬t_šdexes
, 
–em’ts_š_blocks
,

1841 
couÁ”_v®ues
, 
¡©u£s
, 
off£t
);

1842 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1843 
	gc1
[
i
].
	gblock_id
 = 
block_ids
[i];

1844 
	gc1
[
i
].
	gcouÁ”_šdex
 = 
couÁ”_šdexes
[i];

1847 
ušt_ç¡32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

1848 
boŞ
 
	g¡©us1
 = 
¡©u£s
[
off£t
 + 
i
];

1849 
boŞ
 
	g¡©us2
 = 
çl£
;

1850 
In£¹Stus
 
	g¡©us3
 = In£¹Stus::
FAILED_TO_INSERT
;

1852 if(
	g_»m­_’abËd
 && !
	g¡©us1
){

1853 
hash_t
 
	g£cÚd¬y_buck‘_id
 = 
d‘”mše_®‹º©e_buck‘
(
buck‘_ids
[
i
],

1854 
fšg”´šts
[
i
]);

1855 
	g¡©us2
 = 
fœ¡_Ëv–_¡Üe
(
£cÚd¬y_buck‘_id
, 
fšg”´šts
[
i
], 
c2
[i]);

1857 if(
	g_cŞlisiÚ_»sŞutiÚ_’abËd
 && !
	g¡©us2
){

1858 
	gc1
[
i
].
	gcouÁ”_v®ue
 = 
»ad_couÁ”
(
c1
[i].
block_id
,

1859 
c1
[
i
].
couÁ”_šdex
);

1860 
	gc1
[
i
].
	g–em’ts_š_block
 = 
»pÜt_f§_lßd
(
c1
[i].
block_id
);

1861 
	gc1
[
i
].
	gbuck‘_¡¬t_šdex
 = 
g‘_buck‘_¡¬t_šdex
(
c1
[i].
block_id
,

1862 
c1
[
i
].
couÁ”_šdex
);

1863 
	g¡©us3
 = 
»sŞve_cŞlisiÚ
(
buck‘_ids
[
i
], 
£cÚd¬y_buck‘_id
,

1864 
fšg”´šts
[
i
], 
c1
[i], 
c2
[i]);

1868 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
 &

1869 (
	g¡©us2
 | (
	g¡©us3
 =ğ
In£¹Stus
::
PLACED_IN_SECONDARY_BUCKET
))){

1870 
£t_ov”æow_¡©us
(
buck‘_ids
[
i
], 
fšg”´šts
[i], 
c1
[i].
block_id
,

1871 
c1
[
i
].
couÁ”_šdex
);

1874 
	g¡©u£s
[
off£t
 + 
i
] = 
¡©us1
 | 
¡©us2
 |

1875 (
¡©us3
 !ğ
In£¹Stus
::
FAILED_TO_INSERT
);

1877 ifĞ!
	g¡©u£s
[
off£t
 + 
i
]){

1884 
šlše
 
boŞ
 
fœ¡_Ëv–_¡Üe
(
hash_t
 
buck‘_id
, 
©om_t
 
fšg”´št
,

1885 
StÜeP¬ams
& 
¥
){

1890 
	g¥
.
	gblock_id
 = 
buck‘_id
 / 
_buck‘s_³r_block
;

1891 
	g¥
.
	gcouÁ”_šdex
 = (
buck‘_id
 % 
_buck‘s_³r_block
);

1893 
	g_»duùiÚ_m‘hod
){

1894 
	gReduùiÚM‘hodEnum
::
NAIVE_FULL_EXCLUSIVE_SCAN
:{

1895 
couÁ”_t
* 
exşusive_sÿn_±r
 = 
fuÎ_exşusive_sÿn
(
¥
.
block_id
);

1896 
	g¥
.
	gbuck‘_¡¬t_šdex
 = 
exşusive_sÿn_±r
[
¥
.
couÁ”_šdex
];

1897 
	g¥
.
	g–em’ts_š_block
 = 
exşusive_sÿn_±r
[
_buck‘s_³r_block
];

1901 
	gReduùiÚM‘hodEnum
::
PARALLEL_REDUCE
:

1902 
¥
.
buck‘_¡¬t_šdex
 = 
exşusive_»duû_w™h_·¿Î–_sum
(

1903 
_¡Üage
[
¥
.
block_id
], sp.
couÁ”_šdex
);

1904 
	g¥
.
	g–em’ts_š_block
 = 
»pÜt_f§_lßd
(
¥
.
block_id
);

1907 
	gReduùiÚM‘hodEnum
::
POP_CNT
:

1908 
¥
.
buck‘_¡¬t_šdex
 = 
exşusive_»duû_w™h_pİcouÁ
(

1909 
_¡Üage
[
¥
.
block_id
], sp.
couÁ”_šdex
);

1910 
	g¥
.
	g–em’ts_š_block
 = 
»pÜt_f§_lßd
(
¥
.
block_id
);

1913 
¡d
::
û¼
 << "ERROR: Undefined setting for _reduction_method\n";

1914 
ex™
(1);

1918 if(
	g_DEBUG
){

1919 
	g¡d
::
cout
 << "In£¹šg fšg”´šˆ" << 
fšg”´št
 << " into block "

1920 << 
¥
.
block_id
 << ", which has " <<

1921 
¡©ic_ÿ¡
<
ušt32_t
>(
¥
.
–em’ts_š_block
) <<

1925 
	g¥
.
	gcouÁ”_v®ue
 = 
»ad_couÁ”
(
¥
.
block_id
, sp.
couÁ”_šdex
);

1927 
boŞ
 
	g»m­_Ãûs§ry
 = (
¥
.
–em’ts_š_block
 =ğ
_max_fšg”´šts_³r_block
)

1928 | (
¥
.
couÁ”_v®ue
 =ğ
_¦Ùs_³r_buck‘
);

1930 if(
	g»m­_Ãûs§ry
è 
	gçl£
;

1932 if(
	g_DEBUG
){

1933 
	g¡d
::
cout
 << "In£¹šg fšg”´šˆ" << 
fšg”´št
 << "‡t offset " <<

1934 
_fšg”´št_off£t
 << " bits from start of bucket‡t index " <<

1935 
¡©ic_ÿ¡
<
ušt32_t
>(
¥
.
buck‘_¡¬t_šdex
) << ". Fingerprint is "

1936 << 
_fšg”´št_Ën_b™s
 <<

1937 " wide. " << 
¡d
::
’dl
;

1942 
wr™e_fšg”´št_Ëá_di¥Ïû
(
_¡Üage
[
¥
.
block_id
], sp.
buck‘_¡¬t_šdex
,

1943 
fšg”´št
);

1946 
šüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
¥
.
block_id
], sp.
couÁ”_šdex
);

1949 if(
	g_block_fuÎÃss_¬¿y_’abËd
 && (
	g¥
.
	g–em’ts_š_block
 ==

1950 
_max_fšg”´šts_³r_block
 - 1)){

1951 
_block_fuÎÃss_¬¿y
[
¥
.
block_id
] = 
Œue
;

1953  
	gŒue
;

1958 
šlše
 
boŞ
 
Œy_»loÿtiÚ
(
hash_t
 
buck‘_id
, 
©om_t
 
fšg”´št
,

1959 cÚ¡ 
StÜeP¬ams
& 
¥
){

1960 
couÁ”_t
 
	g¦Ù_id
 = 0; slÙ_id < 
	g¥
.
	gcouÁ”_v®ue
; slot_id++){

1961 
©om_t
 
	gÿndid©e_fšg”´št_to_eviù
 =

1962 
»ad_fšg”´št
(
¥
.
block_id
, sp.
buck‘_¡¬t_šdex
 + 
¦Ù_id
);

1963 
hash_t
 
	g®‹º©e_buck‘_id
 = 
d‘”mše_®‹º©e_buck‘
(
buck‘_id
,

1964 
ÿndid©e_fšg”´št_to_eviù
);

1966 
boŞ
 
	g´oûed_to_fœ¡_Ëv–_¡Üe
 = 
Œue
;

1967 if(
	g_block_fuÎÃss_¬¿y_’abËd
){

1968 
	g´oûed_to_fœ¡_Ëv–_¡Üe
 = ! 
_block_fuÎÃss_¬¿y
[
®‹º©e_buck‘_id
 / 
_buck‘s_³r_block
];

1971 
StÜeP¬ams
 
	g¥_´ime
;

1974 if(
	g´oûed_to_fœ¡_Ëv–_¡Üe
 &&

1975 
fœ¡_Ëv–_¡Üe
(
®‹º©e_buck‘_id
,

1976 
ÿndid©e_fšg”´št_to_eviù
, 
¥_´ime
)){

1978 
wr™e_fšg”´št
(
_¡Üage
[
¥
.
block_id
], sp.
buck‘_¡¬t_šdex
 +

1979 
¦Ù_id
, 
fšg”´št
);

1982 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
){

1983 
£t_ov”æow_¡©us
(
buck‘_id
, 
ÿndid©e_fšg”´št_to_eviù
,

1984 
¥
.
block_id
, sp.
couÁ”_šdex
);

1987  
	gŒue
;

1990  
	gçl£
;

2002 
INLINE
 
boŞ
 
Œy_»loÿtiÚ_Ú_block_ov”æow
(
hash_t
 
buck‘_id
,

2003 
©om_t
 
fšg”´št
, 
StÜeP¬ams
& 
¥
){

2005 
	gbuck‘_id
 -ğ(
buck‘_id
 % 
_buck‘s_³r_block
);

2006 
couÁ”_t
 
	gcouÁ”_šdex
 = 0; couÁ”_šdex < 
	g_buck‘s_³r_block
;

2007 
	gcouÁ”_šdex
++, 
	gbuck‘_id
++){

2009 
couÁ”_t
 
	gbuck‘_¡¬t_šdex
 = 
exşusive_»duû
(

2010 
_¡Üage
[
¥
.
block_id
], 
couÁ”_šdex
);

2011 
couÁ”_t
 
	goccup›d_¦Ùs
 = 
»ad_couÁ”
(
¥
.
block_id
, 
couÁ”_šdex
);

2012 
couÁ”_t
 
	g¦Ù_id
 = 0; slÙ_id < 
	goccup›d_¦Ùs
; slot_id++){

2013 
©om_t
 
	gÿndid©e_fšg”´št_to_eviù
 =

2014 
»ad_fšg”´št
(
¥
.
block_id
, 
buck‘_¡¬t_šdex
 + 
¦Ù_id
);

2015 
hash_t
 
	g®‹º©e_buck‘_id
 = 
d‘”mše_®‹º©e_buck‘
(
buck‘_id
,

2016 
ÿndid©e_fšg”´št_to_eviù
);

2017 
StÜeP¬ams
 
	g¥_´ime
;

2018 
boŞ
 
	g´oûed_to_fœ¡_Ëv–_¡Üe
 = 
Œue
;

2019 if(
	g_block_fuÎÃss_¬¿y_’abËd
){

2020 
	g´oûed_to_fœ¡_Ëv–_¡Üe
 = ! 
_block_fuÎÃss_¬¿y
[
®‹º©e_buck‘_id
 / 
_buck‘s_³r_block
];

2024 if(
	g´oûed_to_fœ¡_Ëv–_¡Üe
 &&

2025 
fœ¡_Ëv–_¡Üe
(
®‹º©e_buck‘_id
,

2026 
ÿndid©e_fšg”´št_to_eviù
, 
¥_´ime
)){

2028 
d–‘e_fšg”´št_right_di¥Ïû
(
_¡Üage
[
¥
.
block_id
],

2029 
buck‘_¡¬t_šdex
 + 
¦Ù_id
);

2030 
deüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
¥
.
block_id
], 
couÁ”_šdex
,

2031 
occup›d_¦Ùs
);

2036 
	g¥
.
	gbuck‘_¡¬t_šdex
 = (
couÁ”_šdex
 < 
¥
.counter_index ?

2037 
¥
.
buck‘_¡¬t_šdex
 - 1: sp.bucket_start_index);

2039 
wr™e_fšg”´št_Ëá_di¥Ïû
(
_¡Üage
[
¥
.
block_id
],

2040 
¥
.
buck‘_¡¬t_šdex
, 
fšg”´št
);

2041 
šüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
¥
.
block_id
], sp.
couÁ”_šdex
);

2044 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
){

2045 
£t_ov”æow_¡©us
(
buck‘_id
, 
ÿndid©e_fšg”´št_to_eviù
,

2046 
¥
.
block_id
, sp.
couÁ”_šdex
);

2049 if(
	g_DEBUG
è
	g¡d
::
cout
 << "Exiting block overflow with success.\n";

2050  
	gŒue
;

2055 if(
	g_DEBUG
è
	g¡d
::
cout
 << "Exiting block overflow with failure.\n";

2056  
	gçl£
;

2059 
INLINE
 
hash_t
 
g‘_Ùa_šdex
(hash_ˆ
buck‘_id
, 
©om_t
 
fšg”´št
) const{

2060 
cÚ¡ex´
 
boŞ
 
	gsÿË_buck‘_id
 = 
_»sizšg_’abËd
 &

2061 (
_mÜtÚ_Ùa_hashšg_m‘hod
 !=

2062 
Ov”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
LEMIRE_FINGERPRINT_MULTIPLY
) &

2063 (
__butš_pİcouÁÎ
(
_buck‘s_³r_block
) != 1);

2064 if(
	gsÿË_buck‘_id
){

2065 
hash_t
 
	gŞd_block_id
 = (
buck‘_id
 / 
_buck‘s_³r_block
è>> 
_»size_couÁ
;

2066 
hash_t
 
	glbi
 = 
Şd_block_id
 % 
_buck‘s_³r_block
;

2067 
	gbuck‘_id
 = 
Şd_block_id
 * 
_buck‘s_³r_block
 + 
lbi
;

2069 
hash_t
 
	gÙa_šdex
;

2070 
	g_mÜtÚ_Ùa_hashšg_m‘hod
){

2071 
	gOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
LEMIRE_FINGERPRINT_MULTIPLY
:

2072 
Ùa_šdex
 = 
ut
::
ç¡_mod_®‹º©ive
<
©om_t
>(
fšg”´št
,

2073 
	g_Ùa_Ën_b™s
, 
	g_fšg”´št_Ën_b™s
);

2076 
	gOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
RAW_BUCKET_HASH
:

2077 
Ùa_šdex
 = 
buck‘_id
 % 
_Ùa_Ën_b™s
;

2080 
	gOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
CLUSTERED_BUCKET_HASH
:{

2083 
cÚ¡ex´
 
ušt64_t
 
divisÜ
 = 
_Ùa_Ën_b™s
 > 0 ?

2084 (
_buck‘s_³r_block
 + 
_Ùa_Ën_b™s
 - 1) /_ota_len_bits :

2086 
	gÙa_šdex
 = (
buck‘_id
 % 
_buck‘s_³r_block
è/ 
divisÜ
;

2090  
	gÙa_šdex
;

2095 
šlše
 
boŞ
 
check_bloom_f‹r_Ùa
(
hash_t
 
buck‘_id
, 
©om_t
 
fšg”´št
,

2096 cÚ¡ 
hash_t
 
block_id
) const{

2097 cÚ¡ 
ušt_ç¡64_t
 
	gnum_hash_fús
 = 2;

2098 
	g¡d
::
b™£t
<
num_hash_fús
> 
¡©us
;

2099 cÚ¡ 
©om_t
 
	ghash
 = 
buck‘_id
 * 0xff51afd7ed558ccdULL;

2100 
ušt64_t
 
	gi
 = 0; i < 
	gnum_hash_fús
; i++){

2102 
hash_t
 
	gÙa_šdex
 = 
g‘_Ùa_šdex
(
hash
 >> (
i
 * 
_Ùa_Ën_b™s
),

2103 
fšg”´št
);

2104 
	g¡©us
[
i
] = 
_¡Üage
[
block_id
].
»ad_b™
(
_ov”æow_Œackšg_¬¿y_off£t
 +

2105 
Ùa_šdex
);

2107  
	g¡©us
.
®l
();

2111 
šlše
 
£t_bloom_f‹r_Ùa
(cÚ¡ 
hash_t
 
buck‘_id
, 
©om_t
 
fšg”´št
,

2112 cÚ¡ 
hash_t
 
block_id
){

2113 
cÚ¡ex´
 
ušt_ç¡64_t
 
	gnum_hash_fús
 = 2;

2114 cÚ¡ 
©om_t
 
	ghash
 = 
buck‘_id
 * 0xff51afd7ed558ccdULL;

2115 
ušt64_t
 
	gi
 = 0; i < 
	gnum_hash_fús
; i++){

2117 
hash_t
 
	gÙa_šdex
 = 
g‘_Ùa_šdex
(
hash
 >> (
i
 * 
_Ùa_Ën_b™s
), 
fšg”´št
);

2118 
	g_¡Üage
[
block_id
].
¡icky_£t_b™
(
_ov”æow_Œackšg_¬¿y_off£t
 +

2119 
Ùa_šdex
, 1);

2124 
šlše
 
boŞ
 
g‘_ov”æow_¡©us
(
hash_t
 
buck‘_id
, 
©om_t
 
fšg”´št
) const{

2125 
hash_t
 
	gÙa_šdex
 = 
g‘_Ùa_šdex
(
buck‘_id
, 
fšg”´št
);

2126 
hash_t
 
	gblock_id
 = 
buck‘_id
 / 
_buck‘s_³r_block
;

2128 if(
	g_u£_bloom_Ùa
){

2129  
check_bloom_f‹r_Ùa
(
buck‘_id
, 
fšg”´št
, 
block_id
);

2132 
cÚ¡ex´
 
boŞ
 
	gusšg_£Ëùive_mf
 = 
_Ùa_lbi_š£¹iÚ_th»shŞd
 > - 1;

2133 if(
	gusšg_£Ëùive_mf
){

2134 
hash_t
 
	glbi
 = 
buck‘_id
 % 
_buck‘s_³r_block
;

2135  
	g_¡Üage
[
block_id
].
»ad_b™
(
_ov”æow_Œackšg_¬¿y_off£t
 +

2136 
Ùa_šdex
è| (
	g¡©ic_ÿ¡
<
	gšt16_t
>(
	glbi
è<ğ
_Ùa_lbi_š£¹iÚ_th»shŞd
);

2139  
	g_¡Üage
[
block_id
].
»ad_b™
(
_ov”æow_Œackšg_¬¿y_off£t
 +

2140 
Ùa_šdex
);

2145 
šlše
 
£t_ov”æow_¡©us
(cÚ¡ 
hash_t
 
buck‘_id
,

2146 cÚ¡ 
©om_t
 
fšg”´št
, cÚ¡ 
hash_t
 
block_id
, cÚ¡ hash_ˆ
lbi
){

2148 if(
	g_u£_bloom_Ùa
){

2149  
£t_bloom_f‹r_Ùa
(
buck‘_id
, 
fšg”´št
, 
block_id
);

2152 
hash_t
 
	gÙa_šdex
 = 
g‘_Ùa_šdex
(
buck‘_id
, 
fšg”´št
);

2153 
cÚ¡ex´
 
boŞ
 
	gusšg_£Ëùive_mf
 = 
_Ùa_lbi_š£¹iÚ_th»shŞd
 > -1;

2154 if(
	gusšg_£Ëùive_mf
){

2155 
	g_¡Üage
[
block_id
].
¡icky_£t_b™
(

2156 
_ov”æow_Œackšg_¬¿y_off£t
 + 
Ùa_šdex
,

2157 
¡©ic_ÿ¡
<
št16_t
>(
buck‘_id
 % 
_buck‘s_³r_block
è> 
_Ùa_lbi_š£¹iÚ_th»shŞd
);

2160 
	g_¡Üage
[
block_id
].
¡icky_£t_b™
(

2161 
_ov”æow_Œackšg_¬¿y_off£t
 + 
Ùa_šdex
, 1);

2165 
šlše
 
boŞ
 
¿ndom_kickout_cuckoo
(
hash_t
 
buck‘_id
, 
©om_t
 
fšg”´št
){

2166 
ušt_ç¡16_t
 
	gmax_couÁ
 = 300;

2167 
ušt_ç¡16_t
 
	gcouÁ
 = 1;

2169 
AcûssCouÁ”
 
	gacûss_couÁ
;

2170 
	gcouÁ
 <ğ
max_couÁ
){

2172 
ušt64_t
 
block_id
 = 
buck‘_id
 / 
_buck‘s_³r_block
;

2174 cÚ¡ 
ušt16_t
 
	gcouÁ”_šdex
 = (
buck‘_id
 % 
_buck‘s_³r_block
);

2176 
couÁ”_t
 
	gfuÎ_¦Ùs
 = 
»ad_couÁ”
(
block_id
, 
couÁ”_šdex
);

2178 
couÁ”_t
 
	gbuck‘_¡¬t_šdex
 = 
g‘_buck‘_¡¬t_šdex
(
block_id
,

2179 
couÁ”_šdex
);

2181 
couÁ”_t
 
	gf§_lßd_š_fšg”´šts
 = 
g‘_buck‘_¡¬t_šdex
(
block_id
,

2182 
_buck‘s_³r_block
);

2185 if(
__butš_ex³ù
((
fuÎ_¦Ùs
 < 
_¦Ùs_³r_buck‘
) &

2186 (
f§_lßd_š_fšg”´šts
 < 
_max_fšg”´šts_³r_block
), 0)){

2189 
wr™e_fšg”´št_Ëá_di¥Ïû
(
_¡Üage
[
block_id
], 
buck‘_¡¬t_šdex
,

2190 
fšg”´št
);

2192 
šüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
block_id
], 
couÁ”_šdex
);

2194 if(
	g_block_fuÎÃss_¬¿y_’abËd
 &&

2195 
	gf§_lßd_š_fšg”´šts
 =ğ
_max_fšg”´šts_³r_block
 - 1){

2196 
_block_fuÎÃss_¬¿y
[
block_id
] = 
Œue
;

2198 if(
	g_´št_acûss_couÁs
){

2199 
	gacûss_couÁ
.
	g´im¬y_couÁ
++;

2200 
	g¡d
::
cout
 << (
ušt32_t
è
acûss_couÁ
.
´im¬y_couÁ
 + 1 << ","

2201 << (
ušt32_t
è
acûss_couÁ
.
block_ov”æow_couÁ
 << ","

2202 << (
ušt32_t
è
acûss_couÁ
.
buck‘_ov”æow_couÁ
 << ","

2203 << (
ušt32_t
è
acûss_couÁ
.
block_ªd_buck‘_ov”æow_couÁ
 <<

2204 
¡d
::
’dl
;

2206  
	gŒue
;

2211 if(
__butš_ex³ù
(
fuÎ_¦Ùs
 =ğ
_¦Ùs_³r_buck‘
, 0)){

2215 
ušt32_t
 
	g¦Ù_id
 = 
_¦Ùs_³r_buck‘
 - 1;

2216 
©om_t
 
	gf2
 = 
»ad_fšg”´št
(
block_id
, 
buck‘_¡¬t_šdex
 + 
¦Ù_id
);

2218 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
){

2219 
£t_ov”æow_¡©us
(
buck‘_id
, 
f2
, 
block_id
, 
couÁ”_šdex
);

2222 
wr™e_fšg”´št
(
_¡Üage
[
block_id
], 
buck‘_¡¬t_šdex
 + 
¦Ù_id
,

2223 
fšg”´št
);

2226 
	gbuck‘_id
 = 
d‘”mše_®‹º©e_buck‘
(
buck‘_id
, 
f2
);

2228 
	gfšg”´št
 = 
f2
;

2229 if(
	g_´št_acûss_couÁs
){

2230 if(
	gf§_lßd_š_fšg”´šts
 =ğ
_max_fšg”´šts_³r_block
){

2231 
acûss_couÁ
.
block_ªd_buck‘_ov”æow_couÁ
++;

2234 
	gacûss_couÁ
.
	gbuck‘_ov”æow_couÁ
++;

2246 
hash_t
 
	geviùiÚ_buck‘_id
;

2247 
couÁ”_t
 
	geviùiÚ_buck‘_couÁ
;

2251 
	geviùiÚ_buck‘_id
 = 
¿nd
(è% (
_buck‘s_³r_block
);

2252 
	geviùiÚ_buck‘_couÁ
 = 
»ad_couÁ”
(
block_id
, 
eviùiÚ_buck‘_id
);

2253 } 
	geviùiÚ_buck‘_couÁ
 == 0);

2255 
hash_t
 
	geviùiÚ_¦Ù_id
 = 
¿nd
(è% 
eviùiÚ_buck‘_couÁ
;

2256 
hash_t
 
	geviùiÚ_buck‘_off£t
 = 
g‘_buck‘_¡¬t_šdex
(
block_id
,

2257 
eviùiÚ_buck‘_id
);

2258 
©om_t
 
	gf3
 = 
»ad_fšg”´št
(
block_id
,

2259 
eviùiÚ_buck‘_off£t
 + 
eviùiÚ_¦Ù_id
);

2261 
d–‘e_fšg”´št_right_di¥Ïû
(
_¡Üage
[
block_id
],

2262 
eviùiÚ_buck‘_off£t
 + 
eviùiÚ_¦Ù_id
);

2264 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
){

2265 
hash_t
 
	gfuÎ_eviùiÚ_buck‘_id
 = 
block_id
 * 
_buck‘s_³r_block
 +

2266 
eviùiÚ_buck‘_id
;

2267 
£t_ov”æow_¡©us
(
fuÎ_eviùiÚ_buck‘_id
, 
f3
, 
block_id
,

2268 
eviùiÚ_buck‘_id
);

2272 
deüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
block_id
], 
eviùiÚ_buck‘_id
,

2273 
eviùiÚ_buck‘_couÁ
);

2278 
	gbuck‘_¡¬t_šdex
 = (
eviùiÚ_buck‘_id
 < 
couÁ”_šdex
 ?

2279 
buck‘_¡¬t_šdex
 - 1 : bucket_start_index);

2281 
wr™e_fšg”´št_Ëá_di¥Ïû
(
_¡Üage
[
block_id
], 
buck‘_¡¬t_šdex
,

2282 
fšg”´št
);

2284 
šüem’t_fuÎÃss_couÁ”
(
_¡Üage
[
block_id
], 
couÁ”_šdex
);

2287 
	gbuck‘_id
 = 
d‘”mše_®‹º©e_buck‘
(
block_id
 * 
_buck‘s_³r_block
 +

2288 
eviùiÚ_buck‘_id
, 
f3
);

2290 
	gfšg”´št
 = 
f3
;

2291 if(
	g_´št_acûss_couÁs
è
	gacûss_couÁ
.
	gblock_ov”æow_couÁ
++;

2293 
	gcouÁ
 ++;

2298  
	gçl£
;

2301 
šlše
 
doubË_ÿ·c™y
(){

2302 
	g»size
<1>();

2305 
šlše
 
quadru¶e_ÿ·c™y
(){

2306 
	g»size
<2>();

2309 
šlše
 
oùu¶e_ÿ·c™y
(){

2310 
	g»size
<3>();

2316 
	g‹m¶©e
<
ušt64_t
 
	glog2_»size
>

2317 
šlše
 
»size
(){

2318 if(!
	g_»sizšg_’abËd
){

2319 
	g¡d
::
û¼
 << "Sethe _resizing_enabled flago usehe„esize() or double_capacity() methods\n";

2320 
ex™
(1);

2323 
cÚ¡ex´
 
hash_t
 
	gÚe
 = 1;

2324 
cÚ¡ex´
 
ušt64_t
 
	g»size_çùÜ
 = (
Úe
 << 
log2_»size
);

2325 
ušt64_t
 
	gÃw_tÙ®_buck‘s
 = 
_tÙ®_buck‘s
 * 
»size_çùÜ
;

2326 
ušt64_t
 
	gÃw_tÙ®_¦Ùs
 = 
Ãw_tÙ®_buck‘s
 * 
_¦Ùs_³r_buck‘
;

2327 
ušt64_t
 
	gÃw_tÙ®_blocks
 = (
Ãw_tÙ®_¦Ùs
 + 
_¦Ùs_³r_buck‘
 * 
_buck‘s_³r_block
 - 1) / (_slots_per_bucket * _buckets_per_block);

2329 
block_t
* 
	gÃw_¡Üage
 = 
®loÿ‹_ÿche_®igÃd_¡Üage
(
Ãw_tÙ®_blocks
);

2330 
block_t
* 
	gŞd_¡Üage
 = 
_¡Üage
;

2332 
ušt64_t
 
	gblock_id
 = 0; block_id < 
	g_tÙ®_blocks
; block_id++){

2335 
hash_t
 
	gf§_poš‹rs
[
»size_çùÜ
]{};

2336 
hash_t
 
	gf§_šdex
 = 0;

2338 
ušt64_t
 
	gcouÁ”_šdex
 = 0; couÁ”_šdex < 
	g_buck‘s_³r_block
;

2339 
	gcouÁ”_šdex
++){

2340 
couÁ”_t
 
	gfuÎÃss_couÁ”
 = 
»ad_couÁ”
(
block_id
, 
couÁ”_šdex
);

2341 
ušt64_t
 
	g¦Ù_id
 = 0; slÙ_id < 
	gfuÎÃss_couÁ”
; slÙ_id++, 
	gf§_šdex
++){

2342 
©om_t
 
	gfšg”´št
 = 
»ad_fšg”´št
(
block_id
, 
f§_šdex
);

2343 
hash_t
 
	gf§_poš‹r_šdex
 = ((
fšg”´št
 >> (
_fšg”´št_Ën_b™s
 - 
_»size_couÁ
 - 
log2_»size
)è& (
»size_çùÜ
 - 
Úe
));

2344 
hash_t
 
	gÃw_block
 = 
»size_çùÜ
 * 
block_id
 + 
f§_poš‹r_šdex
;

2345 
wr™e_fšg”´št
(
Ãw_¡Üage
[
Ãw_block
],

2346 
f§_poš‹rs
[
f§_poš‹r_šdex
], 
fšg”´št
);

2347 
	gf§_poš‹rs
[
f§_poš‹r_šdex
]++;

2348 
šüem’t_fuÎÃss_couÁ”
(
Ãw_¡Üage
[
Ãw_block
], 
couÁ”_šdex
);

2352 
©om_t
 
	gÙa
 = 
Şd_¡Üage
[
block_id
].
»ad_üoss
(
_ov”æow_Œackšg_¬¿y_off£t
, 
_Ùa_Ën_b™s
, 0);

2353 
ušt64_t
 
	gba£_id
 = 
block_id
 * 
»size_çùÜ
;

2354 
ušt64_t
 
	gÃw_block_id
 = 
ba£_id
;‚ew_block_id < 
	gba£_id
 + 
	g»size_çùÜ
;‚ew_block_id++){

2355 
	gÃw_¡Üage
[
Ãw_block_id
].
add_üoss
(
_ov”æow_Œackšg_¬¿y_off£t
, 
_Ùa_Ën_b™s
, 0, 
Ùa
);

2358 
	g_tÙ®_buck‘s
 = 
Ãw_tÙ®_buck‘s
;

2359 
	g_tÙ®_¦Ùs
 = 
Ãw_tÙ®_¦Ùs
;

2360 
	g_tÙ®_blocks
 = 
Ãw_tÙ®_blocks
;

2361 
	g_¡Üage
 = 
Ãw_¡Üage
;

2363 
	g_»size_couÁ
+=
log2_»size
;

2364 
ä“
(
Şd_¡Üage
);

2378 
INLINE
 
In£¹Stus
 
»sŞve_cŞlisiÚ
(
hash_t
 
buck‘_id
,

2379 
hash_t
 
£cÚd¬y_buck‘_id
,

2380 
©om_t
 
fšg”´št
, 
StÜeP¬ams
& 
c1
, StÜeP¬ams& 
c2
){

2388 
boŞ
 
	g´im¬y_block_ov”æow
 = 
c1
.
couÁ”_v®ue
 !ğ
_¦Ùs_³r_buck‘
;

2389 
boŞ
 
	g£cÚd¬y_block_ov”æow
 = 
c2
.
couÁ”_v®ue
 !ğ
_¦Ùs_³r_buck‘
;

2392 if(
	g´im¬y_block_ov”æow
 &&

2393 
Œy_»loÿtiÚ_Ú_block_ov”æow
(
buck‘_id
, 
fšg”´št
, 
c1
)){

2394 if(
	g_DEBUG
è
	g¡d
::
cout
 << "Success onhird„elocation‡ttempt\n";

2395  
	gIn£¹Stus
::
PLACED_IN_PRIMARY_BUCKET
;

2399 ifĞ
Œy_»loÿtiÚ
(
buck‘_id
, 
fšg”´št
, 
c1
)){

2400 if(
	g_DEBUG
è
	g¡d
::
cout
 << "Success on first„elocation‡ttempt\n";

2401  
	gIn£¹Stus
::
PLACED_IN_PRIMARY_BUCKET
;

2405 if(
	g£cÚd¬y_block_ov”æow
 &&

2406 
Œy_»loÿtiÚ_Ú_block_ov”æow
(
£cÚd¬y_buck‘_id
, 
fšg”´št
, 
c2
)){

2407 if(
	g_DEBUG
è
	g¡d
::
cout
 << "Success on fourth„elocation‡ttempt\n";

2408  
	gIn£¹Stus
::
PLACED_IN_SECONDARY_BUCKET
;

2412 
Œy_»loÿtiÚ
(
£cÚd¬y_buck‘_id
, 
fšg”´št
, 
c2
)){

2413 if(
	g_DEBUG
è
	g¡d
::
cout
 << "Success on second„elocation‡ttempt\n";

2414  
	gIn£¹Stus
::
PLACED_IN_SECONDARY_BUCKET
;

2417 
In£¹Stus
 
	g»tuº_¡©us
 = 
¿ndom_kickout_cuckoo
(
buck‘_id
, 
fšg”´št
) ?

2418 
	gIn£¹Stus
::
PLACED_IN_PRIMARY_BUCKET
 :

2419 
In£¹Stus
::
FAILED_TO_INSERT
;

2420  
	g»tuº_¡©us
;

2422  
	gIn£¹Stus
::
FAILED_TO_INSERT
;

2426 
šlše
 
boŞ
 
bË_¡Üe
(
hash_t
 
buck‘_id
, 
©om_t
 
fšg”´št
){

2427 
StÜeP¬ams
 
	gc1
;

2428 
StÜeP¬ams
 
	gc2
;

2429 
boŞ
 
	g¡©us1
 = 
fœ¡_Ëv–_¡Üe
(
buck‘_id
, 
fšg”´št
, 
c1
);

2430 
boŞ
 
	g¡©us2
 = 
çl£
;

2431 
In£¹Stus
 
	g¡©us3
 = In£¹Stus::
FAILED_TO_INSERT
;

2432 if(
	g_»m­_’abËd
 && !
	g¡©us1
){

2433 
hash_t
 
	g£cÚd¬y_buck‘_id
 = 
d‘”mše_®‹º©e_buck‘
(
buck‘_id
,

2434 
fšg”´št
);

2435 
	g¡©us2
 = 
fœ¡_Ëv–_¡Üe
(
£cÚd¬y_buck‘_id
, 
fšg”´št
, 
c2
);

2436 if(
	g_cŞlisiÚ_»sŞutiÚ_’abËd
 && !
	g¡©us2
){

2437 
	g¡©us3
 = 
»sŞve_cŞlisiÚ
(
buck‘_id
, 
£cÚd¬y_buck‘_id
,

2438 
fšg”´št
, 
c1
, 
c2
);

2442 if(
	g_mÜtÚ_f‹r_funùiÚ®™y_’abËd
 &

2443 (
	g¡©us2
 | (
	g¡©us3
 =ğ
In£¹Stus
::
PLACED_IN_SECONDARY_BUCKET
))){

2444 
£t_ov”æow_¡©us
(
buck‘_id
, 
fšg”´št
, 
c1
.
block_id
, c1.
couÁ”_šdex
);

2447 
boŞ
 
	gÃt_¡©us
 = 
¡©us1
 | 
¡©us2
 |

2448 (
¡©us3
 !ğ
In£¹Stus
::
FAILED_TO_INSERT
);

2450 if(
	g_´št_acûss_couÁs
 && (
	g¡©us1
 | 
	g¡©us2
)){

2451 
	g¡d
::
cout
 << 
¡©us1
 + (
¡©us2
 << 1è<< ",0,0,0" << 
¡d
::
’dl
;

2454 ifĞ!
	gÃt_¡©us
){

2455 
	g¡d
::
û¼
 << "TabË stÜçed oÀbuck‘ " << 
buck‘_id
 <<

2456 "‡nd fšg”´šˆ" << 
fšg”´št
 << ".\n" << 
¡d
::
’dl
;

2458  
	gÃt_¡©us
;

2462 
	g¡d
::
¡ršg
 
physiÿl_Ïyout
(){

2463 
¡d
::
¡ršg¡»am
 
ss
;

2464 
hash_t
 
	gblock_id
 = 0; block_id < 
	g_tÙ®_blocks
; block_id++){

2465 
	gss
 << "Block " << 
	gblock_id
 << ": [ ";

2466 
št32_t
 
	g¦Ù
 = 
_max_fšg”´šts_³r_block
 - 1; slot > -1; slot--){

2467 
	gss
 << 
»ad_fšg”´št
(
block_id
, 
¦Ù
);

2469 
	gss
 << "]" << 
	g¡d
::
’dl
 << "[ ";

2470 
št32_t
 
	gcouÁ”
 = 
_buck‘s_³r_block
 - 1; counter > - 1; counter--){

2471 
	gss
 << 
»ad_couÁ”
(
block_id
, 
couÁ”
);

2473 
	gss
 << "]" << 
	g¡d
::
’dl
;

2475  
	gss
.
¡r
();

2478 
	g¡d
::
¡ršg
 
as_¡ršg
(){

2479 
¡d
::
¡ršg¡»am
 
ss
;

2480 
hash_t
 
	gbuck‘s_´oûs£d
 = 0;

2481 
hash_t
 
	gb_id
 = 0; b_id < 
	g_tÙ®_blocks
; b_id++){

2483 
couÁ”_t
* 
	gsÿn
 = 
fuÎ_exşusive_sÿn
(
b_id
);

2487 
hash_t
 
	gbuck‘
 = 0; buck‘ < 
	g_buck‘s_³r_block


2488 && 
	gbuck‘s_´oûs£d
 < 
	g_tÙ®_buck‘s
; 
	gbuck‘
++){

2490 
	gss
 << "[ ";

2492 
ušt16_t
 
	g»ad_šdex
 = 
sÿn
[
buck‘
];

2493 
ušt16_t
 
	goccup›d_¦Ùs
 = 
»ad_couÁ”
(
b_id
, 
buck‘
);

2494 
ušt16_t
 
	g¦Ù
 = 0; slÙ < 
	g_¦Ùs_³r_buck‘
; slot++){

2497 
©om_t
 
	gfšg”´št
 = 
»ad_fšg”´št
(
b_id
, 
»ad_šdex
 + 
¦Ù
);

2498 if(
	g¦Ù
 < 
	goccup›d_¦Ùs
){

2499 
	gss
 << 
	gfšg”´št
 << " ";

2502 
	gss
 << "EMPTY ";

2505 
	gss
 << "]" << " " << 
	goccup›d_¦Ùs
 << 
	g¡d
::
’dl
;

2506 
	gbuck‘s_´oûs£d
++;

2509  
	gss
.
¡r
();

2515 
g‘_max_¦Ù_com´essiÚ_¿tio
(){

2516  
	g¡©ic_ÿ¡
<>(
	g_max_fšg”´šts_³r_block
)/(
_¦Ùs_³r_buck‘
 *

2517 
	g_buck‘s_³r_block
);

2520 
´št_buck‘_ªd_block_lßd_hi¡og¿ms
(){

2521 
ušt64_t
 
	gbuck‘_lßd_hi¡og¿m
[
_¦Ùs_³r_buck‘
 + 1]{};

2522 
ušt64_t
 
	gblock_lßd_hi¡og¿m
[
_max_fšg”´šts_³r_block
 + 1]{};

2523 
ušt64_t
 
	gcombšed_hi¡og¿m
[
_¦Ùs_³r_buck‘
 + 1][
_max_fšg”´šts_³r_block
 + 1]{};

2524 
ušt64_t
 
	gb_id
 = 0; b_id < 
	g_tÙ®_blocks
; b_id++){

2525 
ušt64_t
 
	gblock_lßd
 = 
g‘_buck‘_¡¬t_šdex
(
b_id
, 
_buck‘s_³r_block
);

2526 
	gblock_lßd_hi¡og¿m
[
block_lßd
]++;

2527 
ušt64_t
 
	gbuck‘_id
 = 0; buck‘_id < 
	g_buck‘s_³r_block
; bucket_id++){

2528 
ušt64_t
 
	gbuck‘_lßd
 = 
»ad_couÁ”
(
b_id
, 
buck‘_id
);

2529 
	gbuck‘_lßd_hi¡og¿m
[
buck‘_lßd
]++;

2530 
	gcombšed_hi¡og¿m
[
buck‘_lßd
][
block_lßd
]++;

2533 
ušt64_t
 
	gbuck‘s_w™h_¥¬e_ÿ·c™y
 = 0;

2535 
	g¡d
::
cout
 << "TABLE";

2536 
ušt32_t
 
	gbuck‘_lßd
 = 0; buck‘_lßd <ğ
_¦Ùs_³r_buck‘
;

2537 
	gbuck‘_lßd
++){

2538 
	g¡d
::
cout
 << "\t" << 
buck‘_lßd
;

2540 
	g¡d
::
cout
 << 
¡d
::
’dl
;

2541 
	g¡d
::
cout
 << "BUCKET_LOAD_HISTOGRAM";

2542 
ušt32_t
 
	gbuck‘_lßd
 = 0; buck‘_lßd <ğ
_¦Ùs_³r_buck‘
;

2543 
	gbuck‘_lßd
++){

2544 
	g¡d
::
cout
 << "\t" << 
buck‘_lßd_hi¡og¿m
[
buck‘_lßd
];

2545 if(
	gbuck‘_lßd
 < 
	g_¦Ùs_³r_buck‘
){

2546 
	gbuck‘s_w™h_¥¬e_ÿ·c™y
 +ğ
buck‘_lßd_hi¡og¿m
[
buck‘_lßd
];

2549 
	g¡d
::
cout
 << 
¡d
::
’dl
 << std::endl;

2551 
ušt64_t
 
	gblocks_w™h_¥¬e_ÿ·c™y
 = 0;

2553 
	g¡d
::
cout
 << "TABLE";

2554 
ušt32_t
 
	gblock_lßd
 = 0; block_lßd <ğ
_max_fšg”´šts_³r_block
;

2555 
	gblock_lßd
++){

2556 
	g¡d
::
cout
 << "\t" << 
block_lßd
;

2557 if(
	gblock_lßd
 < 
	g_max_fšg”´šts_³r_block
){

2558 
	gblocks_w™h_¥¬e_ÿ·c™y
 +ğ
block_lßd_hi¡og¿m
[
block_lßd
];

2561 
	g¡d
::
cout
 << 
¡d
::
’dl
;

2562 
	g¡d
::
cout
 << "BLOCK_LOAD_HISTOGRAM";

2563 
ušt32_t
 
	gblock_lßd
 = 0; block_lßd <ğ
_max_fšg”´šts_³r_block
;

2564 
	gblock_lßd
++){

2565 
	g¡d
::
cout
 << "\t" << 
block_lßd_hi¡og¿m
[
block_lßd
];

2567 
	g¡d
::
cout
 << 
¡d
::
’dl
 << std::endl;

2570 
	g¡d
::
cout
 << "BLOCK_AND_BUCKET_LOAD_HISTOGRAM\n";

2571 
	g¡d
::
cout
 << "Fingerprints";

2572 
ušt32_t
 
	gbuck‘_lßd
 = 0; buck‘_lßd <ğ
_¦Ùs_³r_buck‘
;

2573 
	gbuck‘_lßd
++){

2574 
	g¡d
::
cout
 << "\t" << 
buck‘_lßd
;

2576 
	g¡d
::
cout
 << 
¡d
::
’dl
;

2577 
ušt64_t
 
	gbuck‘s_w™h_¥¬e_ÿ·c™y_š_nÚfuÎ_block
 = 0;

2578 
ušt32_t
 
	gblock_lßd
 = 0; block_lßd <ğ
_max_fšg”´šts_³r_block
;

2579 
	gblock_lßd
++){

2580 
	g¡d
::
cout
 << 
block_lßd
;

2581 
ušt32_t
 
	gbuck‘_lßd
 = 0; buck‘_lßd <ğ
_¦Ùs_³r_buck‘
;

2582 
	gbuck‘_lßd
++){

2583 
	g¡d
::
cout
 << "\t" << 
combšed_hi¡og¿m
[
buck‘_lßd
][
block_lßd
];

2584 if(
	gblock_lßd
 !ğ
_max_fšg”´šts_³r_block
 &&

2585 
buck‘_lßd
 !ğ
_¦Ùs_³r_buck‘
){

2586 
buck‘s_w™h_¥¬e_ÿ·c™y_š_nÚfuÎ_block
 +=

2587 
combšed_hi¡og¿m
[
buck‘_lßd
][
block_lßd
];

2590 
	g¡d
::
cout
 << 
¡d
::
’dl
;

2592 
	g¡d
::
cout
 << 
¡d
::
’dl
;

2594 
	g¡d
::
cout
 << "Percent of blocks with spare capacity: " <<

2595 100 * 
blocks_w™h_¥¬e_ÿ·c™y
 / 
¡©ic_ÿ¡
<>(
_tÙ®_blocks
) <<

2596 
¡d
::
’dl
;

2598 
	g¡d
::
cout
 << "Percent of buckets with spare capacity: " <<

2599 100 * 
buck‘s_w™h_¥¬e_ÿ·c™y
 / 
¡©ic_ÿ¡
<>(
_tÙ®_buck‘s
) <<

2600 
¡d
::
’dl
;

2602 
	g¡d
::
cout
 << "Percent of buckets with spare capacity in blocks with spare "

2603 "ÿ·c™y: " << 100 * 
buck‘s_w™h_¥¬e_ÿ·c™y_š_nÚfuÎ_block
 /

2604 
¡©ic_ÿ¡
<>(
_tÙ®_buck‘s
è<< 
¡d
::
’dl
;

2609 
	g¡d
::
¡ršg
 
g‘_¬¿y_dim’siÚs_as_¡ršg
(){

2610 
¡d
::
¡ršg¡»am
 
ss
;

2611 
	gss
 << "OTA: " << 
	g_Ùa_Ën_b™s
 << " x 1 bits = " << _ota_len_bits << "\n";

2612 
	gss
 << "FCA: " << 
	g_buck‘s_³r_block
 << " x " << 
	g_fuÎÃss_couÁ”_width
 <<

2613 " b™ ğ" << 
_buck‘s_³r_block
 * 
	g_fuÎÃss_couÁ”_width
 << "\n";

2614 
	gss
 << "FSA: " << 
	g_max_fšg”´šts_³r_block
 << " x " <<

2615 
	g_fšg”´št_Ën_b™s
 << " bits = " <<

2616 
_max_fšg”´šts_³r_block
 * 
	g_fšg”´št_Ën_b™s
 << "\n";

2617 
	gss
 << "N‘ b™s: " << 
	g_Ùa_Ën_b™s
 << " + " << 
_buck‘s_³r_block
 *

2618 
	g_fuÎÃss_couÁ”_width
 << " + " << 
_max_fšg”´šts_³r_block
 *

2619 
	g_fšg”´št_Ën_b™s
 << " = " << 
	g_Ùa_Ën_b™s
 + 
_buck‘s_³r_block
 *

2620 
	g_fuÎÃss_couÁ”_width
 + 
_max_fšg”´šts_³r_block
 *

2621 
	g_fšg”´št_Ën_b™s
 << "\n";

2622 
	gss
 << "C: " << 
g‘_max_¦Ù_com´essiÚ_¿tio
() << "\n";

2623  
	gss
.
¡r
();

2626 
ä›nd
 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am& 
os
,

2627 
	gCom´es£dCuckooF‹r
& 
	gcf
){

2628 
	gos
 << "Com´es£dCuckooF‹¸©‡dd»ss: " << &
	gcf
 << 
	g¡d
::
’dl
;

2629 
	gos
 << "Fšg”´šˆËngth iÀb™s: " << 
	gcf
.
	g_fšg”´št_Ën_b™s
 << 
	g¡d
::
’dl
;

2630 
	gos
 << "Ov”æow¿ckšg‡¼ay†’gth iÀb™s: " << 
	gcf
.
	g_Ùa_Ën_b™s
 << 
	g¡d
::
’dl
;

2631 
	gos
 << "Block†’gth iÀb™s: " << 
	gcf
.
	g_block_size_b™s
 << 
	g¡d
::
’dl
;

2632 
	gos
 << "Vœtu® slÙ ³¸buck‘: " << 
	gcf
.
	g_¦Ùs_³r_buck‘
 << 
	g¡d
::
’dl
;

2633 
	gos
 << "Max slÙ com´essiÚ„©io: " << 
	gcf
.
g‘_max_¦Ù_com´essiÚ_¿tio
()

2634 << 
	g¡d
::
’dl
;

2635 
	gos
 << "TÙ® slÙs: " << 
	gcf
.
	g_tÙ®_¦Ùs
 << 
	g¡d
::
’dl
;

2636 
	gos
 << "TÙ® buck‘s: " << 
	gcf
.
	g_tÙ®_buck‘s
 << 
	g¡d
::
’dl
;

2637 
	gos
 << "Buck‘ ³¸block: " << 
	gcf
.
	g_buck‘s_³r_block
 << 
	g¡d
::
’dl
;

2638 
	gos
 << "TÙ® blocks: " << 
	gcf
.
	g_tÙ®_blocks
 << 
	g¡d
::
’dl
;

2639 
	gos
 << "Max Fšg”´št ³¸block: " << 
	gcf
.
	g_max_fšg”´šts_³r_block
 << 
	g¡d
::
’dl
;

2640 
	gos
 << "FuÎÃs couÁ” off£t: " << 
	gcf
.
	g_fuÎÃss_couÁ”s_off£t
 << 
	g¡d
::
’dl
;

2641 
	gos
 << "Re£rved f›ld off£t: " << 
	gcf
.
	g_ov”æow_Œackšg_¬¿y_off£t
 << 
	g¡d
::
’dl
;

2642 
	gos
 << "Fšg”´šˆoff£t: " << 
	gcf
.
	g_fšg”´št_off£t
 << 
	g¡d
::
’dl
;

2644 if(
	g_DEBUG
){
	gos
 << 
	gcf
.
as_¡ršg
();}

2645  
	gos
;

	@fixed_point.h

37 #iâdeà
_FIXED_POINT_H


38 
	#_FIXED_POINT_H


	)

40 
Çme¥aû
 
	gCom´es£dCuckoo
{

44 
__ušt128_t
 
	tS”ŸlizedFixedPošt
;

45 
	sFixedPošt
{

46 
ušt64_t
 
	g_num”©Ü
;

47 
ušt64_t
 
	g_d’omš©Ü
;

48 
cÚ¡ex´
 
FixedPošt
(
ušt64_t
 
num”©Ü
, ušt64_ˆ
d’omš©Ü
) :

49 
_num”©Ü
(
num”©Ü
), 
_d’omš©Ü
(
d’omš©Ü
){}

51 
ex¶ic™
 
cÚ¡ex´
 
FixedPošt
(
å_»´e£Á©iÚ
) :

52 
_num”©Ü
(
å_»´e£Á©iÚ
 * 0x8000000000000000llu),

53 
_d’omš©Ü
(0x8000000000000000llu){}

54 
ex¶ic™
 
cÚ¡ex´
 
FixedPošt
(
S”ŸlizedFixedPošt
 
£rŸlized_fixed_pošt
) :

55 
_num”©Ü
(
£rŸlized_fixed_pošt
 & (0xffffffffffffffffllu)),

56 
_d’omš©Ü
(
£rŸlized_fixed_pošt
 >> 64){}

57 
cÚ¡ex´
 
to_doubË
() const{

58  
	g¡©ic_ÿ¡
<>(
	g_num”©Ü
è/ 
	g_d’omš©Ü
;

60 
cÚ¡ex´
 
to_æßt
() const{

61  
	g¡©ic_ÿ¡
<>(
	g_num”©Ü
è/ 
	g_d’omš©Ü
;

63 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
£rŸlize
() const{

64  
	g_num”©Ü
 + (
	g¡©ic_ÿ¡
<
	gS”ŸlizedFixedPošt
>(
	g_d’omš©Ü
)

	@hash_util.h

40 #iâdeà
_HASH_UTIL_H


41 
	#_HASH_UTIL_H


	)

43 
	~<¿ndom
>

45 
	~"veùÜ_ty³s.h
"

46 
	~"‹¡_ut.h
"

48 
	sB™MixMurmur
 {

49 
šlše
 
hash_t
 
İ”©Ü
()(
keys_t
 
	mkey
) const{

50 #ià
CCF_KEY_SIZE
 == 4

51  
hash32N
(
key
);

53  
hash64N
(
key
);

58 
	m‹m¶©e
<
şass
 
	mT
>

59 
šlše
 
T
 
hashN
(T 
ks
) const{

60 #ià
CCF_KEY_SIZE
 == 4

61  
hash32N
(
ks
);

63  
hash64N
(
ks
);

75 
	m‹m¶©e
 <
şass
 
	mT
>

76 
šlše
 
T
 
hash64N
(T 
ks
) const{

77 
	mks
 ^ğ
ks
 >> 33;

78 
	mks
 *= 0xff51afd7ed558ccdULL;

79 
	mks
 ^ğ
ks
 >> 33;

80 
	mks
 *= 0xc4ceb9fe1a85ec53ULL;

81 
	mks
 ^ğ
ks
 >> 33;

82  
	mks
;

85 
	m‹m¶©e
 <
şass
 
	mT
>

86 
šlše
 
T
 
hash32N
(T 
ks
) const{

87 
	mks
 ^ğ
ks
 >> 16;

88 
	mks
 *= 0x85ebca6b;

89 
	mks
 ^ğ
ks
 >> 13;

90 
	mks
 *= 0xc2b2ae35;

91 
	mks
 ^ğ
ks
 >> 16;

92  
	mks
;

	@morton_filter.h

37 #iâdeà
_MORTON_FILTER_H


38 
	#_MORTON_FILTER_H


	)

42 
	~"mÜtÚ_§m¶e_cÚfigs.h
"

	@morton_sample_configs.h

41 #iâdeà
_MORTON_SAMPLE_CONFIGS_H


42 
	#_MORTON_SAMPLE_CONFIGS_H


	)

44 
	~"com´es£d_cuckoo_f‹r.h
"

45 
	~"fixed_pošt.h
"

47 
Çme¥aû
 
	gCom´es£dCuckoo
{

88 
cÚ¡ex´
 
boŞ
 
	g»sizšg_’abËd
 = 
çl£
;

101 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_1_8
 = 0.35937;

102 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_1_8
 =

103 
FixedPošt
(
rg‘_com´essiÚ_¿tio_1_8
).
£rŸlize
();

104 
	gCom´es£dCuckooF‹r
<

109 
	trg‘_com´essiÚ_¿tio_så_1_8
,

110 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_SIMPLE
,

111 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_SIMPLE
,

112 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

113 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

114 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tRAW_BUCKET_HASH
,

115 
	t»sizšg_’abËd
,

116 
	tŒue
,

117 
	tŒue
,

118 
	tŒue
,

119 
	tçl£
,

120 
	tŒue
,

121 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


122 > 
	tMÜtÚ1_8
;

131 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_3_8
 = 0.23958;

132 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_3_8
 =

133 
FixedPošt
(
rg‘_com´essiÚ_¿tio_3_8
).
£rŸlize
();

134 
	gCom´es£dCuckooF‹r
<

139 
	trg‘_com´essiÚ_¿tio_så_3_8
,

140 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_SIMPLE
,

141 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_SIMPLE
,

142 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

143 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

144 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

145 
	t»sizšg_’abËd
,

146 
	tŒue
,

147 
	tŒue
,

148 
	tŒue
,

149 
	tçl£
,

150 
	tŒue
,

151 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


152 > 
	tMÜtÚ3_8
;

161 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_7_8
 = 0.36734;

162 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_7_8
 =

163 
FixedPošt
(
rg‘_com´essiÚ_¿tio_7_8
).
£rŸlize
();

164 
	gCom´es£dCuckooF‹r
<

169 
	trg‘_com´essiÚ_¿tio_så_7_8
,

170 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

171 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_SIMPLE
,

172 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

173 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

174 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

175 
	t»sizšg_’abËd
,

176 
	tŒue
,

177 
	tŒue
,

178 
	tŒue
,

179 
	tçl£
,

180 
	tŒue
,

181 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


182 > 
	tMÜtÚ7_8
;

191 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_15_8
 = 0.22499;

192 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_15_8
 =

193 
FixedPošt
(
rg‘_com´essiÚ_¿tio_15_8
).
£rŸlize
();

194 
	gCom´es£dCuckooF‹r
<

199 
	trg‘_com´essiÚ_¿tio_så_15_8
,

200 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

201 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_SIMPLE
,

202 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

203 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

204 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

205 
	t»sizšg_’abËd
,

206 
	tŒue
,

207 
	tŒue
,

208 
	tŒue
,

209 
	tçl£
,

210 
	tŒue
,

211 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


212 > 
	tMÜtÚ15_8
;

220 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_3_6
 = 0.317708;

221 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_3_6
 =

222 
FixedPošt
(
rg‘_com´essiÚ_¿tio_3_6
).
£rŸlize
();

223 
	gCom´es£dCuckooF‹r
<

228 
	trg‘_com´essiÚ_¿tio_så_3_6
,

229 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_SIMPLE
,

230 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_CROSS
,

231 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

232 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

233 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

234 
	t»sizšg_’abËd
,

235 
	tŒue
,

236 
	tŒue
,

237 
	tŒue
,

238 
	tçl£
,

239 
	tŒue
,

240 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


241 > 
	tMÜtÚ3_6
;

249 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_7_6
 = 0.294646;

250 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_7_6
 =

251 
FixedPošt
(
rg‘_com´essiÚ_¿tio_7_6
).
£rŸlize
();

252 
	gCom´es£dCuckooF‹r
<

257 
	trg‘_com´essiÚ_¿tio_så_7_6
,

258 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_CROSS
,

259 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_CROSS
,

260 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

261 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

262 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

263 
	t»sizšg_’abËd
,

264 
	tŒue
,

265 
	tŒue
,

266 
	tŒue
,

267 
	tçl£
,

268 
	tŒue
,

269 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


270 > 
	tMÜtÚ7_6
;

279 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_15_6
 = 0.127083;

280 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_15_6
 =

281 
FixedPošt
(
rg‘_com´essiÚ_¿tio_15_6
).
£rŸlize
();

282 
	gCom´es£dCuckooF‹r
<

287 
	trg‘_com´essiÚ_¿tio_så_15_6
,

288 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_SIMPLE
,

289 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_CROSS
,

290 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

291 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

292 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

293 
	t»sizšg_’abËd
,

294 
	tŒue
,

295 
	tŒue
,

296 
	tŒue
,

297 
	tçl£
,

298 
	tŒue
,

299 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


300 > 
	tMÜtÚ15_6
;

308 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_3_12
 = 0.374999;

309 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_3_12
 =

310 
FixedPošt
(
rg‘_com´essiÚ_¿tio_3_12
).
£rŸlize
();

311 
	gCom´es£dCuckooF‹r
<

316 
	trg‘_com´essiÚ_¿tio_så_3_12
,

317 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

318 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_CROSS
,

319 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

320 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

321 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

322 
	t»sizšg_’abËd
,

323 
	tŒue
,

324 
	tŒue
,

325 
	tŒue
,

326 
	tçl£
,

327 
	tŒue
,

328 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


329 > 
	tMÜtÚ3_12
;

337 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_7_12
 = 0.357142;

338 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_7_12
 =

339 
FixedPošt
(
rg‘_com´essiÚ_¿tio_7_12
).
£rŸlize
();

340 
	gCom´es£dCuckooF‹r
<

345 
	trg‘_com´essiÚ_¿tio_så_7_12
,

346 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

347 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_CROSS
,

348 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

349 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

350 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

351 
	t»sizšg_’abËd
,

352 
	tŒue
,

353 
	tŒue
,

354 
	tŒue
,

355 
	tçl£
,

356 
	tŒue
,

357 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


358 > 
	tMÜtÚ7_12
;

366 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_15_12
 = 0.149999;

367 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_15_12
 =

368 
FixedPošt
(
rg‘_com´essiÚ_¿tio_15_12
).
£rŸlize
();

369 
	gCom´es£dCuckooF‹r
<

374 
	trg‘_com´essiÚ_¿tio_så_15_12
,

375 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

376 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_CROSS
,

377 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

378 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

379 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

380 
	t»sizšg_’abËd
,

381 
	tŒue
,

382 
	tŒue
,

383 
	tŒue
,

384 
	tçl£
,

385 
	tŒue
,

386 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


387 > 
	tMÜtÚ15_12
;

395 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_3_16
 = 0.281249;

396 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_3_16
 =

397 
FixedPošt
(
rg‘_com´essiÚ_¿tio_3_16
).
£rŸlize
();

398 
	gCom´es£dCuckooF‹r
<

403 
	trg‘_com´essiÚ_¿tio_så_3_16
,

404 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

405 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_SIMPLE
,

406 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

407 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

408 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

409 
	t»sizšg_’abËd
,

410 
	tŒue
,

411 
	tŒue
,

412 
	tŒue
,

413 
	tçl£
,

414 
	tŒue
,

415 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


416 > 
	tMÜtÚ3_16
;

424 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_7_16
 = 0.249999;

425 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_7_16
 =

426 
FixedPošt
(
rg‘_com´essiÚ_¿tio_7_16
).
£rŸlize
();

427 
	gCom´es£dCuckooF‹r
<

432 
	trg‘_com´essiÚ_¿tio_så_7_8
,

433 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

434 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_SIMPLE
,

435 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

436 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

437 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

438 
	t»sizšg_’abËd
,

439 
	tŒue
,

440 
	tŒue
,

441 
	tŒue
,

442 
	tçl£
,

443 
	tŒue
,

444 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


445 > 
	tMÜtÚ7_16
;

453 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_15_16
 = 0.241666;

454 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_15_16
 =

455 
FixedPošt
(
rg‘_com´essiÚ_¿tio_15_16
).
£rŸlize
();

456 
	gCom´es£dCuckooF‹r
<

461 
	trg‘_com´essiÚ_¿tio_så_15_16
,

462 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

463 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_SIMPLE
,

464 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

465 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

466 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tLEMIRE_FINGERPRINT_MULTIPLY
,

467 
	t»sizšg_’abËd
,

468 
	tŒue
,

469 
	tŒue
,

470 
	tŒue
,

471 
	tçl£
,

472 
	tŒue
,

473 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


474 > 
	tMÜtÚ15_16
;

482 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_3_18
 = 0.249999;

483 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_3_18
 =

484 
FixedPošt
(
rg‘_com´essiÚ_¿tio_3_18
).
£rŸlize
();

485 
	gCom´es£dCuckooF‹r
<

490 
	trg‘_com´essiÚ_¿tio_så_3_18
,

491 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

492 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_CROSS
,

493 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

494 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

495 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

496 
	t»sizšg_’abËd
,

497 
	tŒue
,

498 
	tŒue
,

499 
	tŒue
,

500 
	tçl£
,

501 
	tŒue
,

502 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


503 > 
	tMÜtÚ3_18
;

511 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_7_18
 = 0.223214;

512 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_7_18
 =

513 
FixedPošt
(
rg‘_com´essiÚ_¿tio_7_18
).
£rŸlize
();

514 
	gCom´es£dCuckooF‹r
<

519 
	trg‘_com´essiÚ_¿tio_så_7_18
,

520 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

521 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_CROSS
,

522 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

523 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

524 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tCLUSTERED_BUCKET_HASH
,

525 
	t»sizšg_’abËd
,

526 
	tŒue
,

527 
	tŒue
,

528 
	tŒue
,

529 
	tçl£
,

530 
	tŒue
,

531 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


532 > 
	tMÜtÚ7_18
;

540 
cÚ¡ex´
 
	grg‘_com´essiÚ_¿tio_15_18
 = 0.216666;

541 
cÚ¡ex´
 
S”ŸlizedFixedPošt
 
	grg‘_com´essiÚ_¿tio_så_15_18
 =

542 
FixedPošt
(
rg‘_com´essiÚ_¿tio_15_18
).
£rŸlize
();

543 
	gCom´es£dCuckooF‹r
<

548 
	trg‘_com´essiÚ_¿tio_så_15_18
,

549 
	tCouÁ”R—dM‘hodEnum
::
	tREAD_RAW
,

550 
	tFšg”´štR—dM‘hodEnum
::
	tREAD_SIMPLE
,

551 
	tReduùiÚM‘hodEnum
::
	tPOP_CNT
,

552 
	tAÉ”Ç‹Buck‘S–eùiÚM‘hodEnum
::
	tFUNCTION_BASED_OFFSET
,

553 
	tOv”æowT¿ckšgA¼ayHashšgM‘hodEnum
::
	tLEMIRE_FINGERPRINT_MULTIPLY
,

554 
	t»sizšg_’abËd
,

555 
	tŒue
,

556 
	tŒue
,

557 
	tŒue
,

558 
	tçl£
,

559 
	tŒue
,

560 
	tFšg”´štCom·risÚM‘hodEnum
::
	tVARIABLE_COUNT


561 > 
	tMÜtÚ15_18
;

	@morton_util.h

37 #iâdeà
_MORTON_UTIL_H


38 
	#_MORTON_UTIL_H


	)

40 
Çme¥aû
 
	gCom´es£dCuckoo
{

43 
	g‹m¶©e
<
şass
 
	gT
>

44 
T
 
divide_round_up_ev’
(T 
šput
, T 
divisÜ
){

45 
T
 
	g»t
 = (
šput
 + 
divisÜ
 - 1) / divisor;

46  
	g»t
 & 1 ?„‘ + 1 : 
»t
;

51 
	g‹m¶©e
<
şass
 
	gT
>

52 
T
 
d‘”mše_tÙ®_buck‘s
(T 
¦Ùs_³r_buck‘
, T 
tÙ®_¦Ùs
,

53 
T
 
buck‘s_³r_block
){

63 
T
 
	glogiÿl_¦Ùs_³r_block
 = 
¦Ùs_³r_buck‘
 * 
buck‘s_³r_block
;

64 
T
 
	gtÙ®_blocks
 = (
tÙ®_¦Ùs
 + 
logiÿl_¦Ùs_³r_block
 - 1) /

65 (
logiÿl_¦Ùs_³r_block
);

66 
T
 
	gtÙ®_buck‘s
 = 
tÙ®_blocks
 * 
buck‘s_³r_block
;

67 
	gtÙ®_buck‘s
 = (
tÙ®_buck‘s
 & 1è?Ù®_buck‘ + 
buck‘s_³r_block
 :

68 
tÙ®_buck‘s
;

69  
	gtÙ®_buck‘s
;

	@test_util.h

37 #iâdeà
_TEST_UTIL_H


38 
	#_TEST_UTIL_H


	)

40 
Çme¥aû
 
	gTe¡
{

41 
	g¡d
::
¡ršg
 
·ss
(
boŞ
 
sucûss_¡©us
){

42  
¡d
::
¡ršg
(
sucûss_¡©us
 ? "SUCCESS" : "FAILURE");

	@util.h

37 #iâdeà
_UTIL_H


38 
	#_UTIL_H


	)

40 
	~<c¡dšt
>

41 
	~<¡ršg
>

42 
	~<s¡»am
>

43 
	~<cm©h
>

45 
	~<io¡»am
>

47 
	~"veùÜ_ty³s.h
"

51 #ifdeà
__BMI2__


52 
	~"x86šŒš.h
"

55 
Çme¥aû
 
	gut
{

57 
	g‹m¶©e
<
şass
 
	gINT_TYPE
>

58 
šlše
 
	g¡d
::
¡ršg
 
bš_¡ršg
(
INT_TYPE
 
š‹g”
, 
ušt32_t
 
¥acšg
){

59 
	g¡d
::
¡ršg¡»am
 
ss
;

60 
št32_t
 
	gi
 = (
š‹g”
) * 8 - 1; i > -1; i--){

61 
	gss
 << ((
	gš‹g”
 >> 
	gi
) & 1 ? '1' : '0');

62 if(
	gi
 % 
	g¥acšg
 == 0){

63 
ss
 << ' ';

66  
	gss
.
¡r
();

69 
	g‹m¶©e
<
şass
 
	gINT_TYPE
>

70 
šlše
 
	g¡d
::
¡ršg
 
bš_¡ršg
(
INT_TYPE
 
š‹g”
){

71  
bš_¡ršg
<
INT_TYPE
>(
š‹g”
, 8 * (
	gINT_TYPE
));

76 
cÚ¡ex´
 
šlše
 
ušt32_t
 
log2û
(ušt32_ˆ
š‹g”
){

79  32u - 
__butš_şz
(
š‹g”
 - 1u);

89 
	g‹m¶©e
<
ty³Çme
 
	gT
>

90 
šlše
 
T
 
ç¡_mod_®‹º©ive
(T 
¿w_hash
, T 
modulus
, T 
hash_width_š_b™s
);

92 
	g‹m¶©e
<>

93 
šlše
 
ušt64_t
 
	gç¡_mod_®‹º©ive
<
	gušt64_t
>(ušt64_ˆ
	g¿w_hash
,

94 
ušt64_t
 
	gmodulus
, ušt64_ˆ
	ghash_width_š_b™s
){

95  (
	g¡©ic_ÿ¡
<
	g__ušt128_t
>(
	g¿w_hash
è* 
	gmodulus
è>> 
	ghash_width_š_b™s
;

98 
	g‹m¶©e
<>

99 
šlše
 
ušt32_t
 
	gç¡_mod_®‹º©ive
<
	gušt32_t
>(ušt32_ˆ
	g¿w_hash
,

100 
ušt32_t
 
	gmodulus
, ušt32_ˆ
	ghash_width_š_b™s
){

101  (
	g¡©ic_ÿ¡
<
	g__ušt64_t
>(
	g¿w_hash
è* 
	gmodulus
è>> 
	ghash_width_š_b™s
;

104 
	g‹m¶©e
<
şass
 
	gTN
, cÏs 
	gT
>

105 
šlše
 
TN
 
ç¡_mod_®‹º©iveN
(TN 
¿w_hashes
, 
T
 
modulus
);

107 
	g‹m¶©e
<
şass
 
	gARRAY_TYPE
>

108 
šlše
 
´št_¬¿y
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, cÚ¡ 
ARRAY_TYPE
& 
¬¿y
){

109 
	g¡d
::
cout
 << 
Çme
 << " [ ";

110 
ušt32_t
 
	gi
 = 0; i < 
	gb©ch_size
; i++){

111 
	g¡d
::
cout
 << 
¡©ic_ÿ¡
<
ušt32_t
>(
¬¿y
[
i
]) << " ";

113 
	g¡d
::
cout
 << "]\n";

116 
	g‹m¶©e
<>

117 
šlše
 
vN_u32
 
	gç¡_mod_®‹º©iveN
<
	gvN_u32
, 
	gušt32_t
>(vN_u32 
	g¿w_hashes
, 
ušt32_t
 
	gmodulus
){

118 
ušt32_t
 
	gi
 = 0; i < 
	g_N
; i++){

119 
¡©ic_as£¹
(
_N
 <= 8, "Vector widthƒxceeds AVX/AVX2's 256-bit vector width\n");

120 
	g¿w_hashes
[
i
] = 
¡©ic_ÿ¡
<
ušt32_t
>((¡©ic_ÿ¡<
__ušt64_t
>(
¿w_hashes
[i]è* 
modulus
) >> 32U);

122  
	g¿w_hashes
;

129 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am& 
os
, 
__ušt128_t
 
	gš‹g”
){

130 
	g¡d
::
¡ršg¡»am
 
ss
;

131 
__ušt128_t
 
	gsq¹_pow”10
 = 
¡©ic_ÿ¡
<__uint128_t>(10000000000000000000ull);

133 
__št128_t
 
	gpow”10
 = 
sq¹_pow”10
 * sqrt_power10;

134 
	g¡©ic_ÿ¡
<
	g__ušt128_t
>(0è/ 
	gpow”10
 == 0){

135 
pow”10
 /= 10;

137 
	gpow”10
 != 0){

138 
ušt32_t
 
dig™
 = 
š‹g”
 / 
pow”10
;

139 
	gos
 << 
	g¡©ic_ÿ¡
<
	gušt32_t
>(
	gdig™
);

140 
	gš‹g”
 -ğ
pow”10
 * (
dig™
);

141 
	gpow”10
 /= 10;

143  
	gos
;

	@vector_types.h

37 #iâdeà
_VECTOR_TYPES_H


38 
	#_VECTOR_TYPES_H


	)

40 
	~<¬¿y
>

42 
__ušt128_t
 
	tušt128_t
;

45 
ušt8_t
 
	tcouÁ”_t
;

48 
	#CCF_KEY_SIZE
 8

	)

50 #ià
CCF_KEY_SIZE
 == 4

51 
ušt32_t
 
	t©om_t
;

52 
ušt32_t
 
	thash_t
;

53 
ušt32_t
 
	tkeys_t
;

54 
cÚ¡ex´
 
ušt64_t
 
	g_N
 = 8;

55 #–ià
CCF_KEY_SIZE
 == 8

56 
ušt64_t
 
	t©om_t
;

57 
ušt64_t
 
	thash_t
;

58 
ušt64_t
 
	tkeys_t
;

59 
cÚ¡ex´
 
ušt64_t
 
	g_N
 = 4;

65 
	sStÜeP¬ams
{

66 
hash_t
 
	mblock_id
;

67 
ušt16_t
 
	mcouÁ”_šdex
;

68 
couÁ”_t
 
	mbuck‘_¡¬t_šdex
;

69 
couÁ”_t
 
	m–em’ts_š_block
;

70 
couÁ”_t
 
	mcouÁ”_v®ue
;

74 
cÚ¡ex´
 
ušt_ç¡64_t
 
	gb©ch_size
 = 128;

75 
	g¡d
::
	t¬¿y
<
	t©om_t
, 
	tb©ch_size
> 
	t¬_©om
;

76 
	g¡d
::
	t¬¿y
<
	tušt8_t
, 
	tb©ch_size
> 
	t¬_u8
;

77 
	g¡d
::
	t¬¿y
<
	tušt16_t
, 
	tb©ch_size
> 
	t¬_u16
;

78 
	g¡d
::
	t¬¿y
<
	tušt32_t
, 
	tb©ch_size
> 
	t¬_u32
;

79 
	g¡d
::
	t¬¿y
<
	tcouÁ”_t
, 
	tb©ch_size
> 
	t¬_couÁ”
;

80 
	g¡d
::
	t¬¿y
<
	thash_t
, 
	tb©ch_size
> 
	t¬_hash
;

81 
	g¡d
::
	t¬¿y
<
	tkeys_t
, 
	tb©ch_size
> 
	t¬_key
;

82 
	g¡d
::
	t¬¿y
<
	tStÜeP¬ams
, 
	tb©ch_size
> 
	t¬_¡Üe_·¿ms
;

84 
	sStÜeP¬amsSOA
{

85 
¬_hash
 
	mblock_ids
;

86 
¬_u16
 
	mcouÁ”_šdexes
;

87 
¬_couÁ”
 
	mbuck‘_¡¬t_šdexes
;

88 
¬_couÁ”
 
	m–em’ts_š_blocks
;

89 
¬_couÁ”
 
	mcouÁ”_v®ues
;

94 
ušt64_t
 
	tvN_u64
 
	t__©Œibu‹__
 ((
	tveùÜ_size
((
	tušt64_t
è* 
	t_N
)));

95 
ušt8_t
 
	tvN_u8
 
	t__©Œibu‹__
 ((
	tveùÜ_size
 ((
	tušt8_t
è* 
	t_N
)));

96 
ušt16_t
 
	tvN_u16
 
	t__©Œibu‹__
 ((
	tveùÜ_size
 ((
	tušt16_t
è* 
	t_N
)));

97 
ušt32_t
 
	tvN_u32
 
	t__©Œibu‹__
 ((
	tveùÜ_size
 ((
	tušt32_t
è* 
	t_N
)));

98 
©om_t
 
	tvN_©om
 
	t__©Œibu‹__
 ((
	tveùÜ_size
 ((
	t©om_t
è* 
	t_N
)));

99 
keys_t
 
	tvN_key
 
	t__©Œibu‹__
((
	tveùÜ_size
 ((
	tkeys_t
è* 
	t_N
)));

100 
hash_t
 
	tvN_hash
 
	t__©Œibu‹__
((
	tveùÜ_size
 ((
	thash_t
è* 
	t_N
)));

103 
©om_t
 
	tvN_couÁ”
 
	t__©Œibu‹__
 ((
	tveùÜ_size
 ((
	t©om_t
è* 
	t_N
)));

	@
1
.
0
39
1263
benchmarking/benchmark.cc
benchmarking/benchmark_cf.cc
benchmarking/benchmark_cf.h
benchmarking/benchmark_common.h
benchmarking/benchmark_mf.cc
benchmarking/benchmark_mf.h
benchmarking/benchmark_mf_config.h
benchmarking/benchmark_ss_cf.cc
benchmarking/benchmark_util.h
benchmarking/cuckoofilter/benchmarks/bulk-insert-and-query.cc
benchmarking/cuckoofilter/benchmarks/conext-figure5.cc
benchmarking/cuckoofilter/benchmarks/conext-table3.cc
benchmarking/cuckoofilter/benchmarks/random.h
benchmarking/cuckoofilter/benchmarks/timing.h
benchmarking/cuckoofilter/example/test.cc
benchmarking/cuckoofilter/src/bitsutil.h
benchmarking/cuckoofilter/src/cuckoofilter.h
benchmarking/cuckoofilter/src/debug.h
benchmarking/cuckoofilter/src/hashutil.cc
benchmarking/cuckoofilter/src/hashutil.h
benchmarking/cuckoofilter/src/packedtable.h
benchmarking/cuckoofilter/src/permencoding.h
benchmarking/cuckoofilter/src/printutil.cc
benchmarking/cuckoofilter/src/printutil.h
benchmarking/cuckoofilter/src/simd-block.h
benchmarking/cuckoofilter/src/singletable.h
benchmarking/measure_bucket_accesses.cc
bf.h
block.h
compressed_cuckoo_config.h
compressed_cuckoo_filter.h
fixed_point.h
hash_util.h
morton_filter.h
morton_sample_configs.h
morton_util.h
test_util.h
util.h
vector_types.h
